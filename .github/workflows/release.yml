name: Release Artifacts

on:
  push:
    tags:
      - "*"           # consider 'v*' if you only want version tags

jobs:
  wheel-build:
    name: Build and Publish Release Artifacts
    runs-on: ubuntu-24.04

    permissions:
      contents: read

    steps:
      - name: Checkout
        uses: actions/checkout@v5

      - name: Install uv
        uses: astral-sh/setup-uv@v7
        with:
          # optional but nice to pin
          # version: "0.9.16"
          enable-cache: true

      - name: Install Python
        run: uv python install 3.12

      - name: Build distributions
        run: uv build

      # Optional: simple sanity check that the built dists are valid
      - name: Check distributions
        run: |
          python -m pip install --upgrade pip
          pip install twine
          twine check dist/*

      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: dist
          path: dist/*

      - name: Publish to PyPI
        env:
          UV_PUBLISH_TOKEN: ${{ secrets.UV_PUBLISH_TOKEN }}
        run: uv publish --non-interactive
