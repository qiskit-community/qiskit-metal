<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../../genindex.html" /><link rel="search" title="Search" href="../../../../search.html" />

    <!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
        <title>qiskit_metal.renderers.renderer_gds.gds_renderer - Quantum Metal 0.5.2.post4</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/qiskit-sphinx-theme.css?v=8ff9dcb6" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=IBM+Plex+Sans:ital,wght@0,400;0,600;1,400;1,600&display=swap" rel="stylesheet"></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M14 2H2C1.73478 2 1.48043 2.10536 1.29289 2.29289C1.10536 2.48043 1 2.73478 1 3V13C1 13.2652 1.10536 13.5196 1.29289 13.7071C1.48043 13.8946 1.73478 14 2 14H14C14.2652 14 14.5196 13.8946 14.7071 13.7071C14.8946 13.5196 15 13.2652 15 13V3C15 2.73478 14.8946 2.48043 14.7071 2.29289C14.5196 2.10536 14.2652 2 14 2V2ZM2 3H10V13H2V3ZM14 13H11V3H14V13Z" fill="currentColor"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M14 3H2V4H14V3Z" fill="currentColor"/>
      <path d="M14 12H2V13H14V12Z" fill="currentColor"/>
      <path d="M14 6H2V7H14V6Z" fill="currentColor"/>
      <path d="M14 9H2V10H14V9Z" fill="currentColor"/>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M11 8L6.00005 13L5.30005 12.3L9.60005 8L5.30005 3.7L6.00005 3L11 8Z" fill="currentColor"/>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M15 13H1V14H15V13Z" fill="currentColor"/>
      <path d="M12.7 4.5C13.1 4.1 13.1 3.5 12.7 3.1L10.9 1.3C10.5 0.9 9.9 0.9 9.5 1.3L2 8.8V12H5.2L12.7 4.5ZM10.2 2L12 3.8L10.5 5.3L8.7 3.5L10.2 2ZM3 11V9.2L8 4.2L9.8 6L4.8 11H3Z" fill="currentColor"/>
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M11 13.0002C11.5523 13.0002 12 12.5525 12 12.0002C12 11.4479 11.5523 11.0002 11 11.0002C10.4477 11.0002 10 11.4479 10 12.0002C10 12.5525 10.4477 13.0002 11 13.0002Z" fill="currentColor"/>
      <path d="M14.8884 11.7394C14.5795 10.9524 14.0464 10.2734 13.3552 9.78646C12.664 9.29954 11.8451 9.02615 11 9.00017C10.1549 9.02615 9.33604 9.29954 8.64484 9.78646C7.95365 10.2734 7.42052 10.9524 7.11155 11.7394L7 12.0002L7.11155 12.2609C7.42052 13.0479 7.95365 13.727 8.64484 14.2139C9.33604 14.7008 10.1549 14.9742 11 15.0002C11.8451 14.9742 12.664 14.7008 13.3552 14.2139C14.0464 13.727 14.5795 13.0479 14.8884 12.2609L15 12.0002L14.8884 11.7394ZM11 14.0002C10.6044 14.0002 10.2178 13.8829 9.88886 13.6631C9.55996 13.4433 9.30362 13.131 9.15224 12.7655C9.00087 12.4001 8.96126 11.998 9.03843 11.61C9.1156 11.222 9.30608 10.8657 9.58579 10.586C9.86549 10.3063 10.2219 10.1158 10.6098 10.0386C10.9978 9.96143 11.3999 10.001 11.7654 10.1524C12.1308 10.3038 12.4432 10.5601 12.6629 10.889C12.8827 11.2179 13 11.6046 13 12.0002C12.9994 12.5304 12.7885 13.0388 12.4136 13.4137C12.0386 13.7887 11.5303 13.9996 11 14.0002Z" fill="currentColor"/>
      <path d="M6 14.0002H4V2.00017H8V5.00017C8.00077 5.26515 8.10637 5.51906 8.29374 5.70643C8.48111 5.8938 8.73502 5.99941 9 6.00017H12V8.00017H13V5.00017C13.0018 4.93446 12.9893 4.86913 12.9634 4.80871C12.9375 4.74828 12.8988 4.6942 12.85 4.65017L9.35 1.15017C9.30599 1.10134 9.2519 1.06263 9.19147 1.03674C9.13104 1.01084 9.06572 0.998364 9 1.00017H4C3.73502 1.00094 3.48111 1.10654 3.29374 1.29391C3.10637 1.48128 3.00077 1.73519 3 2.00017V14.0002C3.00077 14.2652 3.10637 14.5191 3.29374 14.7064C3.48111 14.8938 3.73502 14.9994 4 15.0002H6V14.0002ZM9 2.20017L11.8 5.00017H9V2.20017Z" fill="currentColor"/>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../../index.html"><div class="brand">Quantum Metal 0.5.2.post4</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../../index.html">
  
  
  <span class="sidebar-brand-text">Quantum Metal 0.5.2.post4</span>
  
</a>
<form class="sidebar-search-container" method="get" action="../../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../index.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installing Qiskit Metal</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../workflow.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../workflow.html#qiskit-metal-workflow">Qiskit Metal Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../workflow.html#quantization-methods-overview">Quantization Methods Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributor-guide.html">Contributor Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../faq.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../videoseducation.html">Videos &amp; Education</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../tut/index.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/1-Overview/1.1-Bird%27s-eye-view-of-Qiskit-Metal.html">Bird’s eye view of Qiskit Metal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/1-Overview/1.2-Quick-start.html">Quick Start: Build your first 4-qubit processor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/1-Overview/1.3-Saving-Your-Chip-Design.html">Save your chip design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/2-From-components-to-chip/2.01-How-to-use-a-QComponent.html">How to use a QComponent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/2-From-components-to-chip/2.01-How-to-use-a-QComponent.html#QComponent-Default-Options">QComponent Default Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/2-From-components-to-chip/2.01-How-to-use-a-QComponent.html#Modifying-the-Options">Modifying the Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/2-From-components-to-chip/2.01-How-to-use-a-QComponent.html#Copying-a-QComponent">Copying a QComponent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/2-From-components-to-chip/2.01-How-to-use-a-QComponent.html#Deleting-a-QComponent">Deleting a QComponent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/2-From-components-to-chip/2.01-How-to-use-a-QComponent.html#Renaming-a-QComponent">Renaming a QComponent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/2-From-components-to-chip/2.01-How-to-use-a-QComponent.html#Overwriting-a-QComponent">Overwriting a QComponent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/2-From-components-to-chip/2.01-How-to-use-a-QComponent.html#Closing-the-Qiskit-Metal-GUI">Closing the Qiskit Metal GUI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/2-From-components-to-chip/2.02-How-to-copy-a-QComponent.html">How to copy a QComponent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/2-From-components-to-chip/2.11-Routing-101.html">Routing 101</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/2-From-components-to-chip/2.12-Simple-Meander.html">Simple Meander</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/2-From-components-to-chip/2.12-Simple-Meander.html#Using-CPW-meanders-to-connect-the-3-Qbits">Using CPW meanders to connect the 3 Qbits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/2-From-components-to-chip/2.13-Hybrid-Auto-and-AStar.html">Hybrid Auto and AStar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/2-From-components-to-chip/2.14-Get-them-all-with-MixedRoute.html">Get them all with MixedRoute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/2-From-components-to-chip/2.21-Design-a-4-qubit-full-chip.html">Design a 4 qubit full chip</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/2-From-components-to-chip/2.22-Design-100-qubits-programmatically.html">Design 100 qubits programmatically</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/2-From-components-to-chip/2.23-Modify-chip-options.html">Modify chip options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/2-From-components-to-chip/2.31-Create-a-QComponent-Basic.html">Create a QComponent - Basic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/2-From-components-to-chip/2.32-Create-a-QComponent-Advanced.html">Create a QComponent - Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/2-From-components-to-chip/2.33-Add-my-QComponent-to-a-reusable-python-file.html">Add my QComponent to a reusable python file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/3-Renderers/3.1-Introduction-to-QRenderers.html">Introduction to QRenderers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/3-Renderers/3.1-Introduction-to-QRenderers.html#Note:">Note:</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/3-Renderers/3.2-Export-your-design-to-GDS.html">Export your design to GDS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/3-Renderers/3.3-Render-your-design-to-Ansys.html">Render your design to Ansys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/3-Renderers/3.4-How-do-I-make-my-custom-QRenderer.html">How do I make my custom QRenderer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/4-Analysis/4.01-Capacitance-and-LOM.html">Capacitance matrix and LOM analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/4-Analysis/4.02-Eigenmode-and-EPR.html">Eigenmode and EPR analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/4-Analysis/4.03-Impedance.html">Impedance, admittance and scattering analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/4-Analysis/4.11-Analyze-and-tune-a-transmon.html">Analyzing and tuning a transmon qubit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/4-Analysis/4.11-Analyze-and-tune-a-transmon.html#1.-Create-the-Qbit-design">1. Create the Qbit design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/4-Analysis/4.12-Analyze-a-resonator.html">Analyzing and tuning a resonator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/4-Analysis/4.13-Analyze-transmon-and-resonator.html">Analyzing and tuning a transmon qubit with a resonator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/4-Analysis/4.14-Analyze-a-double-hanger-resonator.html">Analyzing a double hanger resonator (S Param)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/4-Analysis/4.15-CPW-kappa-calculation.html">CPW Kappa Calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/4-Analysis/4.21-Capacitance-matrix.html">Sweeps - Capacitance matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/4-Analysis/4.21-Capacitance-matrix.html#READ-THIS-BEFORE-running-the-cell.">READ THIS BEFORE running the cell.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/4-Analysis/4.22-Eigenmode-matrix.html">Sweeps - Eigenmode matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/4-Analysis/4.23-Impedance-and-scattering-Z-S-Y-matrices.html">Sweeps - Impedance, scattering and admittance (Z S Y) matrices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/4-Analysis/4.31-Plot-quantum-oscillator-wavefunction.html">Plotting Wavefunctions of the Quantum Harmonic Oscillator (LC Circuit)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/4-Analysis/4.32-Transmon-analytics-HCPB.html">Transmon Analytics: Plotting Eigenvalues as a Function of Offset Charge</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/4-Analysis/4.33-Transmon-analytics.html">Transmon Analytics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/4-Analysis/4.34-Transmon-qubit-CPB-hamiltonian-charge-basis.html">Modeling transmon qubit Cooper-pair box Hamiltonian in the charge basis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/quick-topics/JJ-Demo-Notebook.html">Josephson Junction QComponent Demo Notebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/quick-topics/Managing-pins.html">Managing pins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/quick-topics/Managing-variables.html">Managing variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/quick-topics/Opening-documentation.html">Opening the documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/quick-topics/QComponent-3-fingers-capacitor.html">QComponent - 3-fingers capacitor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tut/quick-topics/QComponent-Interdigitated-transmon.html">QComponent - Interdigitated transmon qubit</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../circuit-examples/index.html">Example Designs</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Example Designs</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../circuit-examples/A.Qubits/01-Transmon_cross.html">Single Transmon - Grounded (xmon)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../circuit-examples/A.Qubits/02-Transmon_floating.html">Single Transmon - Floating</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../circuit-examples/A.Qubits/03-concentric_transmon.html">Concentric Transmon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../circuit-examples/A.Qubits/04-Interdigitated_Transmon.html">Interdigitated Transmon Qubits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../circuit-examples/A.Qubits/05-Transmon_cross_fl.html">Single Transmon - Grounded (xmon) flux lines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../circuit-examples/A.Qubits/06-Transmon_floating_6.html">Single Transmon - Floating with 6 connection pads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../circuit-examples/A.Qubits/07-Transmon_floating_cl.html">Single Transmon - Floating with charge lines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../circuit-examples/A.Qubits/08-JJ-Dolan.html">Josephson Junction (Dolan)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../circuit-examples/A.Qubits/09-JJ-Manhattan.html">Josephson Junction (Manhattan)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../circuit-examples/A.Qubits/10-Transmon_floating_teeth.html">Single Transmon - Floating with teeth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../circuit-examples/A.Qubits/11-Star_shaped_qubit.html">Star shaped qubit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../circuit-examples/A.Qubits/11-Star_shaped_qubit.html#A-Star-Qubit">A Star Qubit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../circuit-examples/A.Qubits/11-Star_shaped_qubit.html#Closing-the-Qiskit-Metal-GUI">Closing the Qiskit Metal GUI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../circuit-examples/B.Resonators/11-Resonator_Meander.html">Simple CPW Meander</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../circuit-examples/C.Composite-bi-partite/21-OneTransmonsWithMeanderAndOTG.html">Transmon coupled to CPW resonator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../circuit-examples/D.Qubit-couplers/31-TwoCrossmonsTunableCoupler.html">Tunable Coupler (MIT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../circuit-examples/D.Qubit-couplers/32-TwoTransmonsDirectCoupling.html">Direct Coupler (transmon-transmon)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../circuit-examples/D.Qubit-couplers/33-TwoTransmonsWithMeander.html">Bus Resonator Coupler (transmon-transmon)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../circuit-examples/E.Input-output-coupling/41-LaunchPad.html">CPW Launch Pad</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../circuit-examples/E.Input-output-coupling/42-ResonatorAndLaunchPad.html">Readout line</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../circuit-examples/E.Input-output-coupling/43-TransmonPocketCL.html">Charge Line</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../circuit-examples/F.Small-quantum-chips/51-Four_qubit_chip.html">Four Qubit Chip Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../circuit-examples/full-design-flow-examples/Example-full-chip-design.html">Example full chip design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../circuit-examples/full-design-flow-examples/Example-used-in-the-launch-video.html">Launch Videos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../circuit-examples/full-design-flow-examples/Exercise-for-the-South-Korea-Hackathon%2720.html">South Korea Qiskit Hackathon’20 - Qiskit Metal exercise</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Libraries</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../apidocs/qlibrary.html">All Quantum Devices</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of All Quantum Devices</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.QComponent.html">QComponent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.ParsedDynamicAttributes_Component.html">ParsedDynamicAttributes_Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.BaseQubit.html">BaseQubit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.QRoute.html">QRoute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.QRouteLead.html">QRouteLead</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.QRoutePoint.html">QRoutePoint</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.CircleCaterpillar.html">CircleCaterpillar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.CircleRaster.html">CircleRaster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.NGon.html">NGon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.NSquareSpiral.html">NSquareSpiral</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.Rectangle.html">Rectangle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.RectangleHollow.html">RectangleHollow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.Cap3Interdigital.html">Cap3Interdigital</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.CapNInterdigital.html">CapNInterdigital</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.ResonatorCoilRect.html">ResonatorCoilRect</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.CoupledLineTee.html">CoupledLineTee</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.LineTee.html">LineTee</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.CapNInterdigitalTee.html">CapNInterdigitalTee</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.TunableCoupler01.html">TunableCoupler01</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.TunableCoupler02.html">TunableCoupler02</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.ReadoutResFC.html">ReadoutResFC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.ResonatorLumped.html">ResonatorLumped</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.LaunchpadWirebond.html">LaunchpadWirebond</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.LaunchpadWirebondCoupled.html">LaunchpadWirebondCoupled</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.LaunchpadWirebondDriven.html">LaunchpadWirebondDriven</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.OpenToGround.html">OpenToGround</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.ShortToGround.html">ShortToGround</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.RouteStraight.html">RouteStraight</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.RouteFramed.html">RouteFramed</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.RouteMeander.html">RouteMeander</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.RouteAnchors.html">RouteAnchors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.RouteMixed.html">RouteMixed</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.RoutePathfinder.html">RoutePathfinder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.jj_dolan.html">jj_dolan</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.jj_manhattan.html">jj_manhattan</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.TransmonConcentric.html">TransmonConcentric</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.TransmonConcentricType2.html">TransmonConcentricType2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.TransmonCross.html">TransmonCross</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.TransmonCrossFL.html">TransmonCrossFL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.TransmonInterdigitated.html">TransmonInterdigitated</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.TransmonPocket.html">TransmonPocket</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.TransmonPocketCL.html">TransmonPocketCL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.TransmonPocket6.html">TransmonPocket6</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.TransmonPocketTeeth.html">TransmonPocketTeeth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.TunableCoupler01.html">TunableCoupler01</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.SQUID_LOOP.html">SQUID_LOOP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.StarQubit.html">StarQubit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.anchored_path.html">anchored_path</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../overview.html">Overview</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../apidocs/designs.html">QDesigns</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of QDesigns</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.designs.QDesign.html">QDesign</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.designs.DesignPlanar.html">DesignPlanar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.designs.MultiPlanar.html">MultiPlanar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.designs.DesignFlipChip.html">DesignFlipChip</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.designs.QNet.html">QNet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.designs.Components.html">Components</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../apidocs/qlibrary.html">QComponents</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of QComponents</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.QComponent.html">QComponent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.ParsedDynamicAttributes_Component.html">ParsedDynamicAttributes_Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.BaseQubit.html">BaseQubit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.QRoute.html">QRoute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.QRouteLead.html">QRouteLead</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.QRoutePoint.html">QRoutePoint</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.CircleCaterpillar.html">CircleCaterpillar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.CircleRaster.html">CircleRaster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.NGon.html">NGon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.NSquareSpiral.html">NSquareSpiral</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.Rectangle.html">Rectangle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.RectangleHollow.html">RectangleHollow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.Cap3Interdigital.html">Cap3Interdigital</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.CapNInterdigital.html">CapNInterdigital</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.ResonatorCoilRect.html">ResonatorCoilRect</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.CoupledLineTee.html">CoupledLineTee</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.LineTee.html">LineTee</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.CapNInterdigitalTee.html">CapNInterdigitalTee</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.TunableCoupler01.html">TunableCoupler01</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.TunableCoupler02.html">TunableCoupler02</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.ReadoutResFC.html">ReadoutResFC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.ResonatorLumped.html">ResonatorLumped</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.LaunchpadWirebond.html">LaunchpadWirebond</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.LaunchpadWirebondCoupled.html">LaunchpadWirebondCoupled</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.LaunchpadWirebondDriven.html">LaunchpadWirebondDriven</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.OpenToGround.html">OpenToGround</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.ShortToGround.html">ShortToGround</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.RouteStraight.html">RouteStraight</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.RouteFramed.html">RouteFramed</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.RouteMeander.html">RouteMeander</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.RouteAnchors.html">RouteAnchors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.RouteMixed.html">RouteMixed</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.RoutePathfinder.html">RoutePathfinder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.jj_dolan.html">jj_dolan</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.jj_manhattan.html">jj_manhattan</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.TransmonConcentric.html">TransmonConcentric</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.TransmonConcentricType2.html">TransmonConcentricType2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.TransmonCross.html">TransmonCross</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.TransmonCrossFL.html">TransmonCrossFL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.TransmonInterdigitated.html">TransmonInterdigitated</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.TransmonPocket.html">TransmonPocket</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.TransmonPocketCL.html">TransmonPocketCL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.TransmonPocket6.html">TransmonPocket6</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.TransmonPocketTeeth.html">TransmonPocketTeeth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.TunableCoupler01.html">TunableCoupler01</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.SQUID_LOOP.html">SQUID_LOOP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.StarQubit.html">StarQubit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qlibrary.anchored_path.html">anchored_path</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../apidocs/analyses.html">Analyses</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Analyses</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.analyses.QAnalysis.html">QAnalysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.analyses.QSimulation.html">QSimulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.analyses.Hcpb.html">Hcpb</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.analyses.Hcpb_analytic.html">Hcpb_analytic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.analyses.HO_wavefunctions.html">HO_wavefunctions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.analyses.transmon_analytics.html">transmon_analytics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.analyses.cpw_calculations.html">cpw_calculations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.analyses.kappa_calculation.html">kappa_calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.analyses.Sweeper.html">Sweeper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.analyses.LOManalysis.html">LOManalysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.analyses.EPRanalysis.html">EPRanalysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.analyses.lumped_capacitive.html">lumped_capacitive</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.analyses.LumpedElementsSim.html">LumpedElementsSim</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.analyses.EigenmodeSim.html">EigenmodeSim</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.analyses.ScatteringImpedanceSim.html">ScatteringImpedanceSim</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../apidocs/renderers.html">QRenderes</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of QRenderes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.renderers.QRenderer.html">QRenderer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.renderers.QRendererGui.html">QRendererGui</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.renderers.QRendererAnalysis.html">QRendererAnalysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.renderers.PlotCanvas.html">PlotCanvas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.renderers.MplInteraction.html">MplInteraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.renderers.ZoomOnWheel.html">ZoomOnWheel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.renderers.PanAndZoom.html">PanAndZoom</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.renderers.QMplRenderer.html">QMplRenderer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.renderers.AnimatedText.html">AnimatedText</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.renderers.QGDSRenderer.html">QGDSRenderer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.renderers.Cheesing.html">Cheesing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.renderers.QAnsysRenderer.html">QAnsysRenderer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.renderers.QHFSSRenderer.html">QHFSSRenderer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.renderers.QQ3DRenderer.html">QQ3DRenderer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.renderers.QPyaedt.html">QPyaedt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.renderers.QQ3DPyaedt.html">QQ3DPyaedt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.renderers.QHFSSPyaedt.html">QHFSSPyaedt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.renderers.QHFSSDrivenmodalPyaedt.html">QHFSSDrivenmodalPyaedt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.renderers.QHFSSEigenmodePyaedt.html">QHFSSEigenmodePyaedt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.renderers.QGmshRenderer.html">QGmshRenderer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.renderers.Vec3DArray.html">Vec3DArray</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../apidocs/toolbox_metal.html">Toolbox</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of Toolbox</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.toolbox_metal.QiskitMetalExceptions.html">QiskitMetalExceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.toolbox_metal.QiskitMetalDesignError.html">QiskitMetalDesignError</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.toolbox_metal.about.html">about</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.toolbox_metal.import_export.html">import_export</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.toolbox_metal.math_and_overrides.html">math_and_overrides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.toolbox_metal.parsing.html">parsing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.toolbox_metal.layer_stack_handler.html">layer_stack_handler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.toolbox_metal.bounds_for_path_and_poly_tables.html">bounds_for_path_and_poly_tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.toolbox_metal.determine_larger_box.html">determine_larger_box</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../apidocs/qgeometries.html">QGeometry</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of QGeometry</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal.qgeometries.QGeometryTables.html">QGeometryTables</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../apidocs/gui.html">GUI</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of GUI</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../apidocs/qiskit_metal._gui.MetalGUI.html">MetalGUI</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Qiskit/qiskit/blob/master/CODE_OF_CONDUCT.md">Code of Conduct</a></li>
</ul>

</div></div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <h1>Source code for qiskit_metal.renderers.renderer_gds.gds_renderer</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># This code is part of Qiskit.</span>
<span class="c1">#</span>
<span class="c1"># (C) Copyright IBM 2017, 2021.</span>
<span class="c1">#</span>
<span class="c1"># This code is licensed under the Apache License, Version 2.0. You may</span>
<span class="c1"># obtain a copy of this license in the LICENSE.txt file in the root directory</span>
<span class="c1"># of this source tree or at http://www.apache.org/licenses/LICENSE-2.0.</span>
<span class="c1">#</span>
<span class="c1"># Any modifications or derivative works of this code must retain this</span>
<span class="c1"># copyright notice, and modified files need to carry a notice indicating</span>
<span class="c1"># that they have been altered from the originals.</span>
<span class="sd">&quot;&quot;&quot;This module has a QRenderer to export QDesign to a GDS file.&quot;&quot;&quot;</span>
<span class="c1"># pylint: disable=too-many-lines</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">copy</span><span class="w"> </span><span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">operator</span><span class="w"> </span><span class="kn">import</span> <span class="n">itemgetter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span> <span class="k">as</span> <span class="n">DictType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">gdstk</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shapely</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.spatial</span><span class="w"> </span><span class="kn">import</span> <span class="n">distance</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">shapely.geometry</span><span class="w"> </span><span class="kn">import</span> <span class="n">LineString</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit_metal</span><span class="w"> </span><span class="kn">import</span> <span class="n">draw</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit_metal.renderers.renderer_base</span><span class="w"> </span><span class="kn">import</span> <span class="n">QRenderer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit_metal.renderers.renderer_gds.make_cheese</span><span class="w"> </span><span class="kn">import</span> <span class="n">Cheesing</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qiskit_metal.toolbox_metal.parsing</span><span class="w"> </span><span class="kn">import</span> <span class="n">is_true</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">...</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..</span><span class="w"> </span><span class="kn">import</span> <span class="n">config</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">is_building_docs</span><span class="p">():</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">qiskit_metal.toolbox_python.utility_functions</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
        <span class="n">can_write_to_path</span><span class="p">,</span>
        <span class="n">get_range_of_vertex_to_not_fillet</span><span class="p">,</span>
    <span class="p">)</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="c1"># For linting typechecking, import modules that can&#39;t be loaded here under normal conditions.</span>
    <span class="c1"># For example, I can&#39;t import QDesign, because it requires QRenderer first. We have the</span>
    <span class="c1"># chicken and egg issue.</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">qiskit_metal.designs</span><span class="w"> </span><span class="kn">import</span> <span class="n">QDesign</span>


<div class="viewcode-block" id="QGDSRenderer">
<a class="viewcode-back" href="../../../../apidocs/qiskit_metal.renderers.QGDSRenderer.html#qiskit_metal.renderers.QGDSRenderer">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">QGDSRenderer</span><span class="p">(</span><span class="n">QRenderer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extends QRenderer to export GDS formatted files. The methods which a</span>
<span class="sd">    user will need for GDS export should be found within this class.</span>

<span class="sd">    All chips within design should be exported to one gds file.</span>
<span class="sd">    For the &quot;subtraction box&quot;:</span>
<span class="sd">    1. If user wants to export the entire design, AND if the base class of</span>
<span class="sd">    QDesign._chips[chip_name][&#39;size&#39;] has dict following below example:</span>
<span class="sd">    {&#39;center_x&#39;: 0.0, &#39;center_y&#39;: 0.0, &#39;size_x&#39;: 9, &#39;size_y&#39;: 6}</span>
<span class="sd">    then this box will be used for every layer within a chip.</span>

<span class="sd">    2. If user wants to export entire design, BUT there is no information in</span>
<span class="sd">    QDesign._chips[chip_name][&#39;size&#39;], then the renderer will calculate the</span>
<span class="sd">    size of all of the components and use that size for the &quot;subtraction box&quot;</span>
<span class="sd">    for every layer within a chip.</span>

<span class="sd">    3. If user wants to export a list of explicit components, the bounding</span>
<span class="sd">    box will be calculated by size of QComponents in the QGeometry table.</span>
<span class="sd">    Then be scaled by bounding_box_scale_x and bounding_box_scale_y.</span>

<span class="sd">    4. Note: When using the Junction table, the cell for Junction should</span>
<span class="sd">    be &quot;x-axis&quot; aligned and then GDS rotates based on LineString given</span>
<span class="sd">    in Junction table.</span>


<span class="sd">    datatype:</span>
<span class="sd">        * 10 Polygon</span>
<span class="sd">        * 11 Flexpath</span>

<span class="sd">    Default Options:</span>
<span class="sd">        * short_segments_to_not_fillet: &#39;True&#39;</span>
<span class="sd">        * check_short_segments_by_scaling_fillet: &#39;2.0&#39;</span>
<span class="sd">        * gds_unit: &#39;1&#39;</span>
<span class="sd">        * ground_plane: &#39;True&#39;</span>
<span class="sd">        * negative_mask: Dict(main=[])</span>
<span class="sd">        * corners: &#39;natural&#39;</span>
<span class="sd">        * tolerance: &#39;0.00001&#39;</span>
<span class="sd">        * precision: &#39;0.000000001&#39;</span>
<span class="sd">        * width_LineString: &#39;10um&#39;</span>
<span class="sd">        * path_filename: &#39;../resources/Fake_Junctions.GDS&#39;</span>
<span class="sd">        * junction_pad_overlap: &#39;5um&#39;</span>
<span class="sd">        * max_points: &#39;199&#39;</span>
<span class="sd">        * fabricate: &#39;False&#39;</span>
<span class="sd">        * cheese: Dict</span>
<span class="sd">            * datatype: &#39;100&#39;</span>
<span class="sd">            * shape: &#39;0&#39;</span>
<span class="sd">            * cheese_0_x: &#39;50um&#39;</span>
<span class="sd">            * cheese_0_y: &#39;50um&#39;</span>
<span class="sd">            * cheese_1_radius: &#39;100um&#39;</span>
<span class="sd">            * delta_x=&#39;100um&#39;,</span>
<span class="sd">            * delta_y=&#39;100um&#39;,</span>
<span class="sd">            * edge_nocheese=&#39;200um&#39;,</span>
<span class="sd">            * view_in_file: Dict(main={1: True})</span>
<span class="sd">        * no_cheese: Dict</span>
<span class="sd">            * datatype: &#39;99&#39;</span>
<span class="sd">            * buffer: &#39;25um&#39;</span>
<span class="sd">            * cap_style: &#39;2&#39;</span>
<span class="sd">            * join_style: &#39;2&#39;</span>
<span class="sd">            * view_in_file: Dict(main={1: True})</span>
<span class="sd">        * bounding_box_scale_x: &#39;1.2&#39;</span>
<span class="sd">        * bounding_box_scale_y: &#39;1.2&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Default options, over-written by passing ``options` dict to</span>
    <span class="c1"># render_options.</span>
    <span class="c1"># Type: Dict[str, str]</span>
    <span class="n">default_options</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span>
        <span class="c1"># Before converting LINESTRING to FlexPath for GDS, check for fillet</span>
        <span class="c1"># errors for LINESTRINGS in QGeometry in QGeometry due to short</span>
        <span class="c1"># segments.  If true, break up the LINESTRING so any segment which is</span>
        <span class="c1"># shorter than the scaled-fillet by &quot;fillet_scale_factor&quot; will be</span>
        <span class="c1"># separated so the short segment will not be fillet&#39;ed.</span>
        <span class="n">short_segments_to_not_fillet</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span>
        <span class="n">check_short_segments_by_scaling_fillet</span><span class="o">=</span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
        <span class="c1"># DO NOT MODIFY `gds_unit`. Gets overwritten by ``set_units``.</span>
        <span class="c1"># gdstk unit is 1 meter.  gds_units appear to ONLY be used during</span>
        <span class="c1"># write_gds().  Note that gds_unit will be overwritten from the design</span>
        <span class="c1"># units, during init().</span>
        <span class="c1"># Moving to Gdstk, the default unit is 1 µm (10⁻⁶ m), but we overwrite this.</span>
        <span class="c1"># WARNING: this cannot be changed since it is only used during the</span>
        <span class="c1"># init once.</span>
        <span class="n">gds_unit</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>  <span class="c1"># 1m (one meter, if you want to set 1 um, set 1e-6)</span>
        <span class="c1"># Implement creating a ground plane which is scaled from largest</span>
        <span class="c1"># bounding box, then QGeometry which is marked as subtract will be</span>
        <span class="c1"># removed from ground_plane.  Then the balance of QGeometry will be</span>
        <span class="c1"># placed placed in same layer as ground_plane.</span>
        <span class="n">ground_plane</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span>
        <span class="c1"># By default, export_to_gds() will create a positive_mask for every</span>
        <span class="c1"># chip and layer.  Within the Dict, there needs to be an entry for each</span>
        <span class="c1"># chip.  Each chip has a list of layers that should export as a</span>
        <span class="c1"># negative mask.  If layer number in list, the mask will be negative</span>
        <span class="c1"># for that layer.  If user wants to export to a negative_mask for all</span>
        <span class="c1"># layers, every layer_number MUST be in list.</span>
        <span class="n">negative_mask</span><span class="o">=</span><span class="n">Dict</span><span class="p">(</span><span class="n">main</span><span class="o">=</span><span class="p">[]),</span>
        <span class="c1"># For the gds file, Show/Don&#39;t Show intermediate steps?</span>
        <span class="c1"># If false, show the intermediate steps in the exported gds file.</span>
        <span class="c1"># If true, show the geometries on either neg_datatype_fabricate or pos_datatype_fabricate.</span>
        <span class="c1">#   Example:  # denotes the layer number</span>
        <span class="c1">#           delete for negative mask: TOP_main_#_NoCheese_99, TOP_main_#_one_hole</span>
        <span class="c1">#           delete for positive mask: TOP_main_#_NoCheese_99, TOP_main_#_one_hole,</span>
        <span class="c1">#                                       ground_main_#</span>
        <span class="n">fabricate</span><span class="o">=</span><span class="s2">&quot;False&quot;</span><span class="p">,</span>
        <span class="c1"># corners: (&quot;natural&quot;, &quot;miter&quot;, &quot;bevel&quot;, &quot;round&quot;, &quot;smooth&quot;, callable)</span>
        <span class="c1"># Type of joins. A callable must receive 6 arguments</span>
        <span class="c1"># (vertex and direction vector from both segments being joined,</span>
        <span class="c1"># the center and width of the path)</span>
        <span class="c1"># and return a list of vertices that make the join.</span>
        <span class="c1"># A list can be used to define the join for each parallel path.</span>
        <span class="n">corners</span><span class="o">=</span><span class="s2">&quot;natural&quot;</span><span class="p">,</span>
        <span class="c1"># tolerance &gt; precision</span>
        <span class="c1"># Precision used for gds lib, boolean operations and FlexPath should</span>
        <span class="c1"># likely be kept the same.  They can be different, but increases odds</span>
        <span class="c1"># of weird artifacts or misalignment.  Some of this occurs regardless</span>
        <span class="c1"># (might be related to offset of a curve when done as a</span>
        <span class="c1"># boolean vs. rendered), but they are &lt;&lt;1nm, which isn&#39;t even picked</span>
        <span class="c1"># up by any fab equipment (so can be ignored).  Numerical errors start</span>
        <span class="c1"># to pop up if set precision too fine,</span>
        <span class="c1"># but 1nm seems to be the finest precision we use anyhow.</span>
        <span class="c1"># FOR NOW SPECIFY IN METERS.</span>
        <span class="n">tolerance</span><span class="o">=</span><span class="s2">&quot;0.00001&quot;</span><span class="p">,</span>  <span class="c1"># 10.0 um</span>
        <span class="c1"># With input from fab people, any of the weird artifacts</span>
        <span class="c1"># (like unwanted gaps) that are less than 1nm in size can be ignored.</span>
        <span class="c1"># They don&#39;t even show up in the fabricated masks.</span>
        <span class="c1"># So, the precision of e-9 (so 1 nm) should be good as a default.</span>
        <span class="c1"># FOR NOW SPECIFY IN METERS.</span>
        <span class="n">precision</span><span class="o">=</span><span class="s2">&quot;0.000000001&quot;</span><span class="p">,</span>  <span class="c1"># 1.0 nm</span>
        <span class="c1"># Since Qiskit Metal GUI, does not require a width for LineString, GDS,</span>
        <span class="c1"># will provide a default value.</span>
        <span class="n">width_LineString</span><span class="o">=</span><span class="s2">&quot;10um&quot;</span><span class="p">,</span>
        <span class="c1"># The file is expected to be in GDS format.  The cell will be placed</span>
        <span class="c1"># into gds Metal output without being edited. The name of the cell can</span>
        <span class="c1"># be placed as options for a component, i.e. placing within a qubit.</span>
        <span class="c1"># During export, the cell will NOT be edited, just imported.</span>
        <span class="n">path_filename</span><span class="o">=</span><span class="s2">&quot;../resources/Fake_Junctions.GDS&quot;</span><span class="p">,</span>
        <span class="c1"># For junction table, when cell from default_options.path_filename does</span>
        <span class="c1"># not fit into linestring, QGDSRender will create two pads and add to</span>
        <span class="c1"># junction to fill the location of lineString.  The junction_pad_overlap</span>
        <span class="c1"># is from the junction cell to the newly created pads.</span>
        <span class="n">junction_pad_overlap</span><span class="o">=</span><span class="s2">&quot;5um&quot;</span><span class="p">,</span>
        <span class="c1"># Vertex limit for FlexPath</span>
        <span class="c1"># max_points (integer) – If the number of points in the polygonal path</span>
        <span class="c1"># boundary is greater than max_points, it will be fractured in smaller</span>
        <span class="c1"># polygons with at most max_points each. If max_points is zero,</span>
        <span class="c1"># no fracture will occur. GDSII used 199 as the default because the historical</span>
        <span class="c1"># max value of vertices for a poly/path was 199 (fabrication equipment</span>
        <span class="c1"># restrictions).  The hard max limit that a GDSII file can</span>
        <span class="c1"># handle is 8191. Gdstk allows arbitary numbers as does most modern software.</span>
        <span class="n">max_points</span><span class="o">=</span><span class="s2">&quot;199&quot;</span><span class="p">,</span>
        <span class="c1"># Cheesing is denoted by each chip and layer.</span>
        <span class="n">cheese</span><span class="o">=</span><span class="n">Dict</span><span class="p">(</span>
            <span class="c1"># Cheesing is NOT completed</span>
            <span class="n">datatype</span><span class="o">=</span><span class="s2">&quot;100&quot;</span><span class="p">,</span>
            <span class="c1"># Expect to mostly cheese a square, but allow for expansion.</span>
            <span class="c1"># 0 is rectangle, 1 is circle</span>
            <span class="n">shape</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
            <span class="c1"># rectangle</span>
            <span class="n">cheese_0_x</span><span class="o">=</span><span class="s2">&quot;25um&quot;</span><span class="p">,</span>
            <span class="n">cheese_0_y</span><span class="o">=</span><span class="s2">&quot;25um&quot;</span><span class="p">,</span>
            <span class="c1"># circle</span>
            <span class="n">cheese_1_radius</span><span class="o">=</span><span class="s2">&quot;100um&quot;</span><span class="p">,</span>
            <span class="c1"># Identify which layers to view in gds output file, for each chip</span>
            <span class="n">view_in_file</span><span class="o">=</span><span class="n">Dict</span><span class="p">(</span><span class="n">main</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="kc">True</span><span class="p">}),</span>
            <span class="c1"># delta spacing between holes</span>
            <span class="n">delta_x</span><span class="o">=</span><span class="s2">&quot;100um&quot;</span><span class="p">,</span>
            <span class="n">delta_y</span><span class="o">=</span><span class="s2">&quot;100um&quot;</span><span class="p">,</span>
            <span class="c1"># Keep a buffer around the perimeter of chip, that will</span>
            <span class="c1"># not need cheesing.</span>
            <span class="n">edge_nocheese</span><span class="o">=</span><span class="s2">&quot;200um&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="c1"># Think of this as a keep-out region for cheesing.</span>
        <span class="n">no_cheese</span><span class="o">=</span><span class="n">Dict</span><span class="p">(</span>
            <span class="c1"># For every layer, if there is a ground plane, do cheesing and</span>
            <span class="c1"># place the output on the datatype number (sub-layer number)</span>
            <span class="n">datatype</span><span class="o">=</span><span class="s2">&quot;99&quot;</span><span class="p">,</span>
            <span class="n">buffer</span><span class="o">=</span><span class="s2">&quot;25um&quot;</span><span class="p">,</span>
            <span class="c1"># The styles of caps are specified by integer values:</span>
            <span class="c1"># 1 (round), 2 (flat), 3 (square).</span>
            <span class="n">cap_style</span><span class="o">=</span><span class="s2">&quot;2&quot;</span><span class="p">,</span>
            <span class="c1"># The styles of joins between offset segments are specified by</span>
            <span class="c1"># integer values:</span>
            <span class="c1"># 1 (round), 2 (mitre), and 3 (bevel).</span>
            <span class="n">join_style</span><span class="o">=</span><span class="s2">&quot;2&quot;</span><span class="p">,</span>
            <span class="c1"># Identify which layers to view in gds output file, for each chip</span>
            <span class="n">view_in_file</span><span class="o">=</span><span class="n">Dict</span><span class="p">(</span><span class="n">main</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="kc">True</span><span class="p">}),</span>
        <span class="p">),</span>
        <span class="c1"># (float): Scale box of components to render.</span>
        <span class="c1"># Should be greater than 1.0.  For benefit of the GUI, keep this the</span>
        <span class="c1"># last entry in the dict.  GUI shows a note regarding bound_box.</span>
        <span class="n">bounding_box_scale_x</span><span class="o">=</span><span class="s2">&quot;1.2&quot;</span><span class="p">,</span>
        <span class="n">bounding_box_scale_y</span><span class="o">=</span><span class="s2">&quot;1.2&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Default options&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;gds&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Name&quot;&quot;&quot;</span>

    <span class="c1"># When additional columns are added to QGeometry,</span>
    <span class="c1"># this is the example to populate it.</span>
    <span class="c1"># e.g. element_extensions = dict(</span>
    <span class="c1">#         base=dict(color=str, klayer=int),</span>
    <span class="c1">#         path=dict(thickness=float, material=str, perfectE=bool),</span>
    <span class="c1">#         poly=dict(thickness=float, material=str), )</span>
    <span class="c1"># &quot;&quot;&quot;element extensions dictionary from base class:</span>
    <span class="c1">#    element_extensions = dict() &quot;&quot;&quot;</span>

    <span class="c1"># Add columns to junction table during QGDSRenderer.load()</span>
    <span class="c1"># element_extensions  is now being populated as part of load().</span>
    <span class="c1"># Determined from element_table_data.</span>

    <span class="c1"># Dict structure MUST be same as  element_extensions!!!!!!</span>
    <span class="c1"># This dict will be used to update QDesign during init of renderer.</span>
    <span class="c1"># Keeping this as a cls dict so could be edited before renderer is</span>
    <span class="c1"># instantiated.  To update component.options junction table.</span>

    <span class="n">element_table_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="c1"># Cell_name must exist in gds file with: path_filename</span>
        <span class="n">junction</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">cell_name</span><span class="o">=</span><span class="s2">&quot;my_other_junction&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Element table data&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">design</span><span class="p">:</span> <span class="s2">&quot;QDesign&quot;</span><span class="p">,</span>
        <span class="n">initiate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">render_template</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">render_options</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a QRenderer for GDS interface: export and import.</span>

<span class="sd">        Args:</span>
<span class="sd">            design (QDesign): Use QGeometry within QDesign  to obtain elements</span>
<span class="sd">                            for GDS file.</span>
<span class="sd">            initiate (bool, optional): True to initiate the renderer.</span>
<span class="sd">                                        Defaults to True.</span>
<span class="sd">            render_template (Dict, optional): Typically used by GUI for</span>
<span class="sd">                                template options for GDS.  Defaults to None.</span>
<span class="sd">            render_options (Dict, optional): Used to override all options.</span>
<span class="sd">                                            Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">design</span><span class="o">=</span><span class="n">design</span><span class="p">,</span>
            <span class="n">initiate</span><span class="o">=</span><span class="n">initiate</span><span class="p">,</span>
            <span class="n">render_template</span><span class="o">=</span><span class="n">render_template</span><span class="p">,</span>
            <span class="n">render_options</span><span class="o">=</span><span class="n">render_options</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">gdstk</span><span class="o">.</span><span class="n">Library</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_gds_library</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dict_bounds</span><span class="p">:</span> <span class="n">DictType</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span>

        <span class="c1"># Updated each time export_to_gds() is called.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">:</span> <span class="n">DictType</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># check the scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_bounding_box_scale</span><span class="p">()</span>

        <span class="c1"># if imported, hold the path to file name, otherwise None.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imported_junction_gds</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># track only once</span>

        <span class="n">QGDSRenderer</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_initiate_renderer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Not used by the gds renderer at this time. Only returns True.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_close_renderer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Not used by the gds renderer at this time. Only returns True.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

<div class="viewcode-block" id="QGDSRenderer.render_design">
<a class="viewcode-back" href="../../../../apidocs/qiskit_metal.renderers.QGDSRenderer.html#qiskit_metal.renderers.QGDSRenderer.render_design">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">render_design</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Export the design to GDS.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">export_to_gds</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">design</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">highlight_qcomponents</span><span class="o">=</span><span class="p">[])</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_check_bounding_box_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Some error checking for bounding_box_scale_x and</span>
<span class="sd">        bounding_box_scale_y numbers.&quot;&quot;&quot;</span>
        <span class="n">bounding_box_scale_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">bounding_box_scale_x</span><span class="p">)</span>
        <span class="n">bounding_box_scale_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">bounding_box_scale_y</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bounding_box_scale_x</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;bounding_box_scale_x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">QGDSRenderer</span><span class="o">.</span><span class="n">default_options</span><span class="o">.</span><span class="n">bounding_box_scale_x</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Expected float and number greater than or equal to&quot;</span>
                <span class="s2">&quot; 1.0 for bounding_box_scale_x. User&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;provided bounding_box_scale_x = </span><span class="si">{</span><span class="n">bounding_box_scale_x</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="s2">&quot;, using default_options.bounding_box_scale_x.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bounding_box_scale_y</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;bounding_box_scale_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">QGDSRenderer</span><span class="o">.</span><span class="n">default_options</span><span class="o">.</span><span class="n">bounding_box_scale_y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Expected float and number greater than or equal to 1.0 for &quot;</span>
                <span class="s2">&quot;bounding_box_scale_y.  User provided &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;bounding_box_scale_y = </span><span class="si">{</span><span class="n">bounding_box_scale_y</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="s2">&quot;using default_options.bounding_box_scale_y.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_can_write_to_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if can write file.</span>

<span class="sd">        Args:</span>
<span class="sd">            file (str): Has the path and/or just the file name.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: 1 if access is allowed. Else returns 0, if access not given.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">directory_name</span> <span class="o">=</span> <span class="n">can_write_to_path</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>  <span class="c1"># pylint: disable=possibly-used-before-assignment</span>
        <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Not able to write to directory.&quot;</span>
                            <span class="sa">f</span><span class="s1">&#39;File:&quot;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1">&quot; not written.&#39;</span>
                            <span class="sa">f</span><span class="s1">&#39; Checked directory:&quot;</span><span class="si">{</span><span class="n">directory_name</span><span class="si">}</span><span class="s1">&quot;.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the options in the units.</span>

<span class="sd">        Warning: DOES NOT CHANGE THE CURRENT LIB</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;gds_unit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">design</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="s2">&quot;1 meter&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_separate_subtract_shapes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chip_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                  <span class="n">table</span><span class="p">:</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;For each chip and table, separate them by subtract being either True</span>
<span class="sd">        or False. Names of chip and table should be same as the QGeometry</span>
<span class="sd">        tables.</span>

<span class="sd">        Args:</span>
<span class="sd">            chip_name (str): Name of &quot;chip&quot;.  Example is &quot;main&quot;.</span>
<span class="sd">            table_name (str): Name for &quot;table&quot;.  Example is &quot;poly&quot;, and &quot;path&quot;.</span>
<span class="sd">            table (geopandas.GeoSeries): Table with similar qgeometries.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=singleton-comparison</span>
        <span class="n">subtract_true</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;subtract&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>

        <span class="n">subtract_false</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;subtract&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">]</span>

        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">chip_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">_subtract_true&quot;</span><span class="p">,</span> <span class="n">subtract_true</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">chip_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">_subtract_false&quot;</span><span class="p">,</span>
                <span class="n">subtract_false</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_bounds</span><span class="p">(</span>
        <span class="n">gs_table</span><span class="p">:</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the bounds for all of the elements in gs_table.</span>

<span class="sd">        Args:</span>
<span class="sd">            gs_table (geopandas.GeoDataFrame): A GeoPandas GeoDataFrame used to describe</span>
<span class="sd">                                        components in a design.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[float, float, float, float]: The bounds of all of the</span>
<span class="sd">            elements in this table. [minx, miny, maxx, maxy]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gs_table</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">gs_table</span><span class="o">.</span><span class="n">total_bounds</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_inclusive_bound</span><span class="p">(</span><span class="n">all_bounds</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Given a list of tuples which describe corners of a box, i.e. (minx,</span>
<span class="sd">        miny, maxx, maxy). This method will find the box, which will include</span>
<span class="sd">        all boxes.  In another words, the smallest minx and miny; and the</span>
<span class="sd">        largest maxx and maxy.</span>

<span class="sd">        Args:</span>
<span class="sd">            all_bounds (list): List of bounds. Each tuple corresponds to a box.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: Describe a box which includes the area of each box</span>
<span class="sd">            in all_bounds.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># If given an empty list.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_bounds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

        <span class="n">inclusive_tuple</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">min</span><span class="p">(</span><span class="n">all_bounds</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">],</span>
            <span class="nb">min</span><span class="p">(</span><span class="n">all_bounds</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))[</span><span class="mi">1</span><span class="p">],</span>
            <span class="nb">max</span><span class="p">(</span><span class="n">all_bounds</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">2</span><span class="p">))[</span><span class="mi">2</span><span class="p">],</span>
            <span class="nb">max</span><span class="p">(</span><span class="n">all_bounds</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">3</span><span class="p">))[</span><span class="mi">3</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">inclusive_tuple</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_midpoint_xy</span><span class="p">(</span><span class="n">x_1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y_1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">x_2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                     <span class="n">y_2</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the center of a line segment with endpoints (x1,y1) and</span>
<span class="sd">        (x2,y2).</span>

<span class="sd">        Args:</span>
<span class="sd">            x1 (float): x of endpoint (x1,y1)</span>
<span class="sd">            y1 (float): y of endpoint (x1,y1)</span>
<span class="sd">            x2 (float): x of endpoint (x2,y2)</span>
<span class="sd">            y2 (float): y of endpoint (x2,y2)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[float, float]:</span>
<span class="sd">            1st float: x for midpoint</span>
<span class="sd">            2nd float: y for midpoint</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">midx</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_1</span> <span class="o">+</span> <span class="n">x_2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">midy</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_1</span> <span class="o">+</span> <span class="n">y_2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="k">return</span> <span class="n">midx</span><span class="p">,</span> <span class="n">midy</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_scale_max_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chip_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                          <span class="n">all_bounds</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Given the list of tuples to represent all of the bounds for path,</span>
<span class="sd">        poly, etc. This will return the scaled using self.bounding_box_scale_x</span>
<span class="sd">        and self.bounding_box_scale_y, and the max bounds of the tuples</span>
<span class="sd">        provided.</span>

<span class="sd">        Args:</span>
<span class="sd">            chip_name (str): Name of chip.</span>
<span class="sd">            all_bounds (list): Each tuple=(minx, miny, maxx, maxy) in list</span>
<span class="sd">                            represents bounding box for poly, path, etc.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[tuple, tuple]:</span>
<span class="sd">            first tuple: A scaled bounding box which includes all paths, polys, etc.;</span>
<span class="sd">            second tuple: A  bounding box which includes all paths, polys, etc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If given an empty list.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_bounds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

        <span class="c1"># Get an inclusive bounding box to contain all of the tuples provided.</span>
        <span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inclusive_bound</span><span class="p">(</span><span class="n">all_bounds</span><span class="p">)</span>

        <span class="c1"># Center of inclusive bounding box</span>
        <span class="n">center_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">minx</span> <span class="o">+</span> <span class="n">maxx</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">center_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">miny</span> <span class="o">+</span> <span class="n">maxy</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">scaled_width</span> <span class="o">=</span> <span class="p">(</span><span class="n">maxx</span> <span class="o">-</span> <span class="n">minx</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">bounding_box_scale_x</span><span class="p">)</span>
        <span class="n">scaled_height</span> <span class="o">=</span> <span class="p">(</span><span class="n">maxy</span> <span class="o">-</span> <span class="n">miny</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">bounding_box_scale_y</span><span class="p">)</span>

        <span class="c1"># Scaled inclusive bounding box by self.options.bounding_box_scale_x</span>
        <span class="c1">#  and self.options.bounding_box_scale_y.</span>
        <span class="n">scaled_box</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">center_x</span> <span class="o">-</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">scaled_width</span><span class="p">),</span>
            <span class="n">center_y</span> <span class="o">-</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">scaled_height</span><span class="p">),</span>
            <span class="n">center_x</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">scaled_width</span><span class="p">),</span>
            <span class="n">center_y</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">scaled_height</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dict_bounds</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="s2">&quot;scaled_box&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaled_box</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_bounds</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="s2">&quot;inclusive_box&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">scaled_box</span><span class="p">,</span> <span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_qcomps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">highlight_qcomponents</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Confirm the list doesn&#39;t have names of components repeated. Confirm</span>
<span class="sd">        that the name of component exists in QDesign.</span>

<span class="sd">        Args:</span>
<span class="sd">            highlight_qcomponents (list, optional): List of strings which</span>
<span class="sd">                                        denote the name of QComponents to render.</span>
<span class="sd">                                        Empty list means to render entire design.</span>
<span class="sd">                                        Defaults to [].</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[list, int]:</span>
<span class="sd">            list: Unique list of QComponents to render.</span>
<span class="sd">            int: 0 if all ended well. Otherwise,</span>
<span class="sd">            1 if QComponent name not in design.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">highlight_qcomponents</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">highlight_qcomponents</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Remove identical QComponent names.</span>
        <span class="n">unique_qcomponents</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">highlight_qcomponents</span><span class="p">))</span>

        <span class="c1"># Confirm all QComponent are in design.</span>
        <span class="k">for</span> <span class="n">qcomp</span> <span class="ow">in</span> <span class="n">unique_qcomponents</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">qcomp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">design</span><span class="o">.</span><span class="n">name_to_id</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The component=</span><span class="si">{</span><span class="n">qcomp</span><span class="si">}</span><span class="s2"> in highlight_qcomponents not&quot;</span>
                    <span class="s2">&quot; in QDesign. The GDS data not generated.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">unique_qcomponents</span><span class="p">,</span> <span class="mi">1</span>

        <span class="c1"># For Subtraction bounding box.</span>
        <span class="c1"># If list passed to export is the whole chip, then want to use the</span>
        <span class="c1"># bounding box from design planar.  If list is subset of chip, then</span>
        <span class="c1"># calculate a custom bounding box and scale it.</span>

        <span class="c1"># pylint: disable=protected-access</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_qcomponents</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">design</span><span class="o">.</span><span class="n">_components</span><span class="p">):</span>
            <span class="c1"># Since user wants all of the chip to be rendered, use the</span>
            <span class="c1"># design.planar bounding box.</span>
            <span class="n">unique_qcomponents</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">return</span> <span class="n">unique_qcomponents</span><span class="p">,</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_qgeometry_for_gds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                  <span class="n">highlight_qcomponents</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Using self.design, this method does the following:</span>

<span class="sd">        1. Gather the QGeometries to be used to write to file.</span>
<span class="sd">           Duplicate names in highlight_qcomponents will be removed without</span>
<span class="sd">           warning.</span>

<span class="sd">        2. Populate self.dict_bounds, for each chip, contains the maximum bound</span>
<span class="sd">           for all elements to render.</span>

<span class="sd">        3. Calculate scaled bounding box to emulate size of chip using</span>
<span class="sd">           self.bounding_box_scale(x and y) and place into</span>
<span class="sd">           self.dict_bounds[chip_name][&#39;for_subtract&#39;].</span>

<span class="sd">        4. Gather Geometries to export to GDS format.</span>

<span class="sd">        Args:</span>
<span class="sd">            highlight_qcomponents (list): List of strings which denote the name</span>
<span class="sd">                            of QComponents to render.</span>
<span class="sd">                            If empty, render all components in design.</span>
<span class="sd">                            If QComponent names are duplicated,</span>
<span class="sd">                            duplicates will be ignored.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: 0 if all ended well.</span>
<span class="sd">            Otherwise, 1 if QComponent name(s) not in design.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">highlight_qcomponents</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">highlight_qcomponents</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">unique_qcomponents</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_qcomps</span><span class="p">(</span><span class="n">highlight_qcomponents</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_bounds</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">chip_name</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># put the QGeometry into GDS format.</span>
            <span class="c1"># There can be more than one chip in QGeometry.</span>
            <span class="c1"># They all export to one gds file.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="s2">&quot;all_subtract&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="s2">&quot;all_no_subtract&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dict_bounds</span><span class="p">[</span><span class="n">chip_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_bounds</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="s2">&quot;gather&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict_bounds</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="s2">&quot;for_subtract&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>
            <span class="n">all_table_subtracts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">all_table_no_subtracts</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">design</span><span class="o">.</span><span class="n">qgeometry</span><span class="o">.</span><span class="n">get_element_types</span><span class="p">():</span>
                <span class="c1"># Get table for chip and table_name, and reduce</span>
                <span class="c1"># to keep just the list of unique_qcomponents.</span>
                <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">unique_qcomponents</span><span class="p">,</span>
                                        <span class="n">chip_name</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">table_name</span> <span class="o">==</span> <span class="s2">&quot;junction&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="s2">&quot;junction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># For every chip, and layer, separate the &quot;subtract&quot;</span>
                    <span class="c1"># and &quot;no_subtract&quot; elements and gather bounds.</span>
                    <span class="c1"># self.dict_bounds[chip_name] = list_bounds</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_gather_subtract_elements_and_bounds</span><span class="p">(</span>
                        <span class="n">chip_name</span><span class="p">,</span>
                        <span class="n">table_name</span><span class="p">,</span>
                        <span class="n">table</span><span class="p">,</span>
                        <span class="n">all_table_subtracts</span><span class="p">,</span>
                        <span class="n">all_table_no_subtracts</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="c1"># If list of QComponents provided, use the</span>
            <span class="c1"># bounding_box_scale(x and y), otherwise use self._chips.</span>
            <span class="n">scaled_max_bound</span><span class="p">,</span> <span class="n">max_bound</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_max_bounds</span><span class="p">(</span>
                <span class="n">chip_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_bounds</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="s2">&quot;gather&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">highlight_qcomponents</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dict_bounds</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="s2">&quot;for_subtract&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaled_max_bound</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">chip_box</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">design</span><span class="o">.</span><span class="n">get_x_y_for_chip</span><span class="p">(</span><span class="n">chip_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dict_bounds</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="s2">&quot;for_subtract&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chip_box</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dict_bounds</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="s2">&quot;for_subtract&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_bound</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;design.get_x_y_for_chip() did NOT return a good &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;code for chip=</span><span class="si">{</span><span class="n">chip_name</span><span class="si">}</span><span class="s2">,for ground subtraction-box&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot; using the size calculated from QGeometry, &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">max_bound</span><span class="si">}</span><span class="s2">) will be used. &quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_true</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">ground_plane</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_handle_ground_plane</span><span class="p">(</span><span class="n">chip_name</span><span class="p">,</span> <span class="n">all_table_subtracts</span><span class="p">,</span>
                                          <span class="n">all_table_no_subtracts</span><span class="p">)</span>

        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_ground_plane</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chip_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">all_table_subtracts</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                             <span class="n">all_table_no_subtracts</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Place all the subtract geometries for one chip into</span>
<span class="sd">        self.chip_info[chip_name][&#39;all_subtract_true&#39;].</span>

<span class="sd">        For LINESTRING within table that has a value for fillet, check if any</span>
<span class="sd">        segment is shorter than fillet radius.  If so, then break the</span>
<span class="sd">        LINESTRING so that shorter segments do not get fillet&#39;ed and longer</span>
<span class="sd">        segments get fillet&#39;ed.  Add the multiple LINESTRINGS back to table.</span>
<span class="sd">        Also remove &quot;bad&quot; LINESTRING from table.</span>

<span class="sd">        Then use _qgeometry_to_gds() to convert the QGeometry elements to gdstk</span>
<span class="sd">        elements.  The gdstk elements are placed in</span>
<span class="sd">        self.chip_info[chip_name][&#39;q_subtract_true&#39;].</span>

<span class="sd">        Args:</span>
<span class="sd">            chip_name (str): Chip_name that is being processed.</span>
<span class="sd">            all_table_subtracts (list): Add to self.chip_info by layer number.</span>
<span class="sd">            all_table_no_subtracts (list): Add to self.chip_info by layer number.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fix_short_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">short_segments_to_not_fillet</span><span class="p">)</span>
        <span class="n">all_layers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">design</span><span class="o">.</span><span class="n">qgeometry</span><span class="o">.</span><span class="n">get_all_unique_layers</span><span class="p">(</span><span class="n">chip_name</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">chip_layer</span> <span class="ow">in</span> <span class="n">all_layers</span><span class="p">:</span>
            <span class="n">copy_subtract</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">copy_no_subtract</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">copy_subtract</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">all_table_subtracts</span><span class="p">)</span>
            <span class="n">copy_no_subtract</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">all_table_no_subtracts</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">copy_subtract</span><span class="p">:</span>
                <span class="n">item</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;layer&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">chip_layer</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">item_no</span> <span class="ow">in</span> <span class="n">copy_no_subtract</span><span class="p">:</span>
                <span class="n">item_no</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">item_no</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">item_no</span><span class="p">[</span><span class="s2">&quot;layer&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">chip_layer</span><span class="p">],</span>
                             <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="n">chip_layer</span><span class="p">][</span><span class="s2">&quot;all_subtract_true&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">geopandas</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
                    <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">copy_subtract</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="n">chip_layer</span><span class="p">][</span><span class="s2">&quot;all_subtract_false&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">geopandas</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
                    <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">copy_no_subtract</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="n">chip_layer</span><span class="p">][</span>
                <span class="s2">&quot;all_subtract_true&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="n">chip_layer</span><span class="p">][</span>
                <span class="s2">&quot;all_subtract_false&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">is_true</span><span class="p">(</span><span class="n">fix_short_segments</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fix_short_segments_within_table</span><span class="p">(</span><span class="n">chip_name</span><span class="p">,</span> <span class="n">chip_layer</span><span class="p">,</span>
                                                      <span class="s2">&quot;all_subtract_true&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fix_short_segments_within_table</span><span class="p">(</span><span class="n">chip_name</span><span class="p">,</span> <span class="n">chip_layer</span><span class="p">,</span>
                                                      <span class="s2">&quot;all_subtract_false&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="n">chip_layer</span><span class="p">][</span>
                <span class="s2">&quot;q_subtract_true&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="n">chip_layer</span><span class="p">][</span>
                    <span class="s2">&quot;all_subtract_true&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_qgeometry_to_gds</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="n">chip_layer</span><span class="p">][</span>
                <span class="s2">&quot;q_subtract_false&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="n">chip_layer</span><span class="p">][</span>
                    <span class="s2">&quot;all_subtract_false&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_qgeometry_to_gds</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Handling Fillet issues.</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_fix_short_segments_within_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chip_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">chip_layer</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                                         <span class="n">all_sub_true_or_false</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update self.chip_info geopandas.GeoDataFrame.</span>

<span class="sd">        Will iterate through the rows to examine the LineString.</span>
<span class="sd">        Then determine if there is a segment that is shorter than the criteria</span>
<span class="sd">        based on default_options. If so, then remove the row, and append</span>
<span class="sd">        shorter LineString with no fillet, within the dataframe.</span>

<span class="sd">        Args:</span>
<span class="sd">            chip_name (str): The name of chip.</span>
<span class="sd">            chip_layer (int): The layer within the chip to be evaluated.</span>
<span class="sd">            all_sub_true_or_false (str): To be used within self.chip_info:</span>
<span class="sd">                                &#39;all_subtract_true&#39; or &#39;all_subtract_false&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=too-many-locals</span>
        <span class="n">data_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="n">chip_layer</span><span class="p">][</span>
            <span class="n">all_sub_true_or_false</span><span class="p">]</span>
        <span class="n">df_fillet</span> <span class="o">=</span> <span class="n">data_frame</span><span class="p">[</span><span class="o">-</span><span class="n">data_frame</span><span class="p">[</span><span class="s2">&quot;fillet&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">df_fillet</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># Don&#39;t edit the table when iterating through the rows.</span>
            <span class="c1"># Save info in dict and then edit the table.</span>
            <span class="n">edit_index</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_fillet</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="c1"># print(</span>
                <span class="c1">#     f&#39;With parse_value: {self.parse_value(row.fillet)}, &#39;</span>
                <span class="c1">#     f&#39;row.fillet: {row.fillet}&#39;)</span>
                <span class="n">status</span><span class="p">,</span> <span class="n">all_shapelys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_length</span><span class="p">(</span>
                    <span class="n">row</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">fillet</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">status</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">edit_index</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_shapelys</span>

            <span class="n">df_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="n">chip_layer</span><span class="p">][</span>
                <span class="n">all_sub_true_or_false</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">del_key</span><span class="p">,</span> <span class="n">the_shapes</span> <span class="ow">in</span> <span class="n">edit_index</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># copy row &quot;index&quot; into a new data-frame &quot;status&quot; times.</span>
                <span class="c1"># Then replace the LONG shapely with all_shapelys.</span>
                <span class="c1"># For any entries in edit_index, edit table here.</span>
                <span class="n">orig_row</span> <span class="o">=</span> <span class="n">df_copy</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">del_key</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">df_copy</span> <span class="o">=</span> <span class="n">df_copy</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">del_key</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">dummy_new_row</span><span class="p">,</span> <span class="n">short_shape</span> <span class="ow">in</span> <span class="n">the_shapes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">orig_row</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">short_shape</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">]</span>
                    <span class="n">orig_row</span><span class="p">[</span><span class="s2">&quot;fillet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">short_shape</span><span class="p">[</span><span class="s2">&quot;fillet&quot;</span><span class="p">]</span>
                    <span class="c1"># Keep ignore_index=False, otherwise,</span>
                    <span class="c1"># the other del_key will not be found.</span>
                    <span class="n">df_copy</span> <span class="o">=</span> <span class="n">df_copy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orig_row</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="n">chip_layer</span><span class="p">][</span>
                <span class="n">all_sub_true_or_false</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_shapely</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">LineString</span><span class="p">,</span>
                      <span class="n">a_fillet</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine if a_shapely has short segments based on scaled fillet</span>
<span class="sd">        value.</span>

<span class="sd">        Use check_short_segments_by_scaling_fillet to determine the criteria</span>
<span class="sd">        for flagging a segment.  Return Tuple with flagged segments.</span>

<span class="sd">        The &quot;status&quot; returned in int:</span>
<span class="sd">            * -1: Method needs to update the return code.</span>
<span class="sd">            * 0: No issues, no short segments found</span>
<span class="sd">            * int: The number of shapelys returned. New shapelys, should</span>
<span class="sd">                    replace the ones provided in a_shapely</span>

<span class="sd">        The &quot;shorter_lines&quot; returned in dict:</span>
<span class="sd">        key: Using the index values from list(a_shapely.coords)</span>
<span class="sd">        value: dict() for each new, shorter, LineString</span>

<span class="sd">        The dict()</span>
<span class="sd">        key: fillet, value: can be float from before, or undefined to</span>
<span class="sd">                            denote no fillet.</span>
<span class="sd">        key: line, value: shorter LineString</span>

<span class="sd">        Args:</span>
<span class="sd">            a_shapely (shapely.geometry.LineString): A shapely object that</span>
<span class="sd">                                                    needs to be evaluated.</span>
<span class="sd">            a_fillet (float): From component developer.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[int, Dict]:</span>
<span class="sd">            int: Number of short segments that should not have fillet.</span>
<span class="sd">            Dict: The key is an index into a_shapely. The value is a dict with</span>
<span class="sd">            fillet and shorter LineString.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=too-many-locals</span>
        <span class="c1"># pylint: disable=too-many-arguments</span>
        <span class="c1"># pylint: disable=too-many-statements</span>
        <span class="c1"># pylint: disable=too-many-branches</span>

        <span class="c1"># Holds all of the index of when a segment is too short.</span>
        <span class="n">idx_bad_fillet</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">status</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># Initialize to meaningless value.</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">a_shapely</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="n">len_coords</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>

        <span class="n">all_idx_bad_fillet</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_identify_vertex_not_to_fillet</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">a_fillet</span><span class="p">,</span>
                                            <span class="n">all_idx_bad_fillet</span><span class="p">)</span>

        <span class="n">shorter_lines</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="n">idx_bad_fillet</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">all_idx_bad_fillet</span><span class="p">[</span><span class="s2">&quot;reduced_idx&quot;</span><span class="p">])</span>
        <span class="n">status</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_bad_fillet</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
            <span class="n">midpoints</span> <span class="o">=</span> <span class="n">all_idx_bad_fillet</span><span class="p">[</span><span class="s2">&quot;midpoints&quot;</span><span class="p">]</span>
            <span class="n">no_fillet_vertices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="n">fillet_vertices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

            <span class="c1"># Gather the no-fillet segments</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">idx_bad_fillet</span><span class="p">):</span>
                <span class="n">no_fillet_vertices</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">start</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># The first segment.</span>
                    <span class="k">if</span> <span class="n">stop</span> <span class="o">==</span> <span class="n">len_coords</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># Every vertex should not be fillet&#39;d</span>
                        <span class="n">no_fillet_vertices</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">len_coords</span><span class="p">]</span>
                        <span class="n">shorter_lines</span><span class="p">[</span><span class="n">stop</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span>
                            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">LineString</span><span class="p">(</span><span class="n">no_fillet_vertices</span><span class="p">),</span>
                            <span class="s2">&quot;fillet&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">),</span>
                        <span class="p">})</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">no_fillet_vertices</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="n">no_fillet_vertices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">midpoints</span><span class="p">[</span><span class="n">stop</span><span class="p">])</span>
                        <span class="n">shorter_lines</span><span class="p">[</span><span class="n">stop</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span>
                            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">LineString</span><span class="p">(</span><span class="n">no_fillet_vertices</span><span class="p">),</span>
                            <span class="s2">&quot;fillet&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">),</span>
                        <span class="p">})</span>
                <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="n">status</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">stop</span> <span class="o">==</span> <span class="n">len_coords</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># The last segment</span>
                    <span class="n">no_fillet_vertices</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">no_fillet_vertices</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">midpoints</span><span class="p">[</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">shorter_lines</span><span class="p">[</span><span class="n">stop</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span>
                        <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">LineString</span><span class="p">(</span><span class="n">no_fillet_vertices</span><span class="p">),</span>
                        <span class="s2">&quot;fillet&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">)</span>
                    <span class="p">})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Segment in between first and last segment.</span>
                    <span class="n">no_fillet_vertices</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">no_fillet_vertices</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">midpoints</span><span class="p">[</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">no_fillet_vertices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">midpoints</span><span class="p">[</span><span class="n">stop</span><span class="p">])</span>
                    <span class="n">shorter_lines</span><span class="p">[</span><span class="n">stop</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span>
                        <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">LineString</span><span class="p">(</span><span class="n">no_fillet_vertices</span><span class="p">),</span>
                        <span class="s2">&quot;fillet&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">)</span>
                    <span class="p">})</span>
            <span class="c1"># Gather the fillet segments.</span>
            <span class="n">at_vertex</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">idx_bad_fillet</span><span class="p">):</span>
                <span class="n">fillet_vertices</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">start</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">pass</span>  <span class="c1"># just update at_vertex</span>
                <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">start</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">init_tuple</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">fillet_vertices</span> <span class="o">=</span> <span class="p">[</span><span class="n">init_tuple</span><span class="p">,</span> <span class="n">midpoints</span><span class="p">[</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span>
                    <span class="n">shorter_lines</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span>
                        <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">LineString</span><span class="p">(</span><span class="n">fillet_vertices</span><span class="p">),</span>
                        <span class="s2">&quot;fillet&quot;</span><span class="p">:</span> <span class="n">a_fillet</span>
                    <span class="p">})</span>
                <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">start</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">fillet_vertices</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">start</span><span class="p">]</span>
                    <span class="n">fillet_vertices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">midpoints</span><span class="p">[</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">shorter_lines</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span>
                        <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">LineString</span><span class="p">(</span><span class="n">fillet_vertices</span><span class="p">),</span>
                        <span class="s2">&quot;fillet&quot;</span><span class="p">:</span> <span class="n">a_fillet</span>
                    <span class="p">})</span>
                    <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="n">status</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">stop</span> <span class="o">!=</span> <span class="n">len_coords</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># Extra segment after the last no-fillet.</span>
                        <span class="n">fillet_vertices</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                        <span class="n">fillet_vertices</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">len_coords</span><span class="p">]</span>
                        <span class="n">fillet_vertices</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">midpoints</span><span class="p">[</span><span class="n">stop</span><span class="p">])</span>
                        <span class="n">shorter_lines</span><span class="p">[</span><span class="n">len_coords</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span>
                            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">LineString</span><span class="p">(</span><span class="n">fillet_vertices</span><span class="p">),</span>
                            <span class="s2">&quot;fillet&quot;</span><span class="p">:</span> <span class="n">a_fillet</span>
                        <span class="p">})</span>
                <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="n">status</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">start</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">stop</span> <span class="o">!=</span> <span class="n">len_coords</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># At last tuple, and and start at first index,</span>
                    <span class="c1"># and the stop is not last index of coords.</span>
                    <span class="n">fillet_vertices</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">len_coords</span><span class="p">]</span>
                    <span class="n">fillet_vertices</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">midpoints</span><span class="p">[</span><span class="n">stop</span><span class="p">])</span>
                    <span class="n">shorter_lines</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span>
                        <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">LineString</span><span class="p">(</span><span class="n">fillet_vertices</span><span class="p">),</span>
                        <span class="s2">&quot;fillet&quot;</span><span class="p">:</span> <span class="n">a_fillet</span>
                    <span class="p">})</span>
                <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="n">status</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">stop</span> <span class="o">!=</span> <span class="n">len_coords</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># At last tuple, and the stop is not last index of coords.</span>
                    <span class="n">fillet_vertices</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">at_vertex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">start</span><span class="p">]</span>
                    <span class="n">fillet_vertices</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">midpoints</span><span class="p">[</span><span class="n">at_vertex</span><span class="p">])</span>
                    <span class="n">fillet_vertices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">midpoints</span><span class="p">[</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">shorter_lines</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span>
                        <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">LineString</span><span class="p">(</span><span class="n">fillet_vertices</span><span class="p">),</span>
                        <span class="s2">&quot;fillet&quot;</span><span class="p">:</span> <span class="n">a_fillet</span>
                    <span class="p">})</span>
                    <span class="c1"># Extra segment after the last no-fillet.</span>
                    <span class="n">fillet_vertices</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                    <span class="n">fillet_vertices</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">len_coords</span><span class="p">]</span>
                    <span class="n">fillet_vertices</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">midpoints</span><span class="p">[</span><span class="n">stop</span><span class="p">])</span>
                    <span class="n">shorter_lines</span><span class="p">[</span><span class="n">len_coords</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span>
                        <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">LineString</span><span class="p">(</span><span class="n">fillet_vertices</span><span class="p">),</span>
                        <span class="s2">&quot;fillet&quot;</span><span class="p">:</span> <span class="n">a_fillet</span>
                    <span class="p">})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">start</span> <span class="o">-</span> <span class="n">at_vertex</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">fillet_vertices</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">at_vertex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">start</span><span class="p">]</span>
                        <span class="n">fillet_vertices</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">midpoints</span><span class="p">[</span><span class="n">at_vertex</span><span class="p">])</span>
                        <span class="n">fillet_vertices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">midpoints</span><span class="p">[</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                        <span class="n">shorter_lines</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span>
                            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">LineString</span><span class="p">(</span><span class="n">fillet_vertices</span><span class="p">),</span>
                            <span class="s2">&quot;fillet&quot;</span><span class="p">:</span> <span class="n">a_fillet</span>
                        <span class="p">})</span>
                <span class="n">at_vertex</span> <span class="o">=</span> <span class="n">stop</span>  <span class="c1"># Need to update for every loop.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># No short segments.</span>
            <span class="n">shorter_lines</span><span class="p">[</span><span class="n">len_coords</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_shapely</span>
        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">shorter_lines</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_identify_vertex_not_to_fillet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">a_fillet</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                                       <span class="n">all_idx_bad_fillet</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use coords to denote segments that are too short.  In particular,</span>
<span class="sd">        when fillet&#39;d, they will cause the appearance of incorrect fillet when</span>
<span class="sd">        graphed.</span>

<span class="sd">        Args:</span>
<span class="sd">            coords (list): User provide a list of tuples.</span>
<span class="sd">                    The tuple is (x,y) location for a vertex.</span>
<span class="sd">                    The list represents a LineString.</span>
<span class="sd">            a_fillet (float): The value provided by component developer.</span>
<span class="sd">            all_idx_bad_fillet (dict): An empty dict which will be</span>
<span class="sd">                                        populated by this method.</span>

<span class="sd">        Dictionary:</span>
<span class="sd">            Key &#39;reduced_idx&#39; will hold list of tuples.</span>
<span class="sd">                    The tuples correspond to index for list named &quot;coords&quot;.</span>
<span class="sd">            Key &#39;midpoints&#39; will hold list of tuples.</span>
<span class="sd">                    The index of a tuple corresponds to two index within coords.</span>
<span class="sd">            For example, a index in midpoints is x,</span>
<span class="sd">            that corresponds midpoint of segment x-1 to x.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Depreciated since there is no longer a scale factor</span>
        <span class="c1"># given to QCheckLength.</span>
        <span class="c1"># fillet_scale_factor = self.parse_value(</span>
        <span class="c1">#     self.options.check_short_segments_by_scaling_fillet)</span>

        <span class="c1"># precision = float(self.parse_value(self.options.precision))</span>

        <span class="c1"># For now, DO NOT allow the user of GDS to provide the precision.</span>
        <span class="c1"># user_precision = int(np.abs(np.log10(precision)))</span>

        <span class="n">all_idx_bad_fillet</span><span class="p">[</span><span class="s2">&quot;reduced_idx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_range_of_vertex_to_not_fillet</span><span class="p">(</span>
            <span class="n">coords</span><span class="p">,</span>
            <span class="n">a_fillet</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">design</span><span class="o">.</span><span class="n">template_options</span><span class="o">.</span><span class="n">PRECISION</span><span class="p">,</span>
            <span class="n">add_endpoints</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">midpoints</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_midpoint_xy</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                              <span class="n">vertex2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vertex2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">vertex2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">]</span>
        <span class="n">all_idx_bad_fillet</span><span class="p">[</span><span class="s2">&quot;midpoints&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">midpoints</span>

    <span class="c1"># Move data around to be useful for GDS</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_gather_subtract_elements_and_bounds</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">chip_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">table</span><span class="p">:</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
        <span class="n">all_subtracts</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">all_no_subtracts</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;For every chip, and layer, separate the &quot;subtract&quot; and &quot;no_subtract&quot;</span>
<span class="sd">        elements and gather bounds for all the elements in qgeometries. Use</span>
<span class="sd">        format: f&#39;{chip_name}_{table_name}s&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            chip_name (str): Name of chip.  Example is &#39;main&#39;.</span>
<span class="sd">            table_name (str): There are multiple tables in QGeometry table.</span>
<span class="sd">                                Example: &#39;path&#39; and &#39;poly&#39;.</span>
<span class="sd">            table (geopandas.GeoDataFrame): Actual table for the name.</span>
<span class="sd">            all_subtracts (list): Pass by reference so method can update</span>
<span class="sd">                                    this list.</span>
<span class="sd">            all_no_subtracts (list): Pass by reference so method can update</span>
<span class="sd">                                    this list.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Determine bound box and return scalar larger than size.</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_bounds</span><span class="p">(</span><span class="n">table</span><span class="p">))</span>

        <span class="c1"># Add the bounds of each table to list.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict_bounds</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="s2">&quot;gather&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_true</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">ground_plane</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_separate_subtract_shapes</span><span class="p">(</span><span class="n">chip_name</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>

            <span class="n">all_subtracts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">chip_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">_subtract_true&quot;</span><span class="p">))</span>
            <span class="n">all_no_subtracts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">chip_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">_subtract_false&quot;</span><span class="p">))</span>

        <span class="c1"># Done because ground plane option may be false.</span>
        <span class="c1"># This is not used anywhere currently.</span>
        <span class="c1"># Keep this deprecated code.</span>
        <span class="c1"># polys use gdstk.Polygon;    paths use gdstk.LineString</span>

        <span class="c1"># q_geometries = table.apply(self._qgeometry_to_gds, axis=1)</span>
        <span class="c1"># setattr(self, f&#39;{chip_name}_{table_name}s&#39;, q_geometries)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">unique_qcomponents</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
                   <span class="n">chip_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;If unique_qcomponents list is empty, get table using table_name from</span>
<span class="sd">        QGeometry tables for all elements with table_name.  Otherwise, return a</span>
<span class="sd">        table with fewer elements, for just the qcomponents within the</span>
<span class="sd">        unique_qcomponents list.</span>

<span class="sd">        Args:</span>
<span class="sd">            table_name (str): Can be &quot;path&quot;, &quot;poly&quot;, etc. from the</span>
<span class="sd">                            QGeometry tables.</span>
<span class="sd">            unique_qcomponents (list): User requested list of qcomponent</span>
<span class="sd">                            names to export to GDS file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            geopandas.GeoDataFrame: Table of elements within the QGeometry.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># self.design.qgeometry.tables is a dict. key=table_name, value=geopandas.GeoDataFrame</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_qcomponents</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">design</span><span class="o">.</span><span class="n">qgeometry</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">design</span><span class="o">.</span><span class="n">qgeometry</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span>
            <span class="c1"># Convert string QComponent.name  to QComponent.id</span>
            <span class="n">highlight_id</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">design</span><span class="o">.</span><span class="n">name_to_id</span><span class="p">[</span><span class="n">a_qcomponent</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">a_qcomponent</span> <span class="ow">in</span> <span class="n">unique_qcomponents</span>
            <span class="p">]</span>

            <span class="c1"># Remove QComponents which are not requested.</span>
            <span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;component&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">highlight_id</span><span class="p">)]</span>

        <span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;chip&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">chip_name</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">table</span>

    <span class="c1"># To export the data.</span>

<div class="viewcode-block" id="QGDSRenderer.new_gds_library">
<a class="viewcode-back" href="../../../../apidocs/qiskit_metal.renderers.QGDSRenderer.html#qiskit_metal.renderers.QGDSRenderer.new_gds_library">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">new_gds_library</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Library</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new GDS Library. Deletes the old. Create a new GDS library</span>
<span class="sd">        file. It can contains multiple cells.</span>

<span class="sd">        Returns:</span>
<span class="sd">            gdstk.Library: GDS library which can contain multiple cells.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_units</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="p">:</span>
            <span class="c1"># Clear old cells from the library</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">cells</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

        <span class="c1"># Create a new GDS library file. It can contains multiple cells.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lib</span> <span class="o">=</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Library</span><span class="p">(</span>
            <span class="n">unit</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">gds_unit</span><span class="p">)),</span>
            <span class="n">precision</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">precision</span><span class="p">)),</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_check_cheese</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chip</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">layer</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Examine the option for cheese_view_in_file.</span>

<span class="sd">        Args:</span>
<span class="sd">            chip (str): User defined chip name.</span>
<span class="sd">            layer (int): Layer used in chip.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: Observation of option based on chip and layer information.</span>

<span class="sd">            * 0 This is the initialization state.</span>
<span class="sd">            * 1 The layer is in the chip and cheese is True.</span>
<span class="sd">            * 2 The layer is in the chip and cheese is False.</span>
<span class="sd">            * 3 The chip is not in dict, so can&#39;t give answer.</span>
<span class="sd">            * 4 The layer is not in the chip, so can&#39;t give answer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">code</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">cheese_option</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">cheese</span><span class="o">.</span><span class="n">view_in_file</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">chip</span> <span class="ow">in</span> <span class="n">cheese_option</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">cheese_option</span><span class="p">[</span><span class="n">chip</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">is_true</span><span class="p">(</span><span class="n">cheese_option</span><span class="p">[</span><span class="n">chip</span><span class="p">][</span><span class="n">layer</span><span class="p">]):</span>
                    <span class="n">code</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">code</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">code</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">code</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="k">return</span> <span class="n">code</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_no_cheese</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chip</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">layer</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Examine the option for no_cheese_view_in_file.</span>

<span class="sd">        Args:</span>
<span class="sd">            chip (str): User defined chip name.</span>
<span class="sd">            layer (int): Layer used in chip.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: Observation of option based on chip and layer information.</span>

<span class="sd">            * 0 This is the initialization state.</span>
<span class="sd">            * 1 The layer is in the chip and viewing no-cheese is True.</span>
<span class="sd">            * 2 The layer is in the chip and viewing no-cheese is False.</span>
<span class="sd">            * 3 The chip is not in dict, so can&#39;t give answer.</span>
<span class="sd">            * 4 The layer is not in the chip, so can&#39;t give answer.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">code</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">no_cheese_option</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">no_cheese</span><span class="o">.</span><span class="n">view_in_file</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">chip</span> <span class="ow">in</span> <span class="n">no_cheese_option</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">no_cheese_option</span><span class="p">[</span><span class="n">chip</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">is_true</span><span class="p">(</span><span class="n">no_cheese_option</span><span class="p">[</span><span class="n">chip</span><span class="p">][</span><span class="n">layer</span><span class="p">]):</span>
                    <span class="n">code</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">code</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">code</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">code</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="k">return</span> <span class="n">code</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_either_cheese</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chip</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">layer</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use methods to check two options and give review of values for</span>
<span class="sd">        no_cheese_view_in_file and cheese_view_in_file.</span>

<span class="sd">        Args:</span>
<span class="sd">            chip (str): User defined chip name.</span>
<span class="sd">            layer (int): Layer used in chip.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: Observation of options based on chip and layer information.</span>

<span class="sd">            * 0 This is the initialization state.</span>
<span class="sd">            * 1 Show the layer in both cheese and no cheese</span>
<span class="sd">            * 2 Show the layer in just the cheese</span>
<span class="sd">            * 3 Show the no-cheese, but not the cheese</span>
<span class="sd">            * 4 Do NOT show the layer in neither cheese</span>
<span class="sd">            * 5 The chip is not in the default option.</span>
<span class="sd">            * 6 The layer is not in the chip dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=too-many-return-statements</span>
        <span class="n">code</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">no_cheese_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_no_cheese</span><span class="p">(</span><span class="n">chip</span><span class="p">,</span> <span class="n">layer</span><span class="p">)</span>
        <span class="n">cheese_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_cheese</span><span class="p">(</span><span class="n">chip</span><span class="p">,</span> <span class="n">layer</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">no_cheese_code</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">cheese_code</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Not able to get no_cheese_view_in_file or &quot;</span>
                                <span class="s2">&quot;cheese_view_in_file from self.options.&quot;</span><span class="p">)</span>
            <span class="n">code</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="n">code</span>
        <span class="k">if</span> <span class="n">no_cheese_code</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">cheese_code</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">code</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">code</span>
        <span class="k">if</span> <span class="n">no_cheese_code</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">cheese_code</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">code</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">return</span> <span class="n">code</span>
        <span class="k">if</span> <span class="n">no_cheese_code</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">cheese_code</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">code</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="k">return</span> <span class="n">code</span>
        <span class="k">if</span> <span class="n">no_cheese_code</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">cheese_code</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">code</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="k">return</span> <span class="n">code</span>
        <span class="k">if</span> <span class="n">no_cheese_code</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">cheese_code</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">code</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Chip=</span><span class="si">{</span><span class="n">chip</span><span class="si">}</span><span class="s2"> is not either in no_cheese_view_in_file &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;or cheese_view_in_file from self.options.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">code</span>
        <span class="k">if</span> <span class="n">no_cheese_code</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">cheese_code</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">code</span> <span class="o">=</span> <span class="mi">6</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;layer=</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2"> is not in chip=</span><span class="si">{</span><span class="n">chip</span><span class="si">}</span><span class="s2"> either in &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;no_cheese_view_in_file or cheese_view_in_file from self.options.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">code</span>

        <span class="k">return</span> <span class="n">code</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_populate_cheese</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterate through each chip, then layer to determine the cheesing</span>
<span class="sd">        geometry.&quot;&quot;&quot;</span>

        <span class="c1"># lib = self.lib</span>
        <span class="n">cheese_sub_layer</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">cheese</span><span class="o">.</span><span class="n">datatype</span><span class="p">))</span>
        <span class="n">nocheese_sub_layer</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">no_cheese</span><span class="o">.</span><span class="n">datatype</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">chip_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">:</span>
            <span class="n">layers_in_chip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">design</span><span class="o">.</span><span class="n">qgeometry</span><span class="o">.</span><span class="n">get_all_unique_layers</span><span class="p">(</span>
                <span class="n">chip_name</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">chip_layer</span> <span class="ow">in</span> <span class="n">layers_in_chip</span><span class="p">:</span>
                <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_cheese</span><span class="p">(</span><span class="n">chip_name</span><span class="p">,</span> <span class="n">chip_layer</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">chip_box</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">design</span><span class="o">.</span><span class="n">get_x_y_for_chip</span><span class="p">(</span><span class="n">chip_name</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span> <span class="o">=</span> <span class="n">chip_box</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">_cheese_based_on_shape</span><span class="p">(</span>
                            <span class="n">minx</span><span class="p">,</span>
                            <span class="n">miny</span><span class="p">,</span>
                            <span class="n">maxx</span><span class="p">,</span>
                            <span class="n">maxy</span><span class="p">,</span>
                            <span class="n">chip_name</span><span class="p">,</span>
                            <span class="n">chip_layer</span><span class="p">,</span>
                            <span class="n">cheese_sub_layer</span><span class="p">,</span>
                            <span class="n">nocheese_sub_layer</span><span class="p">,</span>
                        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cheese_based_on_shape</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">minx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">miny</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">maxx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">maxy</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">chip_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">chip_layer</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">cheese_sub_layer</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">nocheese_sub_layer</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Instantiate class to do cheesing.</span>

<span class="sd">        Args:</span>
<span class="sd">            minx (float): Chip minimum x location.</span>
<span class="sd">            miny (float): Chip minimum y location.</span>
<span class="sd">            maxx (float): Chip maximum x location.</span>
<span class="sd">            maxy (float): chip maximum y location.</span>
<span class="sd">            chip_name (str): User defined chip name.</span>
<span class="sd">            layer (int): Layer number for calculating the cheese.</span>
<span class="sd">            cheese_sub_layer (int):  User defined datatype, considered a</span>
<span class="sd">                    sub-layer number for where to place the cheese output.</span>
<span class="sd">            nocheese_sub_layer (int): User defined datatype, considered a</span>
<span class="sd">                    sub-layer number for where to place the NO_cheese output.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=too-many-locals</span>
        <span class="c1"># pylint: disable=too-many-arguments</span>

        <span class="n">max_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">max_points</span><span class="p">))</span>
        <span class="n">cheese_shape</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">cheese</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="n">all_nocheese</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="n">chip_layer</span><span class="p">][</span><span class="s2">&quot;no_cheese&quot;</span><span class="p">]</span>
        <span class="n">all_nocheese_gds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="n">chip_layer</span><span class="p">][</span>
            <span class="s2">&quot;no_cheese_gds&quot;</span><span class="p">]</span>
        <span class="n">delta_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">cheese</span><span class="o">.</span><span class="n">delta_x</span><span class="p">))</span>
        <span class="n">delta_y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">cheese</span><span class="o">.</span><span class="n">delta_y</span><span class="p">))</span>
        <span class="n">edge_nocheese</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">cheese</span><span class="o">.</span><span class="n">edge_nocheese</span><span class="p">))</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">precision</span><span class="p">))</span>
        <span class="n">is_neg_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_negative_mask</span><span class="p">(</span><span class="n">chip_name</span><span class="p">,</span> <span class="n">chip_layer</span><span class="p">)</span>
        <span class="n">fab</span> <span class="o">=</span> <span class="n">is_true</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">fabricate</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cheese_shape</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cheese_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">cheese</span><span class="o">.</span><span class="n">cheese_0_x</span><span class="p">))</span>
            <span class="n">cheese_y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">cheese</span><span class="o">.</span><span class="n">cheese_0_y</span><span class="p">))</span>
            <span class="n">a_cheese</span> <span class="o">=</span> <span class="n">Cheesing</span><span class="p">(</span>
                <span class="n">all_nocheese</span><span class="p">,</span>
                <span class="n">all_nocheese_gds</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="p">,</span>
                <span class="n">minx</span><span class="p">,</span>
                <span class="n">miny</span><span class="p">,</span>
                <span class="n">maxx</span><span class="p">,</span>
                <span class="n">maxy</span><span class="p">,</span>
                <span class="n">chip_name</span><span class="p">,</span>
                <span class="n">edge_nocheese</span><span class="p">,</span>
                <span class="n">chip_layer</span><span class="p">,</span>
                <span class="n">is_neg_mask</span><span class="p">,</span>
                <span class="n">cheese_sub_layer</span><span class="p">,</span>
                <span class="n">nocheese_sub_layer</span><span class="p">,</span>
                <span class="n">fab</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
                <span class="n">max_points</span><span class="p">,</span>
                <span class="n">precision</span><span class="p">,</span>
                <span class="n">cheese_shape</span><span class="o">=</span><span class="n">cheese_shape</span><span class="p">,</span>
                <span class="n">shape_0_x</span><span class="o">=</span><span class="n">cheese_x</span><span class="p">,</span>
                <span class="n">shape_0_y</span><span class="o">=</span><span class="n">cheese_y</span><span class="p">,</span>
                <span class="n">delta_x</span><span class="o">=</span><span class="n">delta_x</span><span class="p">,</span>
                <span class="n">delta_y</span><span class="o">=</span><span class="n">delta_y</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">cheese_shape</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">cheese_radius</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">cheese</span><span class="o">.</span><span class="n">cheese_1_radius</span><span class="p">))</span>
            <span class="n">a_cheese</span> <span class="o">=</span> <span class="n">Cheesing</span><span class="p">(</span>
                <span class="n">all_nocheese</span><span class="p">,</span>
                <span class="n">all_nocheese_gds</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="p">,</span>
                <span class="n">minx</span><span class="p">,</span>
                <span class="n">miny</span><span class="p">,</span>
                <span class="n">maxx</span><span class="p">,</span>
                <span class="n">maxy</span><span class="p">,</span>
                <span class="n">chip_name</span><span class="p">,</span>
                <span class="n">edge_nocheese</span><span class="p">,</span>
                <span class="n">chip_layer</span><span class="p">,</span>
                <span class="n">is_neg_mask</span><span class="p">,</span>
                <span class="n">cheese_sub_layer</span><span class="p">,</span>
                <span class="n">nocheese_sub_layer</span><span class="p">,</span>
                <span class="n">fab</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
                <span class="n">max_points</span><span class="p">,</span>
                <span class="n">precision</span><span class="p">,</span>
                <span class="n">cheese_shape</span><span class="o">=</span><span class="n">cheese_shape</span><span class="p">,</span>
                <span class="n">shape_1_radius</span><span class="o">=</span><span class="n">cheese_radius</span><span class="p">,</span>
                <span class="n">delta_x</span><span class="o">=</span><span class="n">delta_x</span><span class="p">,</span>
                <span class="n">delta_y</span><span class="o">=</span><span class="n">delta_y</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The cheese_shape=</span><span class="si">{</span><span class="n">cheese_shape</span><span class="si">}</span><span class="s2"> is unknown in QGDSRenderer.&quot;</span><span class="p">)</span>
            <span class="n">a_cheese</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">a_cheese</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_dummy_a_lib</span> <span class="o">=</span> <span class="n">a_cheese</span><span class="o">.</span><span class="n">apply_cheesing</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_populate_no_cheese</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterate through every chip and layer.  If options choose to have</span>
<span class="sd">        either cheese or no-cheese, a MultiPolygon is placed</span>
<span class="sd">        self.chip_info[chip_name][chip_layer][&#39;no_cheese&#39;].</span>

<span class="sd">        If user selects to view the no-cheese, the method placed the</span>
<span class="sd">        cell with no-cheese at</span>
<span class="sd">        f&#39;TOP_{chip_name}_{chip_layer}_NoCheese_{sub_layer}&#39;.  The sub_layer</span>
<span class="sd">        is data_type and denoted in the options.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># pylint: disable=too-many-nested-blocks</span>

        <span class="n">no_cheese_buffer</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">no_cheese</span><span class="o">.</span><span class="n">buffer</span><span class="p">))</span>
        <span class="n">sub_layer</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">no_cheese</span><span class="o">.</span><span class="n">datatype</span><span class="p">))</span>
        <span class="n">lib</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span>
        <span class="n">fab</span> <span class="o">=</span> <span class="n">is_true</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">fabricate</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">chip_name</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">layers_in_chip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">design</span><span class="o">.</span><span class="n">qgeometry</span><span class="o">.</span><span class="n">get_all_unique_layers</span><span class="p">(</span>
                <span class="n">chip_name</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">chip_layer</span> <span class="ow">in</span> <span class="n">layers_in_chip</span><span class="p">:</span>
                <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_either_cheese</span><span class="p">(</span><span class="n">chip_name</span><span class="p">,</span> <span class="n">chip_layer</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="n">chip_layer</span><span class="p">]</span>
                            <span class="p">[</span><span class="s2">&quot;all_subtract_true&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="n">sub_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="n">chip_layer</span><span class="p">][</span>
                            <span class="s2">&quot;all_subtract_true&quot;</span><span class="p">]</span>
                        <span class="n">no_cheese_multipolygon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cheese_buffer_maker</span><span class="p">(</span>
                            <span class="n">sub_df</span><span class="p">,</span> <span class="n">chip_name</span><span class="p">,</span> <span class="n">no_cheese_buffer</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">no_cheese_multipolygon</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="n">chip_layer</span><span class="p">][</span>
                                <span class="s2">&quot;no_cheese&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">no_cheese_multipolygon</span><span class="p">)</span>
                            <span class="n">all_nocheese_gds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multipolygon_to_gds</span><span class="p">(</span>
                                <span class="n">no_cheese_multipolygon</span><span class="p">,</span>
                                <span class="n">chip_layer</span><span class="p">,</span>
                                <span class="n">sub_layer</span><span class="p">,</span>
                                <span class="n">no_cheese_buffer</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="n">chip_layer</span><span class="p">][</span>
                                <span class="s2">&quot;no_cheese_gds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">all_nocheese_gds</span><span class="p">)</span>

                            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_check_no_cheese</span><span class="p">(</span><span class="n">chip_name</span><span class="p">,</span> <span class="n">chip_layer</span><span class="p">)</span>
                                    <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">fab</span><span class="p">):</span>
                                <span class="n">no_cheese_subtract_cell_name</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="sa">f</span><span class="s2">&quot;TOP_</span><span class="si">{</span><span class="n">chip_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">chip_layer</span><span class="si">}</span><span class="s2">_NoCheese_</span><span class="si">{</span><span class="n">sub_layer</span><span class="si">}</span><span class="s2">&quot;</span>
                                <span class="p">)</span>
                                <span class="n">no_cheese_cell</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">new_cell</span><span class="p">(</span>
                                    <span class="n">no_cheese_subtract_cell_name</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">poly_el</span> <span class="ow">in</span> <span class="n">all_nocheese_gds</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">poly_el</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                                        <span class="k">for</span> <span class="n">sub_poly</span> <span class="ow">in</span> <span class="n">poly_el</span><span class="p">:</span>
                                            <span class="n">no_cheese_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sub_poly</span><span class="p">)</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">no_cheese_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">poly_el</span><span class="p">)</span>

                                <span class="n">chip_only_top_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;TOP_</span><span class="si">{</span><span class="n">chip_name</span><span class="si">}</span><span class="s2">&quot;</span>
                                <span class="n">chip_only_top</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
                                    <span class="p">(</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">lib</span><span class="o">.</span><span class="n">cells</span>
                                     <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">chip_only_top_name</span><span class="p">),</span>
                                    <span class="kc">None</span><span class="p">,</span>
                                <span class="p">)</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">chip_only_top</span> <span class="ow">and</span>
                                        <span class="n">no_cheese_cell</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">()</span>
                                        <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                                    <span class="n">chip_only_top</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                                        <span class="n">gdstk</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span><span class="n">no_cheese_cell</span><span class="p">))</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">lib</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">no_cheese_cell</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cheese_buffer_maker</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">sub_df</span><span class="p">:</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">chip_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">no_cheese_buffer</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">multipolygon</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;For each layer in each chip, and if it has a ground plane</span>
<span class="sd">        (subtract==True), determine the no-cheese buffer and return a shapely</span>
<span class="sd">        object. Before the buffer is created for no-cheese, the LineStrings and</span>
<span class="sd">        Polygons are all combined.</span>

<span class="sd">        Args:</span>
<span class="sd">            sub_df (geopandas.GeoDataFrame): The subset of QGeometry tables</span>
<span class="sd">                for each chip, and layer, and only if the layer has a ground plane.</span>
<span class="sd">            chip_name (str): Name of chip.</span>
<span class="sd">            no_cheese_buffer (float): Will be used for fillet and</span>
<span class="sd">                size of buffer.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[None, shapely.geometry.multipolygon.MultiPolygon]: The</span>
<span class="sd">            shapely which combines the polygons and linestrings and creates</span>
<span class="sd">            buffer as specified through default_options.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=too-many-locals</span>
        <span class="n">style_cap</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">no_cheese</span><span class="o">.</span><span class="n">cap_style</span><span class="p">))</span>
        <span class="n">style_join</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">no_cheese</span><span class="o">.</span><span class="n">join_style</span><span class="p">))</span>

        <span class="n">poly_sub_df</span> <span class="o">=</span> <span class="n">sub_df</span><span class="p">[</span><span class="n">sub_df</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span><span class="p">))]</span>
        <span class="n">poly_sub_geo</span> <span class="o">=</span> <span class="n">poly_sub_df</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">path_sub_df</span> <span class="o">=</span> <span class="n">sub_df</span><span class="p">[</span><span class="n">sub_df</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">linestring</span><span class="o">.</span><span class="n">LineString</span><span class="p">))]</span>
        <span class="n">path_sub_geo</span> <span class="o">=</span> <span class="n">path_sub_df</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">path_sub_width</span> <span class="o">=</span> <span class="n">path_sub_df</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="c1"># for n in range(len(path_sub_geo)):</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">path_sub_geo</span><span class="p">):</span>
            <span class="n">path_sub_geo</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">path_sub_geo</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span>
                <span class="n">path_sub_width</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                <span class="n">cap_style</span><span class="o">=</span><span class="n">style_cap</span><span class="p">,</span>
                <span class="n">join_style</span><span class="o">=</span><span class="n">style_join</span><span class="p">)</span>

        <span class="c1">#  Need to add buffer_size, cap style, and join style to default options</span>
        <span class="n">combo_list</span> <span class="o">=</span> <span class="n">path_sub_geo</span> <span class="o">+</span> <span class="n">poly_sub_geo</span>
        <span class="n">combo_shapely</span> <span class="o">=</span> <span class="n">draw</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">combo_list</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">combo_shapely</span><span class="o">.</span><span class="n">is_empty</span><span class="p">:</span>
            <span class="c1"># Can return either Multipolygon or just one polygon.</span>
            <span class="n">combo_shapely</span> <span class="o">=</span> <span class="n">combo_shapely</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">no_cheese_buffer</span><span class="p">,</span>
                                                 <span class="n">cap_style</span><span class="o">=</span><span class="n">style_cap</span><span class="p">,</span>
                                                 <span class="n">join_style</span><span class="o">=</span><span class="n">style_join</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">combo_shapely</span><span class="p">,</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span><span class="p">):</span>
                <span class="n">combo_shapely</span> <span class="o">=</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">([</span><span class="n">combo_shapely</span><span class="p">])</span>

            <span class="c1"># Check if the buffer went past the chip size.</span>
            <span class="n">chip_box</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">design</span><span class="o">.</span><span class="n">get_x_y_for_chip</span><span class="p">(</span><span class="n">chip_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span> <span class="o">=</span> <span class="n">chip_box</span>
                <span class="n">c_minx</span><span class="p">,</span> <span class="n">c_miny</span><span class="p">,</span> <span class="n">c_maxx</span><span class="p">,</span> <span class="n">c_maxy</span> <span class="o">=</span> <span class="n">combo_shapely</span><span class="o">.</span><span class="n">bounds</span>
                <span class="k">if</span> <span class="n">c_minx</span> <span class="o">&lt;</span> <span class="n">minx</span> <span class="ow">or</span> <span class="n">c_miny</span> <span class="o">&lt;</span> <span class="n">miny</span> <span class="ow">or</span> <span class="n">c_maxx</span> <span class="o">&gt;</span> <span class="n">maxx</span> <span class="ow">or</span> <span class="n">c_maxy</span> <span class="o">&gt;</span> <span class="n">maxy</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;The bounding box for no-cheese is outside of chip size.</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;Bounding box for chip is </span><span class="si">{</span><span class="n">chip_box</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;Bounding box with no_cheese buffer is </span><span class="si">{</span><span class="n">combo_shapely</span><span class="o">.</span><span class="n">bounds</span><span class="si">}</span><span class="s2">.&quot;</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;design.get_x_y_for_chip() did NOT return a good code for chip=</span><span class="si">{</span><span class="n">chip_name</span><span class="si">}</span><span class="s2">,&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;for _cheese_buffer_maker.  The chip boundary will not be tested.&quot;</span>
                <span class="p">)</span>

            <span class="c1"># The type of combo_shapely will be</span>
            <span class="c1"># &lt;class &#39;shapely.geometry.multipolygon.MultiPolygon&#39;&gt;</span>
            <span class="k">return</span> <span class="n">combo_shapely</span>
        <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># Need explicitly to avoid lint warnings.</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_rectangle_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chip_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;There can be more than one chip in QGeometry. All chips export to</span>
<span class="sd">        one gds file. Each chip uses its own subtract rectangle.</span>

<span class="sd">        Args:</span>
<span class="sd">            chip_name (str): Name of chip to render.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[list, list]: The subtract-rectangle for the chip_name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">layers_in_chip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">design</span><span class="o">.</span><span class="n">qgeometry</span><span class="o">.</span><span class="n">get_all_unique_layers</span><span class="p">(</span><span class="n">chip_name</span><span class="p">)</span>

        <span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict_bounds</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="s2">&quot;for_subtract&quot;</span><span class="p">]</span>
        <span class="n">rectangle_points</span> <span class="o">=</span> <span class="p">[(</span><span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">),</span> <span class="p">(</span><span class="n">maxx</span><span class="p">,</span> <span class="n">miny</span><span class="p">),</span> <span class="p">(</span><span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span><span class="p">),</span>
                            <span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="n">maxy</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">layers_in_chip</span><span class="p">,</span> <span class="n">rectangle_points</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_populate_poly_path_for_export</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Using the geometries for each table name in QGeometry, populate</span>
<span class="sd">        self.lib to eventually write to a GDS file.</span>

<span class="sd">        For every layer within a chip, use the same &quot;subtraction box&quot; for the</span>
<span class="sd">        elements that have subtract as true.  Every layer within a chip will</span>
<span class="sd">        have cell named:  f&#39;TOP_{chip_name}_{chip_layer}&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_name (str): The path and file name to write the gds file.</span>
<span class="sd">                             Name needs to include desired extension,</span>
<span class="sd">                             i.e. &quot;a_path_and_name.gds&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">precision</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">precision</span><span class="p">))</span>

        <span class="n">lib</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_gds_library</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">is_true</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">ground_plane</span><span class="p">):</span>
            <span class="n">all_chips_top_name</span> <span class="o">=</span> <span class="s2">&quot;TOP&quot;</span>
            <span class="n">all_chips_top</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">new_cell</span><span class="p">(</span><span class="n">all_chips_top_name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">chip_name</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">chip_only_top_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;TOP_</span><span class="si">{</span><span class="n">chip_name</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">chip_only_top</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">new_cell</span><span class="p">(</span><span class="n">chip_only_top_name</span><span class="p">)</span>

                <span class="n">layers_in_chip</span><span class="p">,</span> <span class="n">rectangle_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_rectangle_points</span><span class="p">(</span>
                    <span class="n">chip_name</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">chip_layer</span> <span class="ow">in</span> <span class="n">layers_in_chip</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_handle_photo_resist</span><span class="p">(</span>
                        <span class="n">lib</span><span class="p">,</span>
                        <span class="n">chip_only_top</span><span class="p">,</span>
                        <span class="n">chip_name</span><span class="p">,</span>
                        <span class="n">chip_layer</span><span class="p">,</span>
                        <span class="n">rectangle_points</span><span class="p">,</span>
                        <span class="n">precision</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="c1"># If junction table, import the cell and cell to chip_only_top</span>
                <span class="k">if</span> <span class="s2">&quot;junction&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_import_junctions_to_one_cell</span><span class="p">(</span><span class="n">chip_name</span><span class="p">,</span> <span class="n">lib</span><span class="p">,</span>
                                                       <span class="n">chip_only_top</span><span class="p">,</span>
                                                       <span class="n">layers_in_chip</span><span class="p">)</span>

                <span class="c1"># put all chips into TOP</span>
                <span class="k">if</span> <span class="n">chip_only_top</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">all_chips_top</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">gdstk</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span><span class="n">chip_only_top</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lib</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">chip_only_top</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_photo_resist</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">lib</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Library</span><span class="p">,</span>
        <span class="n">chip_only_top</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Cell</span><span class="p">,</span>
        <span class="n">chip_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">chip_layer</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">rectangle_points</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">precision</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the positive vs negative mask.</span>

<span class="sd">        Args:</span>
<span class="sd">            lib (gdstk.Library): The GDS library to export.</span>
<span class="sd">            chip_only_top (gdstk.Cell): The GDS  cell for top.</span>
<span class="sd">            chip_name (str): Name of chip to render.</span>
<span class="sd">            chip_layer (int): Layer of the chip to render.</span>
<span class="sd">            rectangle_points (list): The rectangle to denote the ground</span>
<span class="sd">                                    for each layer.</span>
<span class="sd">            precision (float): Used for GDS python export.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="s2">&quot;subtract_poly&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span>
            <span class="n">rectangle_points</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">chip_layer</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="n">ground_cell_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;TOP_</span><span class="si">{</span><span class="n">chip_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">chip_layer</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">ground_cell</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">new_cell</span><span class="p">(</span><span class="n">ground_cell_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_negative_mask</span><span class="p">(</span><span class="n">chip_name</span><span class="p">,</span> <span class="n">chip_layer</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_negative_mask</span><span class="p">(</span>
                <span class="n">lib</span><span class="p">,</span>
                <span class="n">chip_only_top</span><span class="p">,</span>
                <span class="n">ground_cell</span><span class="p">,</span>
                <span class="n">chip_name</span><span class="p">,</span>
                <span class="n">chip_layer</span><span class="p">,</span>
                <span class="n">precision</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_positive_mask</span><span class="p">(</span>
                <span class="n">lib</span><span class="p">,</span>
                <span class="n">chip_only_top</span><span class="p">,</span>
                <span class="n">ground_cell</span><span class="p">,</span>
                <span class="n">chip_name</span><span class="p">,</span>
                <span class="n">chip_layer</span><span class="p">,</span>
                <span class="n">precision</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_is_negative_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chip</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">layer</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check options to see if negative mask is requested for the</span>
<span class="sd">        chip and layer.</span>

<span class="sd">        Args:</span>
<span class="sd">            chip (str): Chip name to search for in options.</span>
<span class="sd">            layer (int): Layer to search for within chip.  Determine if this</span>
<span class="sd">                         layer should have negative mask.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: If there should be a negative mask for this chip and layer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">chip</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">negative_mask</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">negative_mask</span><span class="p">[</span><span class="n">chip</span><span class="p">]:</span>
                <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_negative_mask</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">lib</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Library</span><span class="p">,</span>
        <span class="n">chip_only_top</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Cell</span><span class="p">,</span>
        <span class="n">ground_cell</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Cell</span><span class="p">,</span>
        <span class="n">chip_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">chip_layer</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">precision</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply logic for negative_mask.</span>

<span class="sd">        Args:</span>
<span class="sd">            lib (gdstk.Library): GDS library.</span>
<span class="sd">            chip_only_top (gdstk.Cell): The chip&#39;s top cell.</span>
<span class="sd">            ground_cell (gdstk.Cell): The ground cell for this layer.</span>
<span class="sd">            chip_name (str): Name of chip to render.</span>
<span class="sd">            chip_layer (int): Layer of the chip to render.</span>
<span class="sd">            precision (float):  GDS geometry precision.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="n">chip_layer</span><span class="p">][</span><span class="s2">&quot;q_subtract_true&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Difference for True-False.</span>
            <span class="n">diff_geometry</span> <span class="o">=</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">boolean</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="n">chip_layer</span><span class="p">][</span><span class="s2">&quot;q_subtract_true&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="n">chip_layer</span><span class="p">][</span><span class="s2">&quot;q_subtract_false&quot;</span><span class="p">],</span>
                <span class="s2">&quot;not&quot;</span><span class="p">,</span>
                <span class="n">layer</span><span class="o">=</span><span class="n">chip_layer</span><span class="p">,</span>
                <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">diff_geometry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">design</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;There is no table named diff_geometry to write.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ground_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">*</span><span class="n">diff_geometry</span><span class="p">)</span>

        <span class="n">QGDSRenderer</span><span class="o">.</span><span class="n">_add_groundcell_to_chip_only_top</span><span class="p">(</span><span class="n">lib</span><span class="p">,</span> <span class="n">chip_only_top</span><span class="p">,</span>
                                                      <span class="n">ground_cell</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_positive_mask</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">lib</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Library</span><span class="p">,</span>
        <span class="n">chip_only_top</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Cell</span><span class="p">,</span>
        <span class="n">ground_cell</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Cell</span><span class="p">,</span>
        <span class="n">chip_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">chip_layer</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">precision</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply logic for positive mask for a chip to render.</span>

<span class="sd">        Args:</span>
<span class="sd">            lib (gdstk.Library): GDS library.</span>
<span class="sd">            chip_only_top (gdstk.Cell): The chip&#39;s top cell.</span>
<span class="sd">            ground_cell (gdstk.Cell): The ground cell for this layer.</span>
<span class="sd">            chip_name (str): Chip name.</span>
<span class="sd">            chip_layer (int): Layer index.</span>
<span class="sd">            precision (float): GDS geometry precision.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="n">chip_layer</span><span class="p">][</span><span class="s2">&quot;q_subtract_true&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">diff_geometry</span> <span class="o">=</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">boolean</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="s2">&quot;subtract_poly&quot;</span><span class="p">]],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="n">chip_layer</span><span class="p">][</span><span class="s2">&quot;q_subtract_true&quot;</span><span class="p">],</span>
                <span class="s2">&quot;not&quot;</span><span class="p">,</span>
                <span class="n">layer</span><span class="o">=</span><span class="n">chip_layer</span><span class="p">,</span>
                <span class="n">datatype</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">diff_geometry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">design</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;There is no table named diff_geometry to write.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ground_plane_cell_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ground_</span><span class="si">{</span><span class="n">chip_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">chip_layer</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">ground_plane_cell</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">new_cell</span><span class="p">(</span><span class="n">ground_plane_cell_name</span><span class="p">)</span>
                <span class="n">ground_plane_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">*</span><span class="n">diff_geometry</span><span class="p">)</span>
                <span class="n">ground_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">gdstk</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span><span class="n">ground_plane_cell</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_q_subtract_false</span><span class="p">(</span><span class="n">chip_name</span><span class="p">,</span> <span class="n">chip_layer</span><span class="p">,</span> <span class="n">ground_cell</span><span class="p">)</span>
        <span class="n">QGDSRenderer</span><span class="o">.</span><span class="n">_add_groundcell_to_chip_only_top</span><span class="p">(</span><span class="n">lib</span><span class="p">,</span> <span class="n">chip_only_top</span><span class="p">,</span>
                                                      <span class="n">ground_cell</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_q_subtract_false</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chip_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">chip_layer</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                                 <span class="n">ground_cell</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Cell</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;For each layer, add the subtract=false components to ground.</span>

<span class="sd">        Args:</span>
<span class="sd">            chip_name (str): Name of chip to render.</span>
<span class="sd">            chip_layer (int): Name of layer to render.</span>
<span class="sd">            ground_cell (gdstk.Cell): The cell in lib to add to.</span>
<span class="sd">                                            Cell created for each layer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="n">chip_layer</span><span class="p">][</span><span class="s2">&quot;q_subtract_false&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There is no table named &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;self.chip_info[</span><span class="si">{</span><span class="n">chip_name</span><span class="si">}</span><span class="s2">][q_subtract_false]&quot;</span>
                                <span class="sa">f</span><span class="s2">&quot; to write.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="n">chip_layer</span><span class="p">]</span>
                   <span class="p">[</span><span class="s2">&quot;q_subtract_false&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ground_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                    <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="n">chip_layer</span><span class="p">][</span><span class="s2">&quot;q_subtract_false&quot;</span><span class="p">])</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_add_groundcell_to_chip_only_top</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">lib</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Library</span><span class="p">,</span>
                                         <span class="n">chip_only_top</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Cell</span><span class="p">,</span>
                                         <span class="n">ground_cell</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Cell</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add the ground cell to the top of cell for chip.</span>

<span class="sd">        Args:</span>
<span class="sd">            lib (gdstk.GdsLibrary): Holds all of the chips to export to gds.</span>
<span class="sd">            chip_only_top (gdstk.Cell): Cell which for a single chip.</span>
<span class="sd">            ground_cell (gdstk.Cell): The ground cell to add to</span>
<span class="sd">                                    chip_only_top. Cell created for each layer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># put all cells into TOP_chipname, if not empty.</span>
        <span class="c1"># When checking for bounding box, gdstk will return None if empty.</span>

        <span class="k">if</span> <span class="n">ground_cell</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">chip_only_top</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">gdstk</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span><span class="n">ground_cell</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lib</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ground_cell</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_linestring_characteristics</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Tuple</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Given a row in the Junction table, give the characteristics of</span>
<span class="sd">        LineString in row.geometry.</span>

<span class="sd">        Args:</span>
<span class="sd">            row (pd.Pandas): A row from Junction table of QGeometry.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple:</span>
<span class="sd">            * 1st entry is Tuple[float,float]: The midpoint of Linestring from</span>
<span class="sd">            row.geometry in format (x,y).</span>
<span class="sd">            * 2nd entry is float: The angle in degrees of Linestring from</span>
<span class="sd">            row.geometry.</span>
<span class="sd">            * 3rd entry is float: Is the magnitude of Linestring from</span>
<span class="sd">            row.geometry.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">precision</span><span class="p">))</span>
        <span class="n">for_rounding</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">precision</span><span class="p">)))</span>

        <span class="p">[(</span><span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">),</span> <span class="p">(</span><span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span><span class="p">)]</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">coords</span><span class="p">[:]</span>

        <span class="n">center</span> <span class="o">=</span> <span class="n">QGDSRenderer</span><span class="o">.</span><span class="n">_midpoint_xy</span><span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span><span class="p">)</span>
        <span class="n">rotation</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">((</span><span class="n">maxy</span> <span class="o">-</span> <span class="n">miny</span><span class="p">),</span> <span class="p">(</span><span class="n">maxx</span> <span class="o">-</span> <span class="n">minx</span><span class="p">)))</span>
        <span class="n">magnitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span>
            <span class="n">distance</span><span class="o">.</span><span class="n">euclidean</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="n">for_rounding</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">center</span><span class="p">,</span> <span class="n">rotation</span><span class="p">,</span> <span class="n">magnitude</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_give_rotation_center_twopads</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">a_cell_bounding_box</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
            <span class="nb">float</span><span class="p">,</span>
            <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
            <span class="n">Union</span><span class="p">[</span><span class="n">gdstk</span><span class="o">.</span><span class="n">Polygon</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
            <span class="n">Union</span><span class="p">[</span><span class="n">gdstk</span><span class="o">.</span><span class="n">Polygon</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
    <span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the angle for rotation, center of LineString in</span>
<span class="sd">        row.geometry, and if needed create two pads to connect the junction to</span>
<span class="sd">        qubit.</span>

<span class="sd">        Args:</span>
<span class="sd">            row (pd.Pandas): A row from Junction table of QGeometry.</span>
<span class="sd">            a_cell_bounding_box (numpy.ndarray): Give the bounding box of cell</span>
<span class="sd">                used in row.gds_cell_name.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple:</span>
<span class="sd">            * 1st entry is float: The angle in degrees of Linestring from</span>
<span class="sd">            row.geometry.</span>
<span class="sd">            * 2nd entry is Tuple[float,float]: The midpoint of Linestring</span>
<span class="sd">            from row.geometry in format (x,y).</span>
<span class="sd">            * 3rd entry is gdstk.Rectangle: None if Magnitude of</span>
<span class="sd">            LineString is smaller than width of cell from row.gds_cell_name.</span>
<span class="sd">            Otherwise the rectangle for pad on LEFT of row.gds_cell_name.</span>
<span class="sd">            * 4th entry is gdstk.Rectangle: None if Magnitude of</span>
<span class="sd">            LineString is smaller than width of cell from row.gds_cell_name.</span>
<span class="sd">            Otherwise the rectangle for pad on RIGHT of row.gds_cell_name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=too-many-locals</span>
        <span class="n">junction_pad_overlap</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">junction_pad_overlap</span><span class="p">))</span>

        <span class="n">pad_height</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">width</span>
        <span class="n">center</span><span class="p">,</span> <span class="n">rotation</span><span class="p">,</span> <span class="n">magnitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_linestring_characteristics</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="p">[(</span><span class="n">jj_minx</span><span class="p">,</span> <span class="n">jj_miny</span><span class="p">),</span> <span class="p">(</span><span class="n">jj_maxx</span><span class="p">,</span> <span class="n">jj_maxy</span><span class="p">)]</span> <span class="o">=</span> <span class="n">a_cell_bounding_box</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">pad_left</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">pad_right</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">jj_x_width</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">jj_maxx</span> <span class="o">-</span> <span class="n">jj_minx</span><span class="p">)</span>
        <span class="n">jj_y_height</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">jj_maxy</span> <span class="o">-</span> <span class="n">jj_miny</span><span class="p">)</span>

        <span class="c1"># jj_center_x = (jj_x_width / 2) + jj_minx</span>
        <span class="n">jj_center_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">jj_y_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">jj_miny</span>

        <span class="n">pad_height</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">width</span>

        <span class="k">if</span> <span class="n">pad_height</span> <span class="o">&lt;</span> <span class="n">jj_y_height</span><span class="p">:</span>
            <span class="c1"># pylint: disable=protected-access</span>
            <span class="n">text_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">design</span><span class="o">.</span><span class="n">_components</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">component</span><span class="p">]</span><span class="o">.</span><span class="n">_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;In junction table, component=</span><span class="si">{</span><span class="n">text_id</span><span class="si">}</span><span class="s2"> with name=</span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;has width=</span><span class="si">{</span><span class="n">pad_height</span><span class="si">}</span><span class="s2"> smaller than cell dimension=</span><span class="si">{</span><span class="n">jj_y_height</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">jj_x_width</span> <span class="o">&lt;</span> <span class="n">magnitude</span><span class="p">:</span>
            <span class="n">pad_x_size_minus_overlap</span> <span class="o">=</span> <span class="p">(</span><span class="n">magnitude</span> <span class="o">-</span> <span class="n">jj_x_width</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">pad_miny</span> <span class="o">=</span> <span class="n">jj_center_y</span> <span class="o">-</span> <span class="p">(</span><span class="n">pad_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">pad_left</span> <span class="o">=</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">(</span><span class="n">jj_minx</span> <span class="o">-</span> <span class="n">pad_x_size_minus_overlap</span><span class="p">,</span> <span class="n">pad_miny</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">jj_minx</span> <span class="o">+</span> <span class="n">junction_pad_overlap</span><span class="p">,</span> <span class="n">pad_miny</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">jj_minx</span> <span class="o">+</span> <span class="n">junction_pad_overlap</span><span class="p">,</span> <span class="n">pad_miny</span> <span class="o">+</span> <span class="n">pad_height</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">jj_minx</span> <span class="o">-</span> <span class="n">pad_x_size_minus_overlap</span><span class="p">,</span> <span class="n">pad_miny</span> <span class="o">+</span> <span class="n">pad_height</span><span class="p">),</span>
                <span class="p">],</span>
                <span class="n">layer</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">layer</span><span class="p">),</span>
                <span class="n">datatype</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">pad_right</span> <span class="o">=</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">(</span><span class="n">jj_maxx</span> <span class="o">-</span> <span class="n">junction_pad_overlap</span><span class="p">,</span> <span class="n">pad_miny</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">jj_maxx</span> <span class="o">+</span> <span class="n">pad_x_size_minus_overlap</span><span class="p">,</span> <span class="n">pad_miny</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">jj_maxx</span> <span class="o">+</span> <span class="n">pad_x_size_minus_overlap</span><span class="p">,</span> <span class="n">pad_miny</span> <span class="o">+</span> <span class="n">pad_height</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">jj_maxx</span> <span class="o">-</span> <span class="n">junction_pad_overlap</span><span class="p">,</span> <span class="n">pad_miny</span> <span class="o">+</span> <span class="n">pad_height</span><span class="p">),</span>
                <span class="p">],</span>
                <span class="n">layer</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">layer</span><span class="p">),</span>
                <span class="n">datatype</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">rotation</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">pad_left</span><span class="p">,</span> <span class="n">pad_right</span>

    <span class="c1">############</span>

<div class="viewcode-block" id="QGDSRenderer.import_junction_gds_file">
<a class="viewcode-back" href="../../../../apidocs/qiskit_metal.renderers.QGDSRenderer.html#qiskit_metal.renderers.QGDSRenderer.import_junction_gds_file">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">import_junction_gds_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                 <span class="n">lib</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Library</span><span class="p">,</span>
                                 <span class="n">directory_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Import the file which contains all junctions for design.</span>

<span class="sd">        If the file has already been imported, just return True.</span>

<span class="sd">        When the design has junctions on multiple chips,</span>
<span class="sd">        we only need to import the file once to get all of the junction cells.</span>

<span class="sd">        Args:</span>
<span class="sd">            lib: Main GDS library used by this renderer.</span>
<span class="sd">            directory_name: Directory path where the junction GDS file is expected.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the file was imported (or was already imported), False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">imported_junction_gds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># auto get dir name</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">path_filename</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">path_filename</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;No path_filename specified for junction GDS import.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">directory_name</span> <span class="o">=</span> <span class="n">can_write_to_path</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">path_filename</span><span class="p">)</span>

        <span class="c1"># TODO: Validate this works as intended with new gdstk.read_gds</span>
        <span class="c1"># already imported once in this renderer</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">imported_junction_gds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">path_filename</span><span class="p">):</span>
            <span class="n">message_str</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Not able to find file:&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">path_filename</span><span class="si">}</span><span class="s1">&quot;.  &#39;</span>
                <span class="sa">f</span><span class="s2">&quot;Not used to replace junction.&quot;</span>
                <span class="sa">f</span><span class="s1">&#39; Checked directory:&quot;</span><span class="si">{</span><span class="n">directory_name</span><span class="si">}</span><span class="s1">&quot;.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">message_str</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># read external library (with its own unit/precision)</span>
        <span class="n">imported_lib</span> <span class="o">=</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">read_gds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">path_filename</span><span class="p">)</span>
        <span class="n">imported_cells</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">imported_lib</span><span class="p">,</span> <span class="s2">&quot;cells&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">imported_cells</span><span class="p">:</span>
            <span class="n">message_str</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Imported file &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">path_filename</span><span class="si">}</span><span class="s1">&quot; contains no cells.  &#39;</span>
                <span class="s2">&quot;Not used to replace junction.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">message_str</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># replicate old gdspy `units=&quot;convert&quot;` behavior:</span>
        <span class="c1"># # rescale imported cells so their physical size matches this renderer&#39;s lib.</span>
        <span class="c1"># # coord_target = coord_imported * (imported_lib.unit / lib.unit)</span>
        <span class="c1"># scale = imported_lib.unit / lib.unit</span>

        <span class="c1"># # only do work if there is a real difference</span>
        <span class="c1"># if not math.isclose(scale, 1.0, rel_tol=1e-12, abs_tol=0.0):</span>
        <span class="c1">#     self.logger.info(</span>
        <span class="c1">#         &quot;Rescaling imported junction library from unit=%g to unit=%g &quot;</span>
        <span class="c1">#         &quot;(scale factor=%g).&quot;,</span>
        <span class="c1">#         imported_lib.unit,</span>
        <span class="c1">#         lib.unit,</span>
        <span class="c1">#         scale,</span>
        <span class="c1">#     )</span>
        <span class="c1">#     for cell in imported_cells:</span>
        <span class="c1">#         # scale in-place; affects polygons, paths, labels, references</span>
        <span class="c1">#         cell.scale(scale, scale)</span>

        <span class="c1"># merge imported cells into main library, like old lib.read_gds did</span>
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">imported_cells</span><span class="p">:</span>
            <span class="n">lib</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">imported_junction_gds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">path_filename</span>
        <span class="k">return</span> <span class="kc">True</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_import_junctions_to_one_cell</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">chip_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">lib</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Library</span><span class="p">,</span>
        <span class="n">chip_only_top</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Cell</span><span class="p">,</span>
        <span class="n">layers_in_chip</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Given lib, import the gds file from default options.  Based on the</span>
<span class="sd">        cell name in QGeometry table, import the cell from the gds file and</span>
<span class="sd">        place it in hierarchy of chip_only_top. In addition, the linestring</span>
<span class="sd">        should be two vertexes, and denotes two things.</span>
<span class="sd">        1. The midpoint of</span>
<span class="sd">        segment is the the center of cell.</span>

<span class="sd">        2. The angle made by second tuple - fist tuple  for delta y/ delta x</span>
<span class="sd">        is used to rotate the cell.</span>

<span class="sd">        Args:</span>
<span class="sd">            chip_name (str): The name of chip.</span>
<span class="sd">            lib (gdstk.Library): The library used to export the entire QDesign.</span>
<span class="sd">            chip_only_top (gdstk.Cell): The cell used for</span>
<span class="sd">                                                just chip_name.</span>
<span class="sd">            layers_in_chip (list):  List of all layers in chip.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=too-many-locals</span>
        <span class="c1"># pylint: disable=too-many-nested-blocks</span>

        <span class="c1"># Make sure the file exists, before trying to read it.</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">directory_name</span> <span class="o">=</span> <span class="n">can_write_to_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">path_filename</span><span class="p">)</span>
        <span class="n">layers_in_junction_table</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="s2">&quot;junction&quot;</span><span class="p">][</span><span class="s2">&quot;layer&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_junction_gds_file</span><span class="p">(</span><span class="n">lib</span><span class="o">=</span><span class="n">lib</span><span class="p">,</span>
                                         <span class="n">directory_name</span><span class="o">=</span><span class="n">directory_name</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">iter_layer</span> <span class="ow">in</span> <span class="n">layers_in_chip</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_negative_mask</span><span class="p">(</span><span class="n">chip_name</span><span class="p">,</span> <span class="n">iter_layer</span><span class="p">):</span>
                    <span class="c1"># Want to export negative mask</span>
                    <span class="c1"># Gather the pads into hold_all_pads_cell for same layer.</span>
                    <span class="k">if</span> <span class="n">iter_layer</span> <span class="ow">in</span> <span class="n">layers_in_junction_table</span><span class="p">:</span>
                        <span class="n">chip_only_top_layer_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;TOP_</span><span class="si">{</span><span class="n">chip_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">iter_layer</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="n">top_layer_cell</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">lib</span><span class="o">.</span><span class="n">cells</span>
                             <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">chip_only_top_layer_name</span><span class="p">),</span>
                            <span class="kc">None</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="n">top_layer_cell</span><span class="p">:</span>
                            <span class="n">hold_all_pads_cell</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">new_cell</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;r_l_hold_all_pads_</span><span class="si">{</span><span class="n">iter_layer</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">top_layer_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                                <span class="n">gdstk</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span><span class="n">hold_all_pads_cell</span><span class="p">))</span>
                            <span class="n">hold_all_jj_cell</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">new_cell</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;all_jj_imported_</span><span class="si">{</span><span class="n">iter_layer</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                            <span class="bp">self</span><span class="o">.</span><span class="n">_add_negative_extension_to_jj</span><span class="p">(</span>
                                <span class="n">chip_name</span><span class="p">,</span>
                                <span class="n">iter_layer</span><span class="p">,</span>
                                <span class="n">lib</span><span class="p">,</span>
                                <span class="n">chip_only_top</span><span class="p">,</span>
                                <span class="n">top_layer_cell</span><span class="p">,</span>
                                <span class="n">hold_all_pads_cell</span><span class="p">,</span>
                                <span class="n">hold_all_jj_cell</span><span class="p">,</span>
                            <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># By default, make a positive mask.</span>
                    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="s2">&quot;junction&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">itertuples</span><span class="p">(</span>
                    <span class="p">):</span>
                        <span class="n">chip_layer</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">layer</span><span class="p">)</span>
                        <span class="n">ground_cell_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;TOP_</span><span class="si">{</span><span class="n">chip_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">chip_layer</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">ground_cell_name</span> <span class="ow">in</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">lib</span><span class="o">.</span><span class="n">cells</span><span class="p">]</span> <span class="ow">and</span>
                                <span class="n">chip_layer</span> <span class="o">==</span> <span class="n">iter_layer</span><span class="p">):</span>
                            <span class="n">chip_layer_cell</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
                                <span class="p">(</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">lib</span><span class="o">.</span><span class="n">cells</span>
                                 <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">ground_cell_name</span><span class="p">),</span>
                                <span class="kc">None</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">gds_cell_name</span> <span class="ow">in</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">lib</span><span class="o">.</span><span class="n">cells</span><span class="p">]:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_add_positive_extension_to_jj</span><span class="p">(</span>
                                    <span class="n">lib</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">chip_layer_cell</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                                    <span class="sa">f</span><span class="s2">&quot;Cell=</span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">gds_cell_name</span><span class="si">}</span><span class="s2"> from junction&quot;</span>
                                    <span class="sa">f</span><span class="s2">&quot;table not found in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">path_filename</span><span class="si">}</span><span class="s2">.&quot;</span>
                                <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_add_negative_extension_to_jj</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">chip_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">jj_layer</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">lib</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Library</span><span class="p">,</span>
        <span class="n">chip_only_top</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Cell</span><span class="p">,</span>
        <span class="n">chip_only_top_layer</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Cell</span><span class="p">,</span>
        <span class="n">hold_all_pads_cell</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Cell</span><span class="p">,</span>
        <span class="n">hold_all_jj_cell</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Cell</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gather extension pads &amp; junctions for negative mask usage.</span>
<span class="sd">        Manipulate existing geometries for the layer that the junctions need</span>
<span class="sd">         to be added.  Since boolean subtraction is computationally intensive,</span>
<span class="sd">         the method will gather the pads for a layer, and do the boolean just</span>
<span class="sd">         once. Then add the junctions to difference.</span>

<span class="sd">        Args:</span>
<span class="sd">            chip_name (str): Chip name.</span>
<span class="sd">            jj_layer (int): Layer index for junction.</span>
<span class="sd">            lib (gdstk.Library): GDS library.</span>
<span class="sd">            chip_only_top (gdstk.Cell): Chip top cell.</span>
<span class="sd">            chip_only_top_layer (gdstk.Cell): Chip/layer cell.</span>
<span class="sd">            hold_all_pads_cell (gdstk.Cell): Cell collecting extension pads.</span>
<span class="sd">            hold_all_jj_cell (gdstk.Cell): Cell collecting junction references.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">boolean_by_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="s2">&quot;junction&quot;</span><span class="p">][</span>
            <span class="s2">&quot;layer&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">jj_layer</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="p">[</span><span class="n">chip_name</span><span class="p">][</span><span class="s2">&quot;junction&quot;</span><span class="p">][</span>
                <span class="n">boolean_by_layer</span><span class="p">]</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">gds_cell_name</span> <span class="ow">in</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">lib</span><span class="o">.</span><span class="n">cells</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_gather_negative_extension_for_jj</span><span class="p">(</span><span class="n">lib</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span>
                                                       <span class="n">hold_all_pads_cell</span><span class="p">,</span>
                                                       <span class="n">hold_all_jj_cell</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Junction cell=</span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">gds_cell_name</span><span class="si">}</span><span class="s2"> not &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;n </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">path_filename</span><span class="si">}</span><span class="s2"> for negative &quot;</span>
                    <span class="s2">&quot;mask usage.&quot;</span><span class="p">)</span>

        <span class="n">diff_r_l_pads_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;r_l_pads_diff_</span><span class="si">{</span><span class="n">jj_layer</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">diff_pad_cell_layer</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">new_cell</span><span class="p">(</span><span class="n">diff_r_l_pads_name</span><span class="p">)</span>
        <span class="n">chip_only_top</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">gdstk</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span><span class="n">diff_pad_cell_layer</span><span class="p">))</span>

        <span class="n">precision</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">precision</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">chip_only_top_layer</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">boolean_result</span> <span class="o">=</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">boolean</span><span class="p">(</span>
                <span class="n">chip_only_top_layer</span><span class="o">.</span><span class="n">get_polygons</span><span class="p">(),</span>
                <span class="n">hold_all_pads_cell</span><span class="o">.</span><span class="n">get_polygons</span><span class="p">(),</span>
                <span class="s2">&quot;not&quot;</span><span class="p">,</span>
                <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">boolean_result</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">boolean_result</span><span class="p">:</span>
                    <span class="n">diff_pad_cell_layer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">hold_all_jj_cell</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">diff_pad_cell_layer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">gdstk</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span><span class="n">hold_all_jj_cell</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_clean_hierarchy</span><span class="p">(</span>
            <span class="n">lib</span><span class="p">,</span>
            <span class="n">chip_only_top</span><span class="p">,</span>
            <span class="n">chip_only_top_layer</span><span class="p">,</span>
            <span class="n">diff_pad_cell_layer</span><span class="p">,</span>
            <span class="n">hold_all_pads_cell</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_clean_hierarchy</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">lib</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Library</span><span class="p">,</span>
        <span class="n">chip_only_top</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Cell</span><span class="p">,</span>
        <span class="n">chip_only_top_layer</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Cell</span><span class="p">,</span>
        <span class="n">diff_pad_cell_layer</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Cell</span><span class="p">,</span>
        <span class="n">hold_all_pads_cell</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Cell</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete cell that doesn&#39;t have pad nor jjs.  Then use same</span>
<span class="sd">        name for correct cell.  Also, get rid of cell that had the pads</span>
<span class="sd">        since subtraction happened and we don&#39;t need it any more.</span>

<span class="sd">        Args:</span>
<span class="sd">            lib (gdstk.Library): [The library used to export the entire QDesign.</span>
<span class="sd">            chip_only_top (gdstk.Cell): [description]</span>
<span class="sd">            chip_only_top_layer (gdstk.Cell): Cell under chip,</span>
<span class="sd">                                        with specific layer.</span>
<span class="sd">            diff_pad_cell_layer (gdstk.Cell): Holds result of top_layer - pads + jjs.</span>
<span class="sd">            hold_all_pads_cell (gdstk.Cell): Collect all the jj&#39;s with movement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hold_name</span> <span class="o">=</span> <span class="n">chip_only_top_layer</span><span class="o">.</span><span class="n">name</span>
        <span class="n">lib</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">chip_only_top_layer</span><span class="p">)</span>
        <span class="n">lib</span><span class="o">.</span><span class="n">rename_cell</span><span class="p">(</span><span class="n">diff_pad_cell_layer</span><span class="p">,</span> <span class="n">hold_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">diff_pad_cell_layer</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">chip_only_top</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">gdstk</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span><span class="n">diff_pad_cell_layer</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lib</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">diff_pad_cell_layer</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">hold_all_pads_cell</span><span class="o">.</span><span class="n">references</span><span class="p">):</span>
            <span class="n">lib</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ref</span><span class="o">.</span><span class="n">ref_cell</span><span class="p">)</span>
        <span class="n">lib</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">hold_all_pads_cell</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_gather_negative_extension_for_jj</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">lib</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Library</span><span class="p">,</span>
        <span class="n">row</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
        <span class="n">hold_all_pads_cell</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Cell</span><span class="p">,</span>
        <span class="n">hold_all_jj_cell</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Cell</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gather the pads and jjs and put them in separate cells.  The</span>
<span class="sd">        the pads can be boolean&#39;d &#39;not&#39; just once. After boolean for pads, then</span>
<span class="sd">        the jjs will be added to result.  The boolean is very</span>
<span class="sd">        time intensive, so just want to do it once.</span>

<span class="sd">        Args:</span>
<span class="sd">            lib (gdstk.Library): GDS library.</span>
<span class="sd">            row (pd.Series): Row from junction table.</span>
<span class="sd">            hold_all_pads_cell (gdstk.Cell): Collecting extension pads.</span>
<span class="sd">            hold_all_jj_cell (gdstk.Cell): Collecting junction references.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">a_cell</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">lib</span><span class="o">.</span><span class="n">cells</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">row</span><span class="o">.</span><span class="n">gds_cell_name</span><span class="p">),</span>
                      <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">a_cell</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">bounding_box</span> <span class="o">=</span> <span class="n">a_cell</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">bounding_box</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">rotation</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">pad_left</span><span class="p">,</span> <span class="n">pad_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_give_rotation_center_twopads</span><span class="p">(</span>
            <span class="n">row</span><span class="p">,</span> <span class="n">bounding_box</span><span class="p">)</span>
        <span class="n">jj_pad_r_l_name</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">gds_cell_name</span><span class="si">}</span><span class="s2">_QComponent_is_</span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">component</span><span class="si">}</span><span class="s2">&quot;</span>
                           <span class="sa">f</span><span class="s2">&quot;_Name_is_</span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_name_is_</span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">temp_cell</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">new_cell</span><span class="p">(</span><span class="n">jj_pad_r_l_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pad_left</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">temp_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pad_left</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pad_right</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">temp_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pad_right</span><span class="p">)</span>

        <span class="n">hold_all_jj_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">gdstk</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span><span class="n">a_cell</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">center</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="n">rotation</span><span class="p">))</span>
        <span class="n">hold_all_pads_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">gdstk</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span><span class="n">temp_cell</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">center</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="n">rotation</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_add_positive_extension_to_jj</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">lib</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Library</span><span class="p">,</span>
        <span class="n">row</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
        <span class="n">chip_layer_cell</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Cell</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the extension pads, then add or subtract to extracted cell based on</span>
<span class="sd">        positive or negative mask.</span>

<span class="sd">        Args:</span>
<span class="sd">            lib (gdstk.Library): The library used to export the entire QDesign.</span>
<span class="sd">            row (pd.core.frame.Pandas): Each row is from the qgeometry</span>
<span class="sd">                                            junction table.</span>
<span class="sd">            chip_layer_cell (gdstk.Cell): The cell used for</span>
<span class="sd">                                            chip_name and layer_num.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a_cell</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">lib</span><span class="o">.</span><span class="n">cells</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">row</span><span class="o">.</span><span class="n">gds_cell_name</span><span class="p">),</span>
                      <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">a_cell</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">bounding_box</span> <span class="o">=</span> <span class="n">a_cell</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">bounding_box</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">rotation</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">pad_left</span><span class="p">,</span> <span class="n">pad_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_give_rotation_center_twopads</span><span class="p">(</span>
            <span class="n">row</span><span class="p">,</span> <span class="n">bounding_box</span><span class="p">)</span>
        <span class="n">jj_pad_r_l_name</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;pads_</span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">gds_cell_name</span><span class="si">}</span><span class="s2">_QComponent_is_</span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">component</span><span class="si">}</span><span class="s2">_name_is_</span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">temp_cell</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">new_cell</span><span class="p">(</span><span class="n">jj_pad_r_l_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pad_left</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">temp_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pad_left</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pad_right</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">temp_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pad_right</span><span class="p">)</span>

        <span class="n">chip_layer_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">gdstk</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span><span class="n">a_cell</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">center</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="n">rotation</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">temp_cell</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">chip_layer_cell</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="n">gdstk</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span><span class="n">temp_cell</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">center</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="n">rotation</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lib</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">temp_cell</span><span class="p">)</span>

<div class="viewcode-block" id="QGDSRenderer.export_to_gds">
<a class="viewcode-back" href="../../../../apidocs/qiskit_metal.renderers.QGDSRenderer.html#qiskit_metal.renderers.QGDSRenderer.export_to_gds">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">export_to_gds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                      <span class="n">highlight_qcomponents</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use the design which was used to initialize this class. The</span>
<span class="sd">        QGeometry element types of both &quot;path&quot; and &quot;poly&quot;, will be used, to</span>
<span class="sd">        convert QGeometry to GDS formatted file.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_name (str): File name which can also include directory path.</span>
<span class="sd">                             If the file exists, it will be overwritten.</span>
<span class="sd">            highlight_qcomponents (list): List of strings which denote</span>
<span class="sd">                                        the name of QComponents to render.</span>
<span class="sd">                                        If empty, render all components in design.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: 0=file_name can not be written, otherwise 1=file_name has been written</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">highlight_qcomponents</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">highlight_qcomponents</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_can_write_to_path</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="c1"># There can be more than one chip in QGeometry.</span>
        <span class="c1"># They all export to one gds file.</span>
        <span class="c1"># Each chip will hold the rectangle for subtract for each layer so:</span>
        <span class="c1"># chip_info[chip_name][subtract_box][(min_x,min_y,max_x,max_y)]</span>
        <span class="c1"># chip_info[chip_name][layer_number][all_subtract_elements]</span>
        <span class="c1"># chip_info[chip_name][layer_number][all_no_subtract_elements]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chip_info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_chip_names</span><span class="p">())</span>

        <span class="c1"># if imported, hold the path to file name, otherwise None.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imported_junction_gds</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">max_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">max_points</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_qgeometry_for_gds</span><span class="p">(</span><span class="n">highlight_qcomponents</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Create self.lib and populate path and poly.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_populate_poly_path_for_export</span><span class="p">()</span>

            <span class="c1"># Add no-cheese MultiPolygon to</span>
            <span class="c1"># self.chip_info[chip_name][chip_layer][&#39;no_cheese&#39;],</span>
            <span class="c1"># if self.options requests the layer.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_populate_no_cheese</span><span class="p">()</span>

            <span class="c1"># Use self.options  to decide what to put for export</span>
            <span class="c1"># into self.chip_info[chip_name][chip_layer][&#39;cheese&#39;].</span>
            <span class="c1"># Not finished.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_populate_cheese</span><span class="p">()</span>

            <span class="c1"># Export the file to disk from self.lib</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">write_gds</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">max_points</span><span class="p">)</span>

            <span class="k">return</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="mi">0</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_multipolygon_to_gds</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">multi_poly</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">multipolygon</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">,</span>
            <span class="n">layer</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">data_type</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">no_cheese_buffer</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>  <span class="c1"># pylint: disable=unused-argument</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a shapely MultiPolygon to corresponding gdstk.</span>

<span class="sd">        Args:</span>
<span class="sd">            multi_poly (shapely.geometry.multipolygon.MultiPolygon): The</span>
<span class="sd">                                shapely geometry of no-cheese boundary.</span>
<span class="sd">            layer (int): The layer of the input multipolygon.</span>
<span class="sd">            data_type (int): Used as a &quot;sub-layer&quot; to place the no-cheese</span>
<span class="sd">                                gdstk output.</span>
<span class="sd">            no_cheese_buffer (float): Used for both fillet and buffer size.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: Each entry is converted to GDSII.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=too-many-locals</span>

        <span class="n">precision</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">precision</span><span class="p">))</span>

        <span class="n">all_polys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">multi_poly</span><span class="o">.</span><span class="n">geoms</span><span class="p">)</span>
        <span class="n">all_gds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">all_polys</span><span class="p">:</span>
            <span class="n">exterior_coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
            <span class="n">exterior_poly</span> <span class="o">=</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">exterior_coords</span><span class="p">,</span>
                                          <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
                                          <span class="n">datatype</span><span class="o">=</span><span class="n">data_type</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">poly</span><span class="o">.</span><span class="n">interiors</span><span class="p">:</span>
                <span class="n">holes</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">hole</span> <span class="ow">in</span> <span class="n">poly</span><span class="o">.</span><span class="n">interiors</span><span class="p">:</span>
                    <span class="n">hole_coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hole</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
                    <span class="n">holes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">gdstk</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">hole_coords</span><span class="p">,</span>
                                      <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
                                      <span class="n">datatype</span><span class="o">=</span><span class="n">data_type</span><span class="p">))</span>

                <span class="n">diff_result</span> <span class="o">=</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">boolean</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">exterior_poly</span><span class="p">],</span>
                    <span class="n">holes</span><span class="p">,</span>
                    <span class="s2">&quot;not&quot;</span><span class="p">,</span>
                    <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
                    <span class="n">datatype</span><span class="o">=</span><span class="n">data_type</span><span class="p">,</span>
                    <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="c1"># Poly fracturing leading to a funny shape. Leave this out of gds output for now.</span>
                <span class="c1"># a_poly.fillet(no_cheese_buffer,</span>
                <span class="c1">#               points_per_2pi=128,</span>
                <span class="c1">#               precision=precision)</span>
                <span class="n">all_gds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diff_result</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Poly fracturing leading to a funny shape. Leave this out of gds output for now.</span>
                <span class="c1"># exterior_poly.fillet(no_cheese_buffer,</span>
                <span class="c1">#                      points_per_2pi=128,</span>
                <span class="c1">#                      precision=precision)</span>
                <span class="n">all_gds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">exterior_poly</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">all_gds</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_qgeometry_to_gds</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">qgeometry_element</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">gdstk</span><span class="o">.</span><span class="n">Polygon</span><span class="p">,</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">FlexPath</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the design.qgeometry table to format used by GDS renderer.</span>
<span class="sd">        Convert the class to a series of GDSII elements.</span>

<span class="sd">        Args:</span>
<span class="sd">            qgeometry_element (pd.Series): Expect a shapely object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[&#39;gdstk.Polygon&#39; or &#39;gdstk.FlexPath&#39; or None]: Convert the</span>
<span class="sd">            class to a series of GDSII format on the input pd.Series.</span>


<span class="sd">        *NOTE:*</span>
<span class="sd">        GDS:</span>
<span class="sd">            points (array-like[N][2]) – Coordinates of the vertices of</span>
<span class="sd">                                        the polygon.</span>
<span class="sd">            layer (integer) – The GDSII layer number for this</span>
<span class="sd">                                        qgeometry_element.</span>
<span class="sd">            datatype (integer) – The GDSII datatype for this qgeometry_element</span>
<span class="sd">                                (between 0 and 255).</span>
<span class="sd">                                datatype=10 or 11 means only that they are</span>
<span class="sd">                                from a Polygon vs. LineString.</span>
<span class="sd">                                This can be changed.</span>

<span class="sd">        See:</span>
<span class="sd">            https://heitzmann.github.io/gdstk/geometry/gdstk.Polygon.html</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">corners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">corners</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
        <span class="n">tolerance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">tolerance</span><span class="p">)</span>

        <span class="n">geom</span> <span class="o">=</span> <span class="n">qgeometry_element</span><span class="o">.</span><span class="n">geometry</span>
        <span class="n">layer_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">qgeometry_element</span><span class="o">.</span><span class="n">layer</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">Polygon</span><span class="p">):</span>
            <span class="n">exterior_coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
            <span class="n">exterior_poly</span> <span class="o">=</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span>
                <span class="n">exterior_coords</span><span class="p">,</span>
                <span class="n">layer</span><span class="o">=</span><span class="n">layer_num</span><span class="p">,</span>
                <span class="n">datatype</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Handle holes</span>
            <span class="k">if</span> <span class="n">geom</span><span class="o">.</span><span class="n">interiors</span><span class="p">:</span>
                <span class="n">holes</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">hole</span> <span class="ow">in</span> <span class="n">geom</span><span class="o">.</span><span class="n">interiors</span><span class="p">:</span>
                    <span class="n">hole_coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hole</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
                    <span class="n">holes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">gdstk</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">hole_coords</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer_num</span><span class="p">,</span>
                                      <span class="n">datatype</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">boolean</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">exterior_poly</span><span class="p">],</span>
                    <span class="n">holes</span><span class="p">,</span>
                    <span class="s2">&quot;not&quot;</span><span class="p">,</span>
                    <span class="n">layer</span><span class="o">=</span><span class="n">layer_num</span><span class="p">,</span>
                    <span class="n">datatype</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                    <span class="n">precision</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">precision</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Some elements are not inside the geometry; these are invalid holes.&quot;</span>
                    <span class="p">)</span>
                <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">exterior_poly</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">LineString</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">qgeometry_element</span><span class="o">.</span><span class="n">width</span><span class="p">):</span>
                <span class="n">use_width</span> <span class="o">=</span> <span class="n">qgeometry_element</span><span class="o">.</span><span class="n">width</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">use_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">width_LineString</span><span class="p">)</span>
                <span class="n">qcomponent_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="n">qgeometry_element</span><span class="o">.</span><span class="n">component</span><span class="p">)</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="n">qgeometry_element</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
                <span class="n">layer_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="n">qgeometry_element</span><span class="o">.</span><span class="n">layer</span><span class="p">)</span>
                <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_value</span><span class="p">(</span><span class="n">qgeometry_element</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Since width:</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s2"> for a Path is not a number, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;it will be exported using width_LineString:&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">use_width</span><span class="si">}</span><span class="s2">.  The component_id is:</span><span class="si">{</span><span class="n">qcomponent_id</span><span class="si">}</span><span class="s2">,&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; name is:</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">, layer is: </span><span class="si">{</span><span class="n">layer_num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;fillet&quot;</span> <span class="ow">in</span> <span class="n">qgeometry_element</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">qgeometry_element</span><span class="o">.</span><span class="n">fillet</span><span class="p">)</span> <span class="ow">or</span>
                        <span class="n">qgeometry_element</span><span class="o">.</span><span class="n">fillet</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span>
                        <span class="n">qgeometry_element</span><span class="o">.</span><span class="n">fillet</span>
                        <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">qgeometry_element</span><span class="o">.</span><span class="n">width</span><span class="p">):</span>
                    <span class="n">to_return</span> <span class="o">=</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">FlexPath</span><span class="p">(</span>
                        <span class="nb">list</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span>
                        <span class="n">use_width</span><span class="p">,</span>
                        <span class="n">layer</span><span class="o">=</span><span class="n">layer_num</span><span class="p">,</span>
                        <span class="n">datatype</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
                        <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">to_return</span> <span class="o">=</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">FlexPath</span><span class="p">(</span>
                        <span class="nb">list</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span>
                        <span class="n">use_width</span><span class="p">,</span>
                        <span class="n">layer</span><span class="o">=</span><span class="n">layer_num</span><span class="p">,</span>
                        <span class="n">datatype</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
                        <span class="n">joins</span><span class="o">=</span><span class="n">corners</span><span class="p">,</span>
                        <span class="n">bend_radius</span><span class="o">=</span><span class="n">qgeometry_element</span><span class="o">.</span><span class="n">fillet</span><span class="p">,</span>
                        <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="k">return</span> <span class="n">to_return</span>

            <span class="c1"># Could be junction table with a linestring.</span>
            <span class="c1"># Look for gds_path_filename in column.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Linestring did not have fillet in column. &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;The qgeometry_element was not drawn.</span><span class="se">\n</span><span class="s2">&quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;The qgeometry_element within table is:</span><span class="se">\n</span><span class="s2">&quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">qgeometry_element</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># Need explicitly to avoid lint warnings.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unexpected shapely object geometry.&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;The variable qgeometry_element is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;method can currently handle Polygon and FlexPath.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_chip_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a dict of unique chip names for ALL tables within QGeometry.</span>
<span class="sd">        In another words, for every &quot;path&quot; table, &quot;poly&quot; table ... etc, this</span>
<span class="sd">        method will search for unique chip names and return a dict of unique</span>
<span class="sd">        chip names from QGeometry table.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict: dict with key of chip names and value of empty</span>
<span class="sd">            dict to hold things for renderers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chip_names</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">design</span><span class="o">.</span><span class="n">qgeometry</span><span class="o">.</span><span class="n">get_element_types</span><span class="p">():</span>
            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">design</span><span class="o">.</span><span class="n">qgeometry</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span>
            <span class="n">names</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;chip&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">chip_names</span> <span class="o">+=</span> <span class="n">names</span>
        <span class="n">unique_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">chip_names</span><span class="p">))</span>

        <span class="n">unique_dict</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">chip</span> <span class="ow">in</span> <span class="n">unique_list</span><span class="p">:</span>
            <span class="n">unique_dict</span><span class="p">[</span><span class="n">chip</span><span class="p">]</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">unique_dict</span>

<div class="viewcode-block" id="QGDSRenderer.show_imported_junction_gds">
<a class="viewcode-back" href="../../../../apidocs/qiskit_metal.renderers.QGDSRenderer.html#qiskit_metal.renderers.QGDSRenderer.show_imported_junction_gds">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">show_imported_junction_gds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;If junction gds file has been imported, show the cells in it.</span>
<span class="sd">        To use, you may need to first set:</span>
<span class="sd">        &gt;&gt;&gt; gds.options.path_filename = &quot;../resources/Fake_Junctions.GDS&quot;</span>
<span class="sd">        This function will read the file again, and print out the cells in it.</span>
<span class="sd">        It will also render the cells as an SVG inline if run in a Jupyter notebook.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">imported_junction_gds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">imported_lib</span> <span class="o">=</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">read_gds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imported_junction_gds</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;imported_lib name:&quot;</span><span class="p">,</span> <span class="n">imported_lib</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;imported_lib unit:&quot;</span><span class="p">,</span> <span class="n">imported_lib</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;imported_lib precision:&quot;</span><span class="p">,</span> <span class="n">imported_lib</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">imported_lib</span><span class="o">.</span><span class="n">cells</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debug_print_cell</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;No junction gds file has been imported. </span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;You can set it with `gds.options.path_filename = ...`&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="QGDSRenderer.debug_print_cell">
<a class="viewcode-back" href="../../../../apidocs/qiskit_metal.renderers.QGDSRenderer.html#qiskit_metal.renderers.QGDSRenderer.debug_print_cell">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">debug_print_cell</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compact pretty-print summary of a gdstk Cell.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">cell</span><span class="o">.</span><span class="n">write_svg</span><span class="p">(</span><span class="s2">&quot;test_output.svg&quot;</span><span class="p">)</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">SVG</span><span class="p">,</span> <span class="n">display</span>
            <span class="n">display</span><span class="p">(</span><span class="n">SVG</span><span class="p">(</span><span class="s2">&quot;test_output.svg&quot;</span><span class="p">))</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== </span><span class="si">{</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> ===&quot;</span><span class="p">)</span>

        <span class="c1"># Bounding box</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;bbox: </span><span class="si">{</span><span class="n">bbox</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Paths</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;paths:&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">paths</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">paths</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">cell</span><span class="o">.</span><span class="n">paths</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2"> (pts=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">points</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>

        <span class="c1"># Polygons</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;polygons:&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">polygons</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">polygons</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">cell</span><span class="o">.</span><span class="n">polygons</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - poly(n=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">points</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>

        <span class="c1"># References</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;refs:&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">references</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">references</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">cell</span><span class="o">.</span><span class="n">references</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>

        <span class="c1"># Properties</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;props:&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">properties</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">props</span> <span class="ow">in</span> <span class="n">cell</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">props</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== end ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="QGDSRenderer.debug_summarize_gds_library">
<a class="viewcode-back" href="../../../../apidocs/qiskit_metal.renderers.QGDSRenderer.html#qiskit_metal.renderers.QGDSRenderer.debug_summarize_gds_library">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">debug_summarize_gds_library</span><span class="p">(</span><span class="n">lib</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Library</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print a concise summary report for a gdstk.Library.</span>

<span class="sd">        The summary includes:</span>

<span class="sd">        - Library metadata (name, unit, precision, number of cells).</span>
<span class="sd">        - Cell names and whether they have geometry.</span>
<span class="sd">        - Per (layer, datatype) statistics:</span>
<span class="sd">            - number of polygons</span>
<span class="sd">            - number of paths</span>

<span class="sd">        Args:</span>
<span class="sd">            lib: Loaded gdstk.Library instance.</span>

<span class="sd">        Example:</span>
<span class="sd">            .. code-block:: python</span>

<span class="sd">                import gdstk</span>

<span class="sd">                lib = gdstk.read_gds(&quot;awesome_design.gds&quot;)</span>
<span class="sd">                summarize_gds_library(lib)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">write_library_overview_svg</span><span class="p">(</span><span class="n">lib</span><span class="p">,</span> <span class="s2">&quot;test_output.svg&quot;</span><span class="p">)</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">SVG</span><span class="p">,</span> <span class="n">display</span>
            <span class="n">display</span><span class="p">(</span><span class="n">SVG</span><span class="p">(</span><span class="s2">&quot;test_output.svg&quot;</span><span class="p">))</span>

        <span class="c1"># Basic library info</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== GDS LIBRARY SUMMARY ===&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;name:      </span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><span class="n">lib</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="kc">None</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;unit:      </span><span class="si">{</span><span class="n">lib</span><span class="o">.</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;precision: </span><span class="si">{</span><span class="n">lib</span><span class="o">.</span><span class="n">precision</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cells:     </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lib</span><span class="o">.</span><span class="n">cells</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Cell list</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">CELLS:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">lib</span><span class="o">.</span><span class="n">cells</span><span class="p">:</span>
            <span class="n">has_geom</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">polygons</span> <span class="ow">or</span> <span class="n">cell</span><span class="o">.</span><span class="n">paths</span> <span class="ow">or</span> <span class="n">cell</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">()</span>
            <span class="n">bbox_str</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span> <span class="k">if</span> <span class="n">bbox</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bbox</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="si">:</span><span class="s2">30s</span><span class="si">}</span><span class="s2"> geom=</span><span class="si">{</span><span class="n">has_geom</span><span class="si">}</span><span class="s2"> bbox=</span><span class="si">{</span><span class="n">bbox_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Collect per (layer, datatype) stats</span>
        <span class="n">layer_stats</span><span class="p">:</span> <span class="n">DictType</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
                              <span class="n">DictType</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{</span>
                                  <span class="s2">&quot;polygons&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                  <span class="s2">&quot;paths&quot;</span><span class="p">:</span> <span class="mi">0</span>
                              <span class="p">})</span>

        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">lib</span><span class="o">.</span><span class="n">cells</span><span class="p">:</span>
            <span class="c1"># Polygons</span>
            <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">cell</span><span class="o">.</span><span class="n">polygons</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">layer</span><span class="p">,</span> <span class="n">poly</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span>
                <span class="n">layer_stats</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;polygons&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Paths (FlexPath / RobustPath)</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">cell</span><span class="o">.</span><span class="n">paths</span><span class="p">:</span>
                <span class="c1"># FlexPath / RobustPath can have multiple parallel elements</span>
                <span class="c1"># with potentially multiple layers; treat each layer separately.</span>
                <span class="n">layers</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;layers&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;layer&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span>
                <span class="n">datatypes</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;datatypes&quot;</span><span class="p">,</span>
                                    <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;datatype&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span>

                <span class="c1"># Normalize to lists of same length</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layers</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                    <span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">layers</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datatypes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                    <span class="n">datatypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">datatypes</span><span class="p">]</span>

                <span class="c1"># Pair up safely</span>
                <span class="k">for</span> <span class="n">lyr</span><span class="p">,</span> <span class="n">dt</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">layers</span><span class="p">,</span> <span class="n">datatypes</span><span class="p">):</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lyr</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>
                    <span class="n">layer_stats</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;paths&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># If lib.layers_and_datatypes() is available, we can cross-check:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">lad</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">layers_and_datatypes</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">lad</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">LAYER / DATATYPE USAGE:&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">layer_stats</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  (no geometry found)&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  layer  dtype   polys   paths&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  -----  -----   -----   -----&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">dtype</span><span class="p">),</span> <span class="n">counts</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">layer_stats</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">layer</span><span class="si">:</span><span class="s2">5d</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">dtype</span><span class="si">:</span><span class="s2">5d</span><span class="si">}</span><span class="s2">   &quot;</span>
                      <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="s1">&#39;polygons&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">5d</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="s1">&#39;paths&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">5d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">lad</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Show the raw set from lib.layers_and_datatypes() for comparison</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">lib.layers_and_datatypes():&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">layer</span><span class="p">,</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">lad</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  (layer=</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">, datatype=</span><span class="si">{</span><span class="n">dtype</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== END SUMMARY ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>
</div>



<span class="k">def</span><span class="w"> </span><span class="nf">write_library_overview_svg</span><span class="p">(</span><span class="n">lib</span><span class="p">:</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Library</span><span class="p">,</span>
                               <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;library_overview.svg&quot;</span><span class="p">,</span>
                               <span class="n">background</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
                               <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write a single SVG that references all cells in a library.</span>

<span class="sd">    Args:</span>
<span class="sd">        lib: GDS library to export.</span>
<span class="sd">        filename: Output SVG filename.</span>
<span class="sd">        background: SVG background color, or None for transparent.</span>
<span class="sd">        scale: Coordinate scaling factor applied when writing SVG.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">top</span> <span class="o">=</span> <span class="n">gdstk</span><span class="o">.</span><span class="n">Cell</span><span class="p">(</span><span class="s2">&quot;LIB_OVERVIEW&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">lib</span><span class="o">.</span><span class="n">top_level</span><span class="p">():</span>  <span class="c1"># for cell in lib.cells:</span>
        <span class="n">top</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">gdstk</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span><span class="n">cell</span><span class="p">))</span>
    <span class="n">top</span><span class="o">.</span><span class="n">write_svg</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="n">background</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; Quantum Metal Community; 2019-2025 Qiskit Development Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on 2025/12/12</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../../../_static/documentation_options.js?v=f20ee9a7"></script>
    <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../../../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    </body>
</html>