<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2023.08.19 -->
        <title>matplotlib.backend_bases - Qiskit Metal 0.1.5 0.1.5</title>
      <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=362ab14a" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/qiskit-sphinx-theme.css?v=fe84956c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/qiskit-ecosystem.css?v=745c5aa7" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=IBM+Plex+Sans:ital,wght@0,400;0,600;1,400;1,600&display=swap" rel="stylesheet">
<script src="../../_static/js/web-components/top-nav-bar.js"></script></head>
  <body>
    
    <script>document.body.dataset.theme = "light";</script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg id="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
      <defs><style>.cls-1{fill:none;}</style></defs>
      <path d="M28,4H4A2,2,0,0,0,2,6V26a2,2,0,0,0,2,2H28a2,2,0,0,0,2-2V6A2,2,0,0,0,28,4ZM4,6H20V26H4ZM28,26H22V6h6Z"/>
      <rect id="_Transparent_Rectangle_" data-name="&lt;Transparent Rectangle&gt;" class="cls-1" width="32" height="32"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg id="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
      <defs><style>.cls-1{fill:none;}</style></defs>
      <rect x="4" y="6" width="24" height="2"/>
      <rect x="4" y="24" width="24" height="2"/>
      <rect x="4" y="12" width="24" height="2"/>
      <rect x="4" y="18" width="24" height="2"/>
      <rect id="_Transparent_Rectangle_" data-name="&lt;Transparent Rectangle&gt;" class="cls-1" width="32" height="32"/>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg version="1.1" id="icon" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"
         viewBox="0 0 32 32" style="enable-background:new 0 0 32 32;" xml:space="preserve"><polygon points="22,16 12,26 10.6,24.6 19.2,16 10.6,7.4 12,6 " stroke="currentColor"/>
      <rect id="_x3C_Transparent_Rectangle_x3E_" fill="none" width="32" height="32"/>
    </svg>
  </symbol>
  <symbol id="svg-new-tab" viewBox="0 0 32 32">
    <svg id="icon" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
      <defs>
        <style>
          .cls-1 {
            fill: none;
          }
        </style>
      </defs>
      <path fill="#6929C4" d="M26,28H6a2.0027,2.0027,0,0,1-2-2V6A2.0027,2.0027,0,0,1,6,4H16V6H6V26H26V16h2V26A2.0027,2.0027,0,0,1,26,28Z"/>
      <polygon fill="#6929C4" points="20 2 20 4 26.586 4 18 12.586 19.414 14 28 5.414 28 12 30 12 30 2 20 2"/>
      <rect id="_Transparent_Rectangle_" data-name="&lt;Transparent Rectangle&gt;" class="cls-1" width="32" height="32"/>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Qiskit Metal 0.1.5 0.1.5</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><div class="sidebar-brand">
  <a href="https://www.qiskit.org/ecosystem">
    <div class="sidebar-logo-container">
      <img class="sidebar-logo" src="../../_static/images/ecosystem-logo.svg" alt="Qiskit Ecosystem logo"/>
    </div>
  </a>
  
  <span class="sidebar-brand-text">Qiskit Metal 0.1.5 0.1.5</span>
</div><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installing Qiskit Metal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../workflow.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../workflow.html#qiskit-metal-workflow">Qiskit Metal Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../workflow.html#quantization-methods-overview">Quantization Methods Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributor Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributor-guide.html">Contributing to Qiskit Metal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributor-guide.html#where-things-are">Where Things Are</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributor-guide.html#reporting-bugs-and-requesting-enhancements">Reporting Bugs and Requesting Enhancements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributor-guide.html#contributing-code">Contributing Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributor-guide.html#contributing-to-documentation">Contributing to Documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tut/index.html">Overview</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Overview</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tut/1-Overview/1.1-Bird%27s-eye-view-of-Qiskit-Metal.html">Bird’s eye view of Qiskit Metal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/1-Overview/1.1-Bird%27s-eye-view-of-Qiskit-Metal.html#Coding-Time!">Coding Time!</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/1-Overview/1.2-Quick-start.html">Quick start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/1-Overview/1.3-Saving-Your-Chip-Design.html">Save your chip design</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tut/index.html#components">Components</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Components</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tut/2-From-components-to-chip/2.01-How-to-use-a-QComponent.html">How to use a QComponent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/2-From-components-to-chip/2.01-How-to-use-a-QComponent.html#QComponent-Default-Options">QComponent Default Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/2-From-components-to-chip/2.01-How-to-use-a-QComponent.html#Modifying-the-Options">Modifying the Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/2-From-components-to-chip/2.01-How-to-use-a-QComponent.html#Copying-a-QComponent">Copying a QComponent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/2-From-components-to-chip/2.01-How-to-use-a-QComponent.html#Deleting-a-QComponent">Deleting a QComponent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/2-From-components-to-chip/2.01-How-to-use-a-QComponent.html#Renaming-a-QComponent">Renaming a QComponent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/2-From-components-to-chip/2.01-How-to-use-a-QComponent.html#Overwriting-a-QComponent">Overwriting a QComponent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/2-From-components-to-chip/2.01-How-to-use-a-QComponent.html#Closing-the-Qiskit-Metal-GUI">Closing the Qiskit Metal GUI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/2-From-components-to-chip/2.02-How-to-copy-a-QComponent.html">How to copy a QComponent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/2-From-components-to-chip/2.11-Routing-101.html">Routing 101</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/2-From-components-to-chip/2.12-Simple-Meander.html">Simple Meander</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/2-From-components-to-chip/2.12-Simple-Meander.html#Using-CPW-meanders-to-connect-the-3-Qbits">Using CPW meanders to connect the 3 Qbits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/2-From-components-to-chip/2.13-Hybrid-Auto-and-AStar.html">Hybrid Auto and AStar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/2-From-components-to-chip/2.14-Get-them-all-with-MixedRoute.html">Get them all with MixedRoute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/2-From-components-to-chip/2.21-Design-a-4-qubit-full-chip.html">Design a 4 qubit full chip</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/2-From-components-to-chip/2.22-Design-100-qubits-programmatically.html">Design 100 qubits programmatically</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/2-From-components-to-chip/2.23-Modify-chip-options.html">Modify chip options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/2-From-components-to-chip/2.31-Create-a-QComponent-Basic.html">Create a QComponent - Basic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/2-From-components-to-chip/2.32-Create-a-QComponent-Advanced.html">Create a QComponent - Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/2-From-components-to-chip/2.33-Add-my-QComponent-to-a-reusable-python-file.html">Add my QComponent to a reusable python file</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tut/index.html#renderers">Renderers</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Renderers</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tut/3-Renderers/3.1-Introduction-to-QRenderers.html">Introduction to QRenderers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/3-Renderers/3.1-Introduction-to-QRenderers.html#Note:">Note:</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/3-Renderers/3.2-Export-your-design-to-GDS.html">Export your design to GDS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/3-Renderers/3.3-Render-your-design-to-Ansys.html">Render your design to Ansys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/3-Renderers/3.4-How-do-I-make-my-custom-QRenderer.html">How do I make my custom QRenderer</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tut/index.html#analysis">Analysis</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Analysis</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.01-Capacitance-and-LOM.html">Capacitance matrix and LOM analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.02-Eigenmode-and-EPR.html">Eigenmode and EPR analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.02-Eigenmode-and-EPR.html#1.-Analyze-the-transmon-qubit-by-itself">1. Analyze the transmon qubit by itself</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.02-Eigenmode-and-EPR.html#2.-Analyze-the-CPW-resonator-by-itself">2. Analyze the CPW resonator by itself</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.02-Eigenmode-and-EPR.html#3.-Analyze-the-combined-transmon-+-CPW-resonator-system">3. Analyze the combined transmon + CPW resonator system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.02-Eigenmode-and-EPR.html#4.-Analyze-a-coupled-2-transmon-system">4. Analyze a coupled 2-transmon system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.03-Impedance.html">Impedance, admittance and scattering analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.11-Analyze-and-tune-a-transmon.html">Analyzing and tuning a transmon qubit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.11-Analyze-and-tune-a-transmon.html#1.-Create-the-Qbit-design">1. Create the Qbit design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.11-Analyze-and-tune-a-transmon.html#2.-Analyze-the-transmon-using-the-Eigenmode-EPR-method">2. Analyze the transmon using the Eigenmode-EPR method</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.11-Analyze-and-tune-a-transmon.html#3.-Analyze-the-transmon-using-the-LOM-method">3. Analyze the transmon using the LOM method</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.12-Analyze-a-resonator.html">Analyzing and tuning a resonator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.12-Analyze-a-resonator.html#1.-Create-the-Resonator-design">1. Create the Resonator design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.12-Analyze-a-resonator.html#2.-Analyze-the-resonator-using-the-Eigenmode-EPR-method">2. Analyze the resonator using the Eigenmode-EPR method</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.13-Analyze-transmon-and-resonator.html">Analyzing and tuning a transmon qubit with a resonator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.13-Analyze-transmon-and-resonator.html#1.-Create-the-Qbit-design">1. Create the Qbit design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.13-Analyze-transmon-and-resonator.html#2.-Analyze-the-transmon-&amp;-resonator-using-the-Eigenmode-EPR-method">2. Analyze the transmon &amp; resonator using the Eigenmode-EPR method</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.13-Analyze-transmon-and-resonator.html#3.-Analyze-the-transmon-using-the-LOM-method">3. Analyze the transmon using the LOM method</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.14-Analyze-a-double-hanger-resonator.html">Analyzing a double hanger resonator (S Param)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.15-CPW-kappa-calculation.html">CPW Kappa Calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.21-Capacitance-matrix.html">Sweeps - Capacitance matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.21-Capacitance-matrix.html#READ-THIS-BEFORE-running-the-cell.">READ THIS BEFORE running the cell.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.22-Eigenmode-matrix.html">Sweeps - Eigenmode matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.23-Impedance-and-scattering-Z-S-Y-matrices.html">Sweeps - Impedance, scattering and admittance (Z S Y) matrices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.31-Plot-quantum-oscillator-wavefunction.html">Plotting Wavefunctions of the Quantum Harmonic Oscillator (LC Circuit)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.32-Transmon-analytics-HCPB.html">Transmon Analytics: Plotting Eigenvalues as a Function of Offset Charge</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.33-Transmon-analytics.html">Transmon Analytics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.34-Transmon-qubit-CPB-hamiltonian-charge-basis.html">Modeling transmon qubit Cooper-pair box Hamiltonian in the charge basis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.34-Transmon-qubit-CPB-hamiltonian-charge-basis.html#Additional-Analysis:-Charge-Dispersion,-Energy-Level-Differences,-Anharmonicity-and-Dephasing-Time-(T2)">Additional Analysis: Charge Dispersion, Energy Level Differences, Anharmonicity and Dephasing Time (T2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.34-Transmon-qubit-CPB-hamiltonian-charge-basis.html#Qutip-simulation">Qutip simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.34-Transmon-qubit-CPB-hamiltonian-charge-basis.html#Experimental">Experimental</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.34-Transmon-qubit-CPB-hamiltonian-charge-basis.html#New-section-on-integrating-sc_qubits.">New section on integrating sc_qubits.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/4-Analysis/4.34-Transmon-qubit-CPB-hamiltonian-charge-basis.html#Transmon-and-the-Oscillator">Transmon and the Oscillator</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tut/index.html#quick-topics">Quick Topics</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Quick Topics</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tut/quick-topics/JJ-Demo-Notebook.html">Josephson Junction QComponent Demo Notebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/quick-topics/Managing-pins.html">Managing pins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/quick-topics/Managing-variables.html">Managing variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/quick-topics/Opening-documentation.html">Opening the documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/quick-topics/QComponent-3-fingers-capacitor.html">QComponent - 3-fingers capacitor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tut/quick-topics/QComponent-Interdigitated-transmon.html">QComponent - Interdigitated transmon qubit</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://www.youtube.com/playlist?list=PLOFEBzvs-VvqHl5ZqVmhB_FcSqmLufsjb">Video Recordings</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Circuit Example Library</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../circuit-examples/index.html">Qubits</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Qubits</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../circuit-examples/A.Qubits/01-Transmon_cross.html">Single Transmon - Grounded (xmon)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../circuit-examples/A.Qubits/02-Transmon_floating.html">Single Transmon - Floating</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../circuit-examples/A.Qubits/03-concentric_transmon.html">Concentric Transmon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../circuit-examples/A.Qubits/04-Interdigitated_Transmon.html">Interdigitated Transmon Qubits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../circuit-examples/A.Qubits/05-Transmon_cross_fl.html">Single Transmon - Grounded (xmon) flux lines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../circuit-examples/A.Qubits/06-Transmon_floating_6.html">Single Transmon - Floating with 6 connection pads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../circuit-examples/A.Qubits/07-Transmon_floating_cl.html">Single Transmon - Floating with charge lines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../circuit-examples/A.Qubits/08-JJ-Dolan.html">Josephson Junction (Dolan)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../circuit-examples/A.Qubits/09-JJ-Manhattan.html">Josephson Junction (Manhattan)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../circuit-examples/A.Qubits/10-Transmon_floating_teeth.html">Single Transmon - Floating with teeth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../circuit-examples/A.Qubits/11-Star_shaped_qubit.html">Star shaped qubit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../circuit-examples/A.Qubits/11-Star_shaped_qubit.html#A-Star-Qubit">A Star Qubit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../circuit-examples/A.Qubits/11-Star_shaped_qubit.html#Closing-the-Qiskit-Metal-GUI">Closing the Qiskit Metal GUI</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../circuit-examples/index.html#resonators">Resonators</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Resonators</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../circuit-examples/B.Resonators/11-Resonator_Meander.html">Simple CPW Meander</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../circuit-examples/index.html#composite-bi-partite-systems">Composite Bi-Partite Systems</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of Composite Bi-Partite Systems</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../circuit-examples/C.Composite-bi-partite/21-OneTransmonsWithMeanderAndOTG.html">Transmon coupled to CPW resonator</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../circuit-examples/index.html#qubit-couplers">Qubit Couplers</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Qubit Couplers</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../circuit-examples/D.Qubit-couplers/31-TwoCrossmonsTunableCoupler.html">Tunable Coupler (MIT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../circuit-examples/D.Qubit-couplers/32-TwoTransmonsDirectCoupling.html">Direct Coupler (transmon-transmon)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../circuit-examples/D.Qubit-couplers/33-TwoTransmonsWithMeander.html">Bus Resonator Coupler (transmon-transmon)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../circuit-examples/index.html#input-output-coupling">Input-Output Coupling</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of Input-Output Coupling</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../circuit-examples/E.Input-output-coupling/41-LaunchPad.html">CPW Launch Pad</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../circuit-examples/E.Input-output-coupling/42-ResonatorAndLaunchPad.html">Readout line</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../circuit-examples/E.Input-output-coupling/43-TransmonPocketCL.html">Charge Line</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../circuit-examples/index.html#small-quantum-chips">Small Quantum Chips</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of Small Quantum Chips</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../circuit-examples/F.Small-quantum-chips/51-Four_qubit_chip.html">Four Qubit Chip Design</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../circuit-examples/index.html#design-flow">Design Flow</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of Design Flow</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../circuit-examples/full-design-flow-examples/Example-full-chip-design.html">Example full chip design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../circuit-examples/full-design-flow-examples/Example-full-chip-design.html#Layout">Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../circuit-examples/full-design-flow-examples/Example-full-chip-design.html#Analyze">Analyze</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../circuit-examples/full-design-flow-examples/Example-used-in-the-launch-video.html">Launch Videos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../circuit-examples/full-design-flow-examples/Exercise-for-the-South-Korea-Hackathon%2720.html">South Korea Qiskit Hackathon’20 - Qiskit Metal exercise</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Libraries</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../apidocs/qlibrary.html">All Quantum Devices</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of All Quantum Devices</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.qlibrary.QComponent.html">QComponent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.qlibrary.ParsedDynamicAttributes_Component.html">ParsedDynamicAttributes_Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.qlibrary.BaseQubit.html">BaseQubit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.qlibrary.QRoute.html">QRoute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.qlibrary.QRouteLead.html">QRouteLead</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.qlibrary.QRoutePoint.html">QRoutePoint</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.CircleCaterpillar.html">CircleCaterpillar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.CircleRaster.html">CircleRaster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.NGon.html">NGon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.NSquareSpiral.html">NSquareSpiral</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.Rectangle.html">Rectangle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.RectangleHollow.html">RectangleHollow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.Cap3Interdigital.html">Cap3Interdigital</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.CapNInterdigital.html">CapNInterdigital</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.ResonatorCoilRect.html">ResonatorCoilRect</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.CoupledLineTee.html">CoupledLineTee</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.LineTee.html">LineTee</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.CapNInterdigitalTee.html">CapNInterdigitalTee</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.TunableCoupler01.html">TunableCoupler01</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.TunableCoupler02.html">TunableCoupler02</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.ReadoutResFC.html">ReadoutResFC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.ResonatorLumped.html">ResonatorLumped</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.LaunchpadWirebond.html">LaunchpadWirebond</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.LaunchpadWirebondCoupled.html">LaunchpadWirebondCoupled</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.LaunchpadWirebondDriven.html">LaunchpadWirebondDriven</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.OpenToGround.html">OpenToGround</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.ShortToGround.html">ShortToGround</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.RouteStraight.html">RouteStraight</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.RouteFramed.html">RouteFramed</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.RouteMeander.html">RouteMeander</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.RouteAnchors.html">RouteAnchors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.RouteMixed.html">RouteMixed</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.RoutePathfinder.html">RoutePathfinder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.jj_dolan.html">jj_dolan</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.jj_manhattan.html">jj_manhattan</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.TransmonConcentric.html">TransmonConcentric</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.TransmonConcentricType2.html">TransmonConcentricType2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.TransmonCross.html">TransmonCross</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.TransmonCrossFL.html">TransmonCrossFL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.TransmonInterdigitated.html">TransmonInterdigitated</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.TransmonPocket.html">TransmonPocket</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.TransmonPocketCL.html">TransmonPocketCL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.TransmonPocket6.html">TransmonPocket6</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.TransmonPocketTeeth.html">TransmonPocketTeeth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.TunableCoupler01.html">TunableCoupler01</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.SQUID_LOOP.html">SQUID_LOOP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.StarQubit.html">StarQubit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.anchored_path.html">anchored_path</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../apidocs/designs.html">QDesigns</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of QDesigns</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.designs.QDesign.html">QDesign</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.designs.DesignPlanar.html">DesignPlanar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.designs.MultiPlanar.html">MultiPlanar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.designs.DesignFlipChip.html">DesignFlipChip</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.designs.QNet.html">QNet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.designs.Components.html">Components</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../apidocs/qlibrary.html">QComponents</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of QComponents</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.qlibrary.QComponent.html">QComponent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.qlibrary.ParsedDynamicAttributes_Component.html">ParsedDynamicAttributes_Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.qlibrary.BaseQubit.html">BaseQubit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.qlibrary.QRoute.html">QRoute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.qlibrary.QRouteLead.html">QRouteLead</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.qlibrary.QRoutePoint.html">QRoutePoint</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.CircleCaterpillar.html">CircleCaterpillar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.CircleRaster.html">CircleRaster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.NGon.html">NGon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.NSquareSpiral.html">NSquareSpiral</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.Rectangle.html">Rectangle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.RectangleHollow.html">RectangleHollow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.Cap3Interdigital.html">Cap3Interdigital</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.CapNInterdigital.html">CapNInterdigital</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.ResonatorCoilRect.html">ResonatorCoilRect</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.CoupledLineTee.html">CoupledLineTee</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.LineTee.html">LineTee</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.CapNInterdigitalTee.html">CapNInterdigitalTee</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.TunableCoupler01.html">TunableCoupler01</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.TunableCoupler02.html">TunableCoupler02</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.ReadoutResFC.html">ReadoutResFC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.ResonatorLumped.html">ResonatorLumped</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.LaunchpadWirebond.html">LaunchpadWirebond</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.LaunchpadWirebondCoupled.html">LaunchpadWirebondCoupled</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.LaunchpadWirebondDriven.html">LaunchpadWirebondDriven</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.OpenToGround.html">OpenToGround</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.ShortToGround.html">ShortToGround</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.RouteStraight.html">RouteStraight</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.RouteFramed.html">RouteFramed</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.RouteMeander.html">RouteMeander</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.RouteAnchors.html">RouteAnchors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.RouteMixed.html">RouteMixed</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.RoutePathfinder.html">RoutePathfinder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.jj_dolan.html">jj_dolan</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.jj_manhattan.html">jj_manhattan</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.TransmonConcentric.html">TransmonConcentric</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.TransmonConcentricType2.html">TransmonConcentricType2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.TransmonCross.html">TransmonCross</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.TransmonCrossFL.html">TransmonCrossFL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.TransmonInterdigitated.html">TransmonInterdigitated</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.TransmonPocket.html">TransmonPocket</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.TransmonPocketCL.html">TransmonPocketCL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.TransmonPocket6.html">TransmonPocket6</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.TransmonPocketTeeth.html">TransmonPocketTeeth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.TunableCoupler01.html">TunableCoupler01</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.SQUID_LOOP.html">SQUID_LOOP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.StarQubit.html">StarQubit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.qlibrary.anchored_path.html">anchored_path</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../apidocs/analyses.html">Analyses</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of Analyses</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.analyses.QAnalysis.html">QAnalysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.analyses.QSimulation.html">QSimulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.analyses.Hcpb.html">Hcpb</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.analyses.Hcpb_analytic.html">Hcpb_analytic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.analyses.HO_wavefunctions.html">HO_wavefunctions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.analyses.transmon_analytics.html">transmon_analytics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.analyses.cpw_calculations.html">cpw_calculations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.analyses.kappa_calculation.html">kappa_calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.analyses.Sweeper.html">Sweeper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.analyses.LOManalysis.html">LOManalysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.analyses.EPRanalysis.html">EPRanalysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.analyses.lumped_capacitive.html">lumped_capacitive</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.analyses.LumpedElementsSim.html">LumpedElementsSim</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.analyses.EigenmodeSim.html">EigenmodeSim</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../apidocs/qiskit_metal.analyses.ScatteringImpedanceSim.html">ScatteringImpedanceSim</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../apidocs/renderers.html">QRenderes</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of QRenderes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.renderers.QRenderer.html">QRenderer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.renderers.QRendererGui.html">QRendererGui</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.renderers.QRendererAnalysis.html">QRendererAnalysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.renderers.PlotCanvas.html">PlotCanvas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.renderers.MplInteraction.html">MplInteraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.renderers.ZoomOnWheel.html">ZoomOnWheel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.renderers.PanAndZoom.html">PanAndZoom</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.renderers.QMplRenderer.html">QMplRenderer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.renderers.AnimatedText.html">AnimatedText</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.renderers.QGDSRenderer.html">QGDSRenderer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.renderers.Cheesing.html">Cheesing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.renderers.QAnsysRenderer.html">QAnsysRenderer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.renderers.QHFSSRenderer.html">QHFSSRenderer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.renderers.QQ3DRenderer.html">QQ3DRenderer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.renderers.QPyaedt.html">QPyaedt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.renderers.QQ3DPyaedt.html">QQ3DPyaedt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.renderers.QHFSSPyaedt.html">QHFSSPyaedt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.renderers.QHFSSDrivenmodalPyaedt.html">QHFSSDrivenmodalPyaedt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.renderers.QHFSSEigenmodePyaedt.html">QHFSSEigenmodePyaedt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.renderers.QGmshRenderer.html">QGmshRenderer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.renderers.Vec3DArray.html">Vec3DArray</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../apidocs/toolbox_metal.html">Toolbox</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of Toolbox</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.toolbox_metal.QiskitMetalExceptions.html">QiskitMetalExceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.toolbox_metal.QiskitMetalDesignError.html">QiskitMetalDesignError</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.toolbox_metal.about.html">about</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.toolbox_metal.import_export.html">import_export</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.toolbox_metal.math_and_overrides.html">math_and_overrides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.toolbox_metal.parsing.html">parsing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.toolbox_metal.layer_stack_handler.html">layer_stack_handler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.toolbox_metal.bounds_for_path_and_poly_tables.html">bounds_for_path_and_poly_tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.toolbox_metal.determine_larger_box.html">determine_larger_box</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../apidocs/qgeometries.html">QGeometry</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of QGeometry</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal.qgeometries.QGeometryTables.html">QGeometryTables</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../apidocs/gui.html">GUI</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of GUI</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../stubs/qiskit_metal._gui.MetalGUI.html">MetalGUI</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Qiskit/qiskit/blob/master/CODE_OF_CONDUCT.md">Code of Conduct</a></li>
</ul>

</div></div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for matplotlib.backend_bases</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Abstract base classes define the primitives that renderers and</span>
<span class="sd">graphics contexts must implement to serve as a Matplotlib backend.</span>

<span class="sd">`RendererBase`</span>
<span class="sd">    An abstract base class to handle drawing/rendering operations.</span>

<span class="sd">`FigureCanvasBase`</span>
<span class="sd">    The abstraction layer that separates the `.Figure` from the backend</span>
<span class="sd">    specific details like a user interface drawing area.</span>

<span class="sd">`GraphicsContextBase`</span>
<span class="sd">    An abstract base class that provides color, line styles, etc.</span>

<span class="sd">`Event`</span>
<span class="sd">    The base class for all of the Matplotlib event handling.  Derived classes</span>
<span class="sd">    such as `KeyEvent` and `MouseEvent` store the meta data like keys and</span>
<span class="sd">    buttons pressed, x and y locations in pixel and `~.axes.Axes` coordinates.</span>

<span class="sd">`ShowBase`</span>
<span class="sd">    The base class for the ``Show`` class of each interactive backend; the</span>
<span class="sd">    &#39;show&#39; callable is then set to ``Show.__call__``.</span>

<span class="sd">`ToolContainerBase`</span>
<span class="sd">    The base class for the Toolbar class of each interactive backend.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">ExitStack</span><span class="p">,</span> <span class="n">contextmanager</span><span class="p">,</span> <span class="n">nullcontext</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span><span class="p">,</span> <span class="n">IntEnum</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">importlib</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">weakref</span> <span class="kn">import</span> <span class="n">WeakKeyDictionary</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">_api</span><span class="p">,</span> <span class="n">backend_tools</span> <span class="k">as</span> <span class="n">tools</span><span class="p">,</span> <span class="n">cbook</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">_docstring</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span>
    <span class="n">_tight_bbox</span><span class="p">,</span> <span class="n">transforms</span><span class="p">,</span> <span class="n">widgets</span><span class="p">,</span> <span class="n">get_backend</span><span class="p">,</span> <span class="n">is_interactive</span><span class="p">,</span> <span class="n">rcParams</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">matplotlib._pylab_helpers</span> <span class="kn">import</span> <span class="n">Gcf</span>
<span class="kn">from</span> <span class="nn">matplotlib.backend_managers</span> <span class="kn">import</span> <span class="n">ToolManager</span>
<span class="kn">from</span> <span class="nn">matplotlib.cbook</span> <span class="kn">import</span> <span class="n">_setattr_cm</span>
<span class="kn">from</span> <span class="nn">matplotlib.path</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">matplotlib.texmanager</span> <span class="kn">import</span> <span class="n">TexManager</span>
<span class="kn">from</span> <span class="nn">matplotlib.transforms</span> <span class="kn">import</span> <span class="n">Affine2D</span>
<span class="kn">from</span> <span class="nn">matplotlib._enums</span> <span class="kn">import</span> <span class="n">JoinStyle</span><span class="p">,</span> <span class="n">CapStyle</span>


<span class="n">_log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">_default_filetypes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;eps&#39;</span><span class="p">:</span> <span class="s1">&#39;Encapsulated Postscript&#39;</span><span class="p">,</span>
    <span class="s1">&#39;jpg&#39;</span><span class="p">:</span> <span class="s1">&#39;Joint Photographic Experts Group&#39;</span><span class="p">,</span>
    <span class="s1">&#39;jpeg&#39;</span><span class="p">:</span> <span class="s1">&#39;Joint Photographic Experts Group&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pdf&#39;</span><span class="p">:</span> <span class="s1">&#39;Portable Document Format&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pgf&#39;</span><span class="p">:</span> <span class="s1">&#39;PGF code for LaTeX&#39;</span><span class="p">,</span>
    <span class="s1">&#39;png&#39;</span><span class="p">:</span> <span class="s1">&#39;Portable Network Graphics&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ps&#39;</span><span class="p">:</span> <span class="s1">&#39;Postscript&#39;</span><span class="p">,</span>
    <span class="s1">&#39;raw&#39;</span><span class="p">:</span> <span class="s1">&#39;Raw RGBA bitmap&#39;</span><span class="p">,</span>
    <span class="s1">&#39;rgba&#39;</span><span class="p">:</span> <span class="s1">&#39;Raw RGBA bitmap&#39;</span><span class="p">,</span>
    <span class="s1">&#39;svg&#39;</span><span class="p">:</span> <span class="s1">&#39;Scalable Vector Graphics&#39;</span><span class="p">,</span>
    <span class="s1">&#39;svgz&#39;</span><span class="p">:</span> <span class="s1">&#39;Scalable Vector Graphics&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tif&#39;</span><span class="p">:</span> <span class="s1">&#39;Tagged Image File Format&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tiff&#39;</span><span class="p">:</span> <span class="s1">&#39;Tagged Image File Format&#39;</span><span class="p">,</span>
    <span class="s1">&#39;webp&#39;</span><span class="p">:</span> <span class="s1">&#39;WebP Image Format&#39;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">_default_backends</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;eps&#39;</span><span class="p">:</span> <span class="s1">&#39;matplotlib.backends.backend_ps&#39;</span><span class="p">,</span>
    <span class="s1">&#39;jpg&#39;</span><span class="p">:</span> <span class="s1">&#39;matplotlib.backends.backend_agg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;jpeg&#39;</span><span class="p">:</span> <span class="s1">&#39;matplotlib.backends.backend_agg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pdf&#39;</span><span class="p">:</span> <span class="s1">&#39;matplotlib.backends.backend_pdf&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pgf&#39;</span><span class="p">:</span> <span class="s1">&#39;matplotlib.backends.backend_pgf&#39;</span><span class="p">,</span>
    <span class="s1">&#39;png&#39;</span><span class="p">:</span> <span class="s1">&#39;matplotlib.backends.backend_agg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ps&#39;</span><span class="p">:</span> <span class="s1">&#39;matplotlib.backends.backend_ps&#39;</span><span class="p">,</span>
    <span class="s1">&#39;raw&#39;</span><span class="p">:</span> <span class="s1">&#39;matplotlib.backends.backend_agg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;rgba&#39;</span><span class="p">:</span> <span class="s1">&#39;matplotlib.backends.backend_agg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;svg&#39;</span><span class="p">:</span> <span class="s1">&#39;matplotlib.backends.backend_svg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;svgz&#39;</span><span class="p">:</span> <span class="s1">&#39;matplotlib.backends.backend_svg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tif&#39;</span><span class="p">:</span> <span class="s1">&#39;matplotlib.backends.backend_agg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tiff&#39;</span><span class="p">:</span> <span class="s1">&#39;matplotlib.backends.backend_agg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;webp&#39;</span><span class="p">:</span> <span class="s1">&#39;matplotlib.backends.backend_agg&#39;</span><span class="p">,</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">_safe_pyplot_import</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Import and return ``pyplot``, correctly setting the backend if one is</span>
<span class="sd">    already forced.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>  <span class="c1"># Likely due to a framework mismatch.</span>
        <span class="n">current_framework</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_get_running_interactive_framework</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">current_framework</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span>  <span class="c1"># No, something else went wrong, likely with the install...</span>
        <span class="n">backend_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;qt&#39;</span><span class="p">:</span> <span class="s1">&#39;qtagg&#39;</span><span class="p">,</span>
            <span class="s1">&#39;gtk3&#39;</span><span class="p">:</span> <span class="s1">&#39;gtk3agg&#39;</span><span class="p">,</span>
            <span class="s1">&#39;gtk4&#39;</span><span class="p">:</span> <span class="s1">&#39;gtk4agg&#39;</span><span class="p">,</span>
            <span class="s1">&#39;wx&#39;</span><span class="p">:</span> <span class="s1">&#39;wxagg&#39;</span><span class="p">,</span>
            <span class="s1">&#39;tk&#39;</span><span class="p">:</span> <span class="s1">&#39;tkagg&#39;</span><span class="p">,</span>
            <span class="s1">&#39;macosx&#39;</span><span class="p">:</span> <span class="s1">&#39;macosx&#39;</span><span class="p">,</span>
            <span class="s1">&#39;headless&#39;</span><span class="p">:</span> <span class="s1">&#39;agg&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">backend</span> <span class="o">=</span> <span class="n">backend_mapping</span><span class="p">[</span><span class="n">current_framework</span><span class="p">]</span>
        <span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;backend&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParamsOrig</span><span class="p">[</span><span class="s2">&quot;backend&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">backend</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>  <span class="c1"># Now this should succeed.</span>
    <span class="k">return</span> <span class="n">plt</span>


<span class="k">def</span> <span class="nf">register_backend</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register a backend for saving to a given file format.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    format : str</span>
<span class="sd">        File extension</span>
<span class="sd">    backend : module string or canvas class</span>
<span class="sd">        Backend for handling file output</span>
<span class="sd">    description : str, default: &quot;&quot;</span>
<span class="sd">        Description of the file type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">description</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">_default_backends</span><span class="p">[</span><span class="nb">format</span><span class="p">]</span> <span class="o">=</span> <span class="n">backend</span>
    <span class="n">_default_filetypes</span><span class="p">[</span><span class="nb">format</span><span class="p">]</span> <span class="o">=</span> <span class="n">description</span>


<span class="k">def</span> <span class="nf">get_registered_canvas_class</span><span class="p">(</span><span class="nb">format</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the registered default canvas for given file format.</span>
<span class="sd">    Handles deferred import of required backend.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">format</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_default_backends</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">backend_class</span> <span class="o">=</span> <span class="n">_default_backends</span><span class="p">[</span><span class="nb">format</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">backend_class</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">backend_class</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">backend_class</span><span class="p">)</span><span class="o">.</span><span class="n">FigureCanvas</span>
        <span class="n">_default_backends</span><span class="p">[</span><span class="nb">format</span><span class="p">]</span> <span class="o">=</span> <span class="n">backend_class</span>
    <span class="k">return</span> <span class="n">backend_class</span>


<span class="k">class</span> <span class="nc">RendererBase</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An abstract base class to handle drawing/rendering operations.</span>

<span class="sd">    The following methods must be implemented in the backend for full</span>
<span class="sd">    functionality (though just implementing `draw_path` alone would give a</span>
<span class="sd">    highly capable backend):</span>

<span class="sd">    * `draw_path`</span>
<span class="sd">    * `draw_image`</span>
<span class="sd">    * `draw_gouraud_triangles`</span>

<span class="sd">    The following methods *should* be implemented in the backend for</span>
<span class="sd">    optimization reasons:</span>

<span class="sd">    * `draw_text`</span>
<span class="sd">    * `draw_markers`</span>
<span class="sd">    * `draw_path_collection`</span>
<span class="sd">    * `draw_quad_mesh`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_texmanager</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_text2path</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">TextToPath</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raster_depth</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rasterizing</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">open_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">gid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open a grouping element with label *s* and *gid* (if set) as id.</span>

<span class="sd">        Only used by the SVG renderer.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">close_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close a grouping element with label *s*.</span>

<span class="sd">        Only used by the SVG renderer.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">draw_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">rgbFace</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw a `~.path.Path` instance using the given affine transform.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">draw_markers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">marker_path</span><span class="p">,</span> <span class="n">marker_trans</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span>
                     <span class="n">trans</span><span class="p">,</span> <span class="n">rgbFace</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a marker at each of *path*&#39;s vertices (excluding control points).</span>

<span class="sd">        The base (fallback) implementation makes multiple calls to `draw_path`.</span>
<span class="sd">        Backends may want to override this method in order to draw the marker</span>
<span class="sd">        only once and reuse it multiple times.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gc : `.GraphicsContextBase`</span>
<span class="sd">            The graphics context.</span>
<span class="sd">        marker_trans : `matplotlib.transforms.Transform`</span>
<span class="sd">            An affine transform applied to the marker.</span>
<span class="sd">        trans : `matplotlib.transforms.Transform`</span>
<span class="sd">            An affine transform applied to the path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">codes</span> <span class="ow">in</span> <span class="n">path</span><span class="o">.</span><span class="n">iter_segments</span><span class="p">(</span><span class="n">trans</span><span class="p">,</span> <span class="n">simplify</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">):</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">draw_path</span><span class="p">(</span><span class="n">gc</span><span class="p">,</span> <span class="n">marker_path</span><span class="p">,</span>
                               <span class="n">marker_trans</span> <span class="o">+</span>
                               <span class="n">transforms</span><span class="o">.</span><span class="n">Affine2D</span><span class="p">()</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
                               <span class="n">rgbFace</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_path_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">master_transform</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span> <span class="n">all_transforms</span><span class="p">,</span>
                             <span class="n">offsets</span><span class="p">,</span> <span class="n">offset_trans</span><span class="p">,</span> <span class="n">facecolors</span><span class="p">,</span> <span class="n">edgecolors</span><span class="p">,</span>
                             <span class="n">linewidths</span><span class="p">,</span> <span class="n">linestyles</span><span class="p">,</span> <span class="n">antialiaseds</span><span class="p">,</span> <span class="n">urls</span><span class="p">,</span>
                             <span class="n">offset_position</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a collection of *paths*.</span>

<span class="sd">        Each path is first transformed by the corresponding entry</span>
<span class="sd">        in *all_transforms* (a list of (3, 3) matrices) and then by</span>
<span class="sd">        *master_transform*.  They are then translated by the corresponding</span>
<span class="sd">        entry in *offsets*, which has been first transformed by *offset_trans*.</span>

<span class="sd">        *facecolors*, *edgecolors*, *linewidths*, *linestyles*, and</span>
<span class="sd">        *antialiased* are lists that set the corresponding properties.</span>

<span class="sd">        *offset_position* is unused now, but the argument is kept for</span>
<span class="sd">        backwards compatibility.</span>

<span class="sd">        The base (fallback) implementation makes multiple calls to `draw_path`.</span>
<span class="sd">        Backends may want to override this in order to render each set of</span>
<span class="sd">        path data only once, and then reference that path multiple times with</span>
<span class="sd">        the different offsets, colors, styles etc.  The generator methods</span>
<span class="sd">        `_iter_collection_raw_paths` and `_iter_collection` are provided to</span>
<span class="sd">        help with (and standardize) the implementation across backends.  It</span>
<span class="sd">        is highly recommended to use those generators, so that changes to the</span>
<span class="sd">        behavior of `draw_path_collection` can be made globally.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_collection_raw_paths</span><span class="p">(</span><span class="n">master_transform</span><span class="p">,</span>
                                                   <span class="n">paths</span><span class="p">,</span> <span class="n">all_transforms</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">xo</span><span class="p">,</span> <span class="n">yo</span><span class="p">,</span> <span class="n">path_id</span><span class="p">,</span> <span class="n">gc0</span><span class="p">,</span> <span class="n">rgbFace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_collection</span><span class="p">(</span>
                <span class="n">gc</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">path_ids</span><span class="p">),</span> <span class="n">offsets</span><span class="p">,</span> <span class="n">offset_trans</span><span class="p">,</span>
                <span class="n">facecolors</span><span class="p">,</span> <span class="n">edgecolors</span><span class="p">,</span> <span class="n">linewidths</span><span class="p">,</span> <span class="n">linestyles</span><span class="p">,</span>
                <span class="n">antialiaseds</span><span class="p">,</span> <span class="n">urls</span><span class="p">,</span> <span class="n">offset_position</span><span class="p">):</span>
            <span class="n">path</span><span class="p">,</span> <span class="n">transform</span> <span class="o">=</span> <span class="n">path_id</span>
            <span class="c1"># Only apply another translation if we have an offset, else we</span>
            <span class="c1"># reuse the initial transform.</span>
            <span class="k">if</span> <span class="n">xo</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">yo</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># The transformation can be used by multiple paths. Since</span>
                <span class="c1"># translate is a inplace operation, we need to copy the</span>
                <span class="c1"># transformation by .frozen() before applying the translation.</span>
                <span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">frozen</span><span class="p">()</span>
                <span class="n">transform</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">xo</span><span class="p">,</span> <span class="n">yo</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_path</span><span class="p">(</span><span class="n">gc0</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">rgbFace</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_quad_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">master_transform</span><span class="p">,</span> <span class="n">meshWidth</span><span class="p">,</span> <span class="n">meshHeight</span><span class="p">,</span>
                       <span class="n">coordinates</span><span class="p">,</span> <span class="n">offsets</span><span class="p">,</span> <span class="n">offsetTrans</span><span class="p">,</span> <span class="n">facecolors</span><span class="p">,</span>
                       <span class="n">antialiased</span><span class="p">,</span> <span class="n">edgecolors</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a quadmesh.</span>

<span class="sd">        The base (fallback) implementation converts the quadmesh to paths and</span>
<span class="sd">        then calls `draw_path_collection`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">matplotlib.collections</span> <span class="kn">import</span> <span class="n">QuadMesh</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="n">QuadMesh</span><span class="o">.</span><span class="n">_convert_mesh_to_paths</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">edgecolors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">edgecolors</span> <span class="o">=</span> <span class="n">facecolors</span>
        <span class="n">linewidths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">gc</span><span class="o">.</span><span class="n">get_linewidth</span><span class="p">()],</span> <span class="nb">float</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_path_collection</span><span class="p">(</span>
            <span class="n">gc</span><span class="p">,</span> <span class="n">master_transform</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span> <span class="p">[],</span> <span class="n">offsets</span><span class="p">,</span> <span class="n">offsetTrans</span><span class="p">,</span> <span class="n">facecolors</span><span class="p">,</span>
            <span class="n">edgecolors</span><span class="p">,</span> <span class="n">linewidths</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span><span class="n">antialiased</span><span class="p">],</span> <span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="s1">&#39;screen&#39;</span><span class="p">)</span>

    <span class="nd">@_api</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.7&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;draw_gouraud_triangles&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">draw_gouraud_triangle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">transform</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a Gouraud-shaded triangle.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gc : `.GraphicsContextBase`</span>
<span class="sd">            The graphics context.</span>
<span class="sd">        points : (3, 2) array-like</span>
<span class="sd">            Array of (x, y) points for the triangle.</span>
<span class="sd">        colors : (3, 4) array-like</span>
<span class="sd">            RGBA colors for each point of the triangle.</span>
<span class="sd">        transform : `matplotlib.transforms.Transform`</span>
<span class="sd">            An affine transform to apply to the points.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">draw_gouraud_triangles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">triangles_array</span><span class="p">,</span> <span class="n">colors_array</span><span class="p">,</span>
                               <span class="n">transform</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a series of Gouraud triangles.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        points : (N, 3, 2) array-like</span>
<span class="sd">            Array of *N* (x, y) points for the triangles.</span>
<span class="sd">        colors : (N, 3, 4) array-like</span>
<span class="sd">            Array of *N* RGBA colors for each point of the triangles.</span>
<span class="sd">        transform : `matplotlib.transforms.Transform`</span>
<span class="sd">            An affine transform to apply to the points.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">_iter_collection_raw_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master_transform</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span>
                                   <span class="n">all_transforms</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method (along with `_iter_collection`) to implement</span>
<span class="sd">        `draw_path_collection` in a memory-efficient manner.</span>

<span class="sd">        This method yields all of the base path/transform combinations, given a</span>
<span class="sd">        master transform, a list of paths and list of transforms.</span>

<span class="sd">        The arguments should be exactly what is passed in to</span>
<span class="sd">        `draw_path_collection`.</span>

<span class="sd">        The backend should take each yielded path and transform and create an</span>
<span class="sd">        object that can be referenced (reused) later.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Npaths</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>
        <span class="n">Ntransforms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_transforms</span><span class="p">)</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Npaths</span><span class="p">,</span> <span class="n">Ntransforms</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">Npaths</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">IdentityTransform</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="n">Npaths</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">Ntransforms</span><span class="p">:</span>
                <span class="n">transform</span> <span class="o">=</span> <span class="n">Affine2D</span><span class="p">(</span><span class="n">all_transforms</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="n">Ntransforms</span><span class="p">])</span>
            <span class="k">yield</span> <span class="n">path</span><span class="p">,</span> <span class="n">transform</span> <span class="o">+</span> <span class="n">master_transform</span>

    <span class="k">def</span> <span class="nf">_iter_collection_uses_per_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span> <span class="n">all_transforms</span><span class="p">,</span>
                                       <span class="n">offsets</span><span class="p">,</span> <span class="n">facecolors</span><span class="p">,</span> <span class="n">edgecolors</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute how many times each raw path object returned by</span>
<span class="sd">        `_iter_collection_raw_paths` would be used when calling</span>
<span class="sd">        `_iter_collection`. This is intended for the backend to decide</span>
<span class="sd">        on the tradeoff between using the paths in-line and storing</span>
<span class="sd">        them once and reusing. Rounds up in case the number of uses</span>
<span class="sd">        is not the same for every path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Npaths</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Npaths</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">facecolors</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">edgecolors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">Npath_ids</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Npaths</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_transforms</span><span class="p">))</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Npath_ids</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">offsets</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="n">Npath_ids</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">Npath_ids</span>

    <span class="k">def</span> <span class="nf">_iter_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">path_ids</span><span class="p">,</span> <span class="n">offsets</span><span class="p">,</span> <span class="n">offset_trans</span><span class="p">,</span> <span class="n">facecolors</span><span class="p">,</span>
                         <span class="n">edgecolors</span><span class="p">,</span> <span class="n">linewidths</span><span class="p">,</span> <span class="n">linestyles</span><span class="p">,</span>
                         <span class="n">antialiaseds</span><span class="p">,</span> <span class="n">urls</span><span class="p">,</span> <span class="n">offset_position</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method (along with `_iter_collection_raw_paths`) to implement</span>
<span class="sd">        `draw_path_collection` in a memory-efficient manner.</span>

<span class="sd">        This method yields all of the path, offset and graphics context</span>
<span class="sd">        combinations to draw the path collection.  The caller should already</span>
<span class="sd">        have looped over the results of `_iter_collection_raw_paths` to draw</span>
<span class="sd">        this collection.</span>

<span class="sd">        The arguments should be the same as that passed into</span>
<span class="sd">        `draw_path_collection`, with the exception of *path_ids*, which is a</span>
<span class="sd">        list of arbitrary objects that the backend will use to reference one of</span>
<span class="sd">        the paths created in the `_iter_collection_raw_paths` stage.</span>

<span class="sd">        Each yielded result is of the form::</span>

<span class="sd">           xo, yo, path_id, gc, rgbFace</span>

<span class="sd">        where *xo*, *yo* is an offset; *path_id* is one of the elements of</span>
<span class="sd">        *path_ids*; *gc* is a graphics context and *rgbFace* is a color to</span>
<span class="sd">        use for filling the path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Npaths</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">path_ids</span><span class="p">)</span>
        <span class="n">Noffsets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">offsets</span><span class="p">)</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Npaths</span><span class="p">,</span> <span class="n">Noffsets</span><span class="p">)</span>
        <span class="n">Nfacecolors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">facecolors</span><span class="p">)</span>
        <span class="n">Nedgecolors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">edgecolors</span><span class="p">)</span>
        <span class="n">Nlinewidths</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">linewidths</span><span class="p">)</span>
        <span class="n">Nlinestyles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">linestyles</span><span class="p">)</span>
        <span class="n">Nurls</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">Nfacecolors</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">Nedgecolors</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">Npaths</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">gc0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_gc</span><span class="p">()</span>
        <span class="n">gc0</span><span class="o">.</span><span class="n">copy_properties</span><span class="p">(</span><span class="n">gc</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">cycle_or_default</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="c1"># Cycle over *seq* if it is not empty; else always yield *default*.</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
                    <span class="k">else</span> <span class="n">itertools</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">default</span><span class="p">))</span>

        <span class="n">pathids</span> <span class="o">=</span> <span class="n">cycle_or_default</span><span class="p">(</span><span class="n">path_ids</span><span class="p">)</span>
        <span class="n">toffsets</span> <span class="o">=</span> <span class="n">cycle_or_default</span><span class="p">(</span><span class="n">offset_trans</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">offsets</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">fcs</span> <span class="o">=</span> <span class="n">cycle_or_default</span><span class="p">(</span><span class="n">facecolors</span><span class="p">)</span>
        <span class="n">ecs</span> <span class="o">=</span> <span class="n">cycle_or_default</span><span class="p">(</span><span class="n">edgecolors</span><span class="p">)</span>
        <span class="n">lws</span> <span class="o">=</span> <span class="n">cycle_or_default</span><span class="p">(</span><span class="n">linewidths</span><span class="p">)</span>
        <span class="n">lss</span> <span class="o">=</span> <span class="n">cycle_or_default</span><span class="p">(</span><span class="n">linestyles</span><span class="p">)</span>
        <span class="n">aas</span> <span class="o">=</span> <span class="n">cycle_or_default</span><span class="p">(</span><span class="n">antialiaseds</span><span class="p">)</span>
        <span class="n">urls</span> <span class="o">=</span> <span class="n">cycle_or_default</span><span class="p">(</span><span class="n">urls</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">Nedgecolors</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gc0</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">pathid</span><span class="p">,</span> <span class="p">(</span><span class="n">xo</span><span class="p">,</span> <span class="n">yo</span><span class="p">),</span> <span class="n">fc</span><span class="p">,</span> <span class="n">ec</span><span class="p">,</span> <span class="n">lw</span><span class="p">,</span> <span class="n">ls</span><span class="p">,</span> <span class="n">aa</span><span class="p">,</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span>
                <span class="nb">zip</span><span class="p">(</span><span class="n">pathids</span><span class="p">,</span> <span class="n">toffsets</span><span class="p">,</span> <span class="n">fcs</span><span class="p">,</span> <span class="n">ecs</span><span class="p">,</span> <span class="n">lws</span><span class="p">,</span> <span class="n">lss</span><span class="p">,</span> <span class="n">aas</span><span class="p">,</span> <span class="n">urls</span><span class="p">),</span> <span class="n">N</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">xo</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">yo</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">Nedgecolors</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">Nlinewidths</span><span class="p">:</span>
                    <span class="n">gc0</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">lw</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">Nlinestyles</span><span class="p">:</span>
                    <span class="n">gc0</span><span class="o">.</span><span class="n">set_dashes</span><span class="p">(</span><span class="o">*</span><span class="n">ls</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ec</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">ec</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">gc0</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">gc0</span><span class="o">.</span><span class="n">set_foreground</span><span class="p">(</span><span class="n">ec</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">fc</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">fc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">fc</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">gc0</span><span class="o">.</span><span class="n">set_antialiased</span><span class="p">(</span><span class="n">aa</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Nurls</span><span class="p">:</span>
                <span class="n">gc0</span><span class="o">.</span><span class="n">set_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">xo</span><span class="p">,</span> <span class="n">yo</span><span class="p">,</span> <span class="n">pathid</span><span class="p">,</span> <span class="n">gc0</span><span class="p">,</span> <span class="n">fc</span>
        <span class="n">gc0</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_image_magnification</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the factor by which to magnify images passed to `draw_image`.</span>
<span class="sd">        Allows a backend to have images at a different resolution to other</span>
<span class="sd">        artists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mf">1.0</span>

    <span class="k">def</span> <span class="nf">draw_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">im</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw an RGBA image.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gc : `.GraphicsContextBase`</span>
<span class="sd">            A graphics context with clipping information.</span>

<span class="sd">        x : scalar</span>
<span class="sd">            The distance in physical units (i.e., dots or pixels) from the left</span>
<span class="sd">            hand side of the canvas.</span>

<span class="sd">        y : scalar</span>
<span class="sd">            The distance in physical units (i.e., dots or pixels) from the</span>
<span class="sd">            bottom side of the canvas.</span>

<span class="sd">        im : (N, M, 4) array-like of np.uint8</span>
<span class="sd">            An array of RGBA pixels.</span>

<span class="sd">        transform : `matplotlib.transforms.Affine2DBase`</span>
<span class="sd">            If and only if the concrete backend is written such that</span>
<span class="sd">            `option_scale_image` returns ``True``, an affine transformation</span>
<span class="sd">            (i.e., an `.Affine2DBase`) *may* be passed to `draw_image`.  The</span>
<span class="sd">            translation vector of the transformation is given in physical units</span>
<span class="sd">            (i.e., dots or pixels). Note that the transformation does not</span>
<span class="sd">            override *x* and *y*, and has to be applied *before* translating</span>
<span class="sd">            the result by *x* and *y* (this can be accomplished by adding *x*</span>
<span class="sd">            and *y* to the translation vector defined by *transform*).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">option_image_nocomposite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return whether image composition by Matplotlib should be skipped.</span>

<span class="sd">        Raster backends should usually return False (letting the C-level</span>
<span class="sd">        rasterizer take care of image composition); vector backends should</span>
<span class="sd">        usually return ``not rcParams[&quot;image.composite_image&quot;]``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">option_scale_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return whether arbitrary affine transformations in `draw_image` are</span>
<span class="sd">        supported (True for most vector backends).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">draw_tex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">mtext</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a TeX instance.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gc : `.GraphicsContextBase`</span>
<span class="sd">            The graphics context.</span>
<span class="sd">        x : float</span>
<span class="sd">            The x location of the text in display coords.</span>
<span class="sd">        y : float</span>
<span class="sd">            The y location of the text baseline in display coords.</span>
<span class="sd">        s : str</span>
<span class="sd">            The TeX text string.</span>
<span class="sd">        prop : `~matplotlib.font_manager.FontProperties`</span>
<span class="sd">            The font properties.</span>
<span class="sd">        angle : float</span>
<span class="sd">            The rotation angle in degrees anti-clockwise.</span>
<span class="sd">        mtext : `matplotlib.text.Text`</span>
<span class="sd">            The original text object to be rendered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_text_as_path</span><span class="p">(</span><span class="n">gc</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">ismath</span><span class="o">=</span><span class="s2">&quot;TeX&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">ismath</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mtext</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a text instance.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gc : `.GraphicsContextBase`</span>
<span class="sd">            The graphics context.</span>
<span class="sd">        x : float</span>
<span class="sd">            The x location of the text in display coords.</span>
<span class="sd">        y : float</span>
<span class="sd">            The y location of the text baseline in display coords.</span>
<span class="sd">        s : str</span>
<span class="sd">            The text string.</span>
<span class="sd">        prop : `~matplotlib.font_manager.FontProperties`</span>
<span class="sd">            The font properties.</span>
<span class="sd">        angle : float</span>
<span class="sd">            The rotation angle in degrees anti-clockwise.</span>
<span class="sd">        ismath : bool or &quot;TeX&quot;</span>
<span class="sd">            If True, use mathtext parser. If &quot;TeX&quot;, use tex for rendering.</span>
<span class="sd">        mtext : `matplotlib.text.Text`</span>
<span class="sd">            The original text object to be rendered.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        **Note for backend implementers:**</span>

<span class="sd">        When you are trying to determine if you have gotten your bounding box</span>
<span class="sd">        right (which is what enables the text layout/alignment to work</span>
<span class="sd">        properly), it helps to change the line in text.py::</span>

<span class="sd">            if 0: bbox_artist(self, renderer)</span>

<span class="sd">        to if 1, and then the actual bounding box will be plotted along with</span>
<span class="sd">        your text.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_text_as_path</span><span class="p">(</span><span class="n">gc</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">ismath</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_text_path_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">ismath</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the text path and transform.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : float</span>
<span class="sd">            The x location of the text in display coords.</span>
<span class="sd">        y : float</span>
<span class="sd">            The y location of the text baseline in display coords.</span>
<span class="sd">        s : str</span>
<span class="sd">            The text to be converted.</span>
<span class="sd">        prop : `~matplotlib.font_manager.FontProperties`</span>
<span class="sd">            The font property.</span>
<span class="sd">        angle : float</span>
<span class="sd">            Angle in degrees to render the text at.</span>
<span class="sd">        ismath : bool or &quot;TeX&quot;</span>
<span class="sd">            If True, use mathtext parser. If &quot;TeX&quot;, use tex for rendering.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">text2path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_text2path</span>
        <span class="n">fontsize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points_to_pixels</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">get_size_in_points</span><span class="p">())</span>
        <span class="n">verts</span><span class="p">,</span> <span class="n">codes</span> <span class="o">=</span> <span class="n">text2path</span><span class="o">.</span><span class="n">get_text_path</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">ismath</span><span class="o">=</span><span class="n">ismath</span><span class="p">)</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flipy</span><span class="p">():</span>
            <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_canvas_width_height</span><span class="p">()</span>
            <span class="n">transform</span> <span class="o">=</span> <span class="p">(</span><span class="n">Affine2D</span><span class="p">()</span>
                         <span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">/</span> <span class="n">text2path</span><span class="o">.</span><span class="n">FONT_SCALE</span><span class="p">)</span>
                         <span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
                         <span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="n">y</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">transform</span> <span class="o">=</span> <span class="p">(</span><span class="n">Affine2D</span><span class="p">()</span>
                         <span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">/</span> <span class="n">text2path</span><span class="o">.</span><span class="n">FONT_SCALE</span><span class="p">)</span>
                         <span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
                         <span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">path</span><span class="p">,</span> <span class="n">transform</span>

    <span class="k">def</span> <span class="nf">_draw_text_as_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">ismath</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw the text by converting them to paths using `.TextToPath`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : float</span>
<span class="sd">            The x location of the text in display coords.</span>
<span class="sd">        y : float</span>
<span class="sd">            The y location of the text baseline in display coords.</span>
<span class="sd">        s : str</span>
<span class="sd">            The text to be converted.</span>
<span class="sd">        prop : `~matplotlib.font_manager.FontProperties`</span>
<span class="sd">            The font property.</span>
<span class="sd">        angle : float</span>
<span class="sd">            Angle in degrees to render the text at.</span>
<span class="sd">        ismath : bool or &quot;TeX&quot;</span>
<span class="sd">            If True, use mathtext parser. If &quot;TeX&quot;, use tex for rendering.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span><span class="p">,</span> <span class="n">transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_text_path_transform</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">ismath</span><span class="p">)</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">get_rgb</span><span class="p">()</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_path</span><span class="p">(</span><span class="n">gc</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">rgbFace</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_text_width_height_descent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">ismath</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the width, height, and descent (offset from the bottom</span>
<span class="sd">        to the baseline), in display coords, of the string *s* with</span>
<span class="sd">        `.FontProperties` *prop*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fontsize</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">get_size_in_points</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ismath</span> <span class="o">==</span> <span class="s1">&#39;TeX&#39;</span><span class="p">:</span>
            <span class="c1"># todo: handle properties</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_texmanager</span><span class="p">()</span><span class="o">.</span><span class="n">get_text_width_height_descent</span><span class="p">(</span>
                <span class="n">s</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">dpi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points_to_pixels</span><span class="p">(</span><span class="mi">72</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ismath</span><span class="p">:</span>
            <span class="n">dims</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_text2path</span><span class="o">.</span><span class="n">mathtext_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">dpi</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># return width, height, descent</span>

        <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_text2path</span><span class="o">.</span><span class="n">_get_hinting_flag</span><span class="p">()</span>
        <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_text2path</span><span class="o">.</span><span class="n">_get_font</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="n">font</span><span class="o">.</span><span class="n">set_size</span><span class="p">(</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span>
        <span class="c1"># the width and height of unrotated string</span>
        <span class="n">font</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">)</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_width_height</span><span class="p">()</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_descent</span><span class="p">()</span>
        <span class="n">w</span> <span class="o">/=</span> <span class="mf">64.0</span>  <span class="c1"># convert from subpixels</span>
        <span class="n">h</span> <span class="o">/=</span> <span class="mf">64.0</span>
        <span class="n">d</span> <span class="o">/=</span> <span class="mf">64.0</span>
        <span class="k">return</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">d</span>

    <span class="k">def</span> <span class="nf">flipy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return whether y values increase from top to bottom.</span>

<span class="sd">        Note that this only affects drawing of texts.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_canvas_width_height</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the canvas width and height in display coords.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">get_texmanager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the `.TexManager` instance.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_texmanager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_texmanager</span> <span class="o">=</span> <span class="n">TexManager</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_texmanager</span>

    <span class="k">def</span> <span class="nf">new_gc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return an instance of a `.GraphicsContextBase`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">GraphicsContextBase</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">points_to_pixels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert points to display units.</span>

<span class="sd">        You need to override this function (unless your backend</span>
<span class="sd">        doesn&#39;t have a dpi, e.g., postscript or svg).  Some imaging</span>
<span class="sd">        systems assume some value for pixels per inch::</span>

<span class="sd">            points to pixels = points * pixels_per_inch/72 * dpi/72</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        points : float or array-like</span>
<span class="sd">            a float or a numpy array of float</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Points converted to pixels</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">points</span>

    <span class="k">def</span> <span class="nf">start_rasterizing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Switch to the raster renderer.</span>

<span class="sd">        Used by `.MixedModeRenderer`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">stop_rasterizing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Switch back to the vector renderer and draw the contents of the raster</span>
<span class="sd">        renderer as an image on the vector renderer.</span>

<span class="sd">        Used by `.MixedModeRenderer`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">start_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Switch to a temporary renderer for image filtering effects.</span>

<span class="sd">        Currently only supported by the agg renderer.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">stop_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filter_func</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Switch back to the original renderer.  The contents of the temporary</span>
<span class="sd">        renderer is processed with the *filter_func* and is drawn on the</span>
<span class="sd">        original renderer as an image.</span>

<span class="sd">        Currently only supported by the agg renderer.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_draw_disabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Context manager to temporary disable drawing.</span>

<span class="sd">        This is used for getting the drawn size of Artists.  This lets us</span>
<span class="sd">        run the draw process to update any Python state but does not pay the</span>
<span class="sd">        cost of the draw_XYZ calls on the canvas.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">no_ops</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">meth_name</span><span class="p">:</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">meth_name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">RendererBase</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">meth_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;draw_&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">meth_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;open_group&quot;</span><span class="p">,</span> <span class="s2">&quot;close_group&quot;</span><span class="p">])</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">_setattr_cm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">no_ops</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">GraphicsContextBase</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An abstract base class that provides color, line styles, etc.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_forced_alpha</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># if True, _alpha overrides A from RGBA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_antialiased</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># use 0, 1 not True, False for extension code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_capstyle</span> <span class="o">=</span> <span class="n">CapStyle</span><span class="p">(</span><span class="s1">&#39;butt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cliprect</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clippath</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dashes</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_joinstyle</span> <span class="o">=</span> <span class="n">JoinStyle</span><span class="p">(</span><span class="s1">&#39;round&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_linestyle</span> <span class="o">=</span> <span class="s1">&#39;solid&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_linewidth</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rgb</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hatch</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hatch_color</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;hatch.color&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hatch_linewidth</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;hatch.linewidth&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_snap</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sketch</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">copy_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Copy properties from *gc* to self.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_alpha</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_forced_alpha</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_forced_alpha</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_antialiased</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_antialiased</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_capstyle</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_capstyle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cliprect</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_cliprect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clippath</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_clippath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dashes</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_dashes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_joinstyle</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_joinstyle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_linestyle</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_linestyle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_linewidth</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_linewidth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rgb</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_rgb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hatch</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_hatch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hatch_color</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_hatch_color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hatch_linewidth</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_hatch_linewidth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gid</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_gid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_snap</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_snap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sketch</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_sketch</span>

    <span class="k">def</span> <span class="nf">restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restore the graphics context from the stack - needed only</span>
<span class="sd">        for backends that save graphics contexts on a stack.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">get_alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the alpha value used for blending - not supported on all</span>
<span class="sd">        backends.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span>

    <span class="k">def</span> <span class="nf">get_antialiased</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether the object should try to do antialiased rendering.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_antialiased</span>

    <span class="k">def</span> <span class="nf">get_capstyle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the `.CapStyle`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_capstyle</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="nf">get_clip_rectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the clip rectangle as a `~matplotlib.transforms.Bbox` instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliprect</span>

    <span class="k">def</span> <span class="nf">get_clip_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the clip path in the form (path, transform), where path</span>
<span class="sd">        is a `~.path.Path` instance, and transform is</span>
<span class="sd">        an affine transform to apply to the path before clipping.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clippath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tpath</span><span class="p">,</span> <span class="n">tr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clippath</span><span class="o">.</span><span class="n">get_transformed_path_and_affine</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">tpath</span><span class="o">.</span><span class="n">vertices</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">tpath</span><span class="p">,</span> <span class="n">tr</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Ill-defined clip_path detected. Returning None.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get_dashes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the dash style as an (offset, dash-list) pair.</span>

<span class="sd">        See `.set_dashes` for details.</span>

<span class="sd">        Default value is (None, None).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dashes</span>

    <span class="k">def</span> <span class="nf">get_forced_alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return whether the value given by get_alpha() should be used to</span>
<span class="sd">        override any other alpha-channel values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forced_alpha</span>

    <span class="k">def</span> <span class="nf">get_joinstyle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the `.JoinStyle`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_joinstyle</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="nf">get_linewidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the line width in points.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linewidth</span>

    <span class="k">def</span> <span class="nf">get_rgb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a tuple of three or four floats from 0-1.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rgb</span>

    <span class="k">def</span> <span class="nf">get_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a url if one is set, None otherwise.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span>

    <span class="k">def</span> <span class="nf">get_gid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the object identifier if one is set, None otherwise.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gid</span>

    <span class="k">def</span> <span class="nf">get_snap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the snap setting, which can be:</span>

<span class="sd">        * True: snap vertices to the nearest pixel center</span>
<span class="sd">        * False: leave vertices as-is</span>
<span class="sd">        * None: (auto) If the path contains only rectilinear line segments,</span>
<span class="sd">          round to the nearest pixel center</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_snap</span>

    <span class="k">def</span> <span class="nf">set_alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the alpha value used for blending - not supported on all backends.</span>

<span class="sd">        If ``alpha=None`` (the default), the alpha components of the</span>
<span class="sd">        foreground and fill colors will be used to set their respective</span>
<span class="sd">        transparencies (where applicable); otherwise, ``alpha`` will override</span>
<span class="sd">        them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span> <span class="o">=</span> <span class="n">alpha</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_forced_alpha</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_forced_alpha</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_foreground</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rgb</span><span class="p">,</span> <span class="n">isRGBA</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_antialiased</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set whether object should be drawn with antialiased rendering.&quot;&quot;&quot;</span>
        <span class="c1"># Use ints to make life easier on extension code trying to read the gc.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_antialiased</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>

    <span class="nd">@_docstring</span><span class="o">.</span><span class="n">interpd</span>
    <span class="k">def</span> <span class="nf">set_capstyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set how to draw endpoints of lines.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cs : `.CapStyle` or %(CapStyle)s</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_capstyle</span> <span class="o">=</span> <span class="n">CapStyle</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_clip_rectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rectangle</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the clip rectangle to a `.Bbox` or None.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cliprect</span> <span class="o">=</span> <span class="n">rectangle</span>

    <span class="k">def</span> <span class="nf">set_clip_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the clip path to a `.TransformedPath` or None.&quot;&quot;&quot;</span>
        <span class="n">_api</span><span class="o">.</span><span class="n">check_isinstance</span><span class="p">((</span><span class="n">transforms</span><span class="o">.</span><span class="n">TransformedPath</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clippath</span> <span class="o">=</span> <span class="n">path</span>

    <span class="k">def</span> <span class="nf">set_dashes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dash_offset</span><span class="p">,</span> <span class="n">dash_list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the dash style for the gc.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dash_offset : float</span>
<span class="sd">            Distance, in points, into the dash pattern at which to</span>
<span class="sd">            start the pattern. It is usually set to 0.</span>
<span class="sd">        dash_list : array-like or None</span>
<span class="sd">            The on-off sequence as points.  None specifies a solid line. All</span>
<span class="sd">            values must otherwise be non-negative (:math:`\\ge 0`).</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        See p. 666 of the PostScript</span>
<span class="sd">        `Language Reference</span>
<span class="sd">        &lt;https://www.adobe.com/jp/print/postscript/pdfs/PLRM.pdf&gt;`_</span>
<span class="sd">        for more info.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dash_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">dash_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">dl</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;All values in the dash list must be non-negative&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dl</span><span class="o">.</span><span class="n">size</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">dl</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;At least one value in the dash list must be positive&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dashes</span> <span class="o">=</span> <span class="n">dash_offset</span><span class="p">,</span> <span class="n">dash_list</span>

    <span class="k">def</span> <span class="nf">set_foreground</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fg</span><span class="p">,</span> <span class="n">isRGBA</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the foreground color.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fg : color</span>
<span class="sd">        isRGBA : bool</span>
<span class="sd">            If *fg* is known to be an ``(r, g, b, a)`` tuple, *isRGBA* can be</span>
<span class="sd">            set to True to improve performance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forced_alpha</span> <span class="ow">and</span> <span class="n">isRGBA</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rgb</span> <span class="o">=</span> <span class="n">fg</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span><span class="p">,)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forced_alpha</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rgb</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">fg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">isRGBA</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rgb</span> <span class="o">=</span> <span class="n">fg</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rgb</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">fg</span><span class="p">)</span>

    <span class="nd">@_docstring</span><span class="o">.</span><span class="n">interpd</span>
    <span class="k">def</span> <span class="nf">set_joinstyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">js</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set how to draw connections between line segments.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        js : `.JoinStyle` or %(JoinStyle)s</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_joinstyle</span> <span class="o">=</span> <span class="n">JoinStyle</span><span class="p">(</span><span class="n">js</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_linewidth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the linewidth in points.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_linewidth</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the url for links in compatible backends.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">=</span> <span class="n">url</span>

    <span class="k">def</span> <span class="nf">set_gid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the id.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gid</span> <span class="o">=</span> <span class="nb">id</span>

    <span class="k">def</span> <span class="nf">set_snap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">snap</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the snap setting which may be:</span>

<span class="sd">        * True: snap vertices to the nearest pixel center</span>
<span class="sd">        * False: leave vertices as-is</span>
<span class="sd">        * None: (auto) If the path contains only rectilinear line segments,</span>
<span class="sd">          round to the nearest pixel center</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_snap</span> <span class="o">=</span> <span class="n">snap</span>

    <span class="k">def</span> <span class="nf">set_hatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hatch</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the hatch style (for fills).&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hatch</span> <span class="o">=</span> <span class="n">hatch</span>

    <span class="k">def</span> <span class="nf">get_hatch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the current hatch style.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hatch</span>

    <span class="k">def</span> <span class="nf">get_hatch_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="mf">6.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a `.Path` for the current hatch.&quot;&quot;&quot;</span>
        <span class="n">hatch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_hatch</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">hatch</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">Path</span><span class="o">.</span><span class="n">hatch</span><span class="p">(</span><span class="n">hatch</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_hatch_color</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the hatch color.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hatch_color</span>

    <span class="k">def</span> <span class="nf">set_hatch_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hatch_color</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the hatch color.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hatch_color</span> <span class="o">=</span> <span class="n">hatch_color</span>

    <span class="k">def</span> <span class="nf">get_hatch_linewidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the hatch linewidth.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hatch_linewidth</span>

    <span class="k">def</span> <span class="nf">get_sketch_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the sketch parameters for the artist.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple or `None`</span>

<span class="sd">            A 3-tuple with the following elements:</span>

<span class="sd">            * ``scale``: The amplitude of the wiggle perpendicular to the</span>
<span class="sd">              source line.</span>
<span class="sd">            * ``length``: The length of the wiggle along the line.</span>
<span class="sd">            * ``randomness``: The scale factor by which the length is</span>
<span class="sd">              shrunken or expanded.</span>

<span class="sd">            May return `None` if no sketch parameters were set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sketch</span>

    <span class="k">def</span> <span class="nf">set_sketch_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">randomness</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the sketch parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        scale : float, optional</span>
<span class="sd">            The amplitude of the wiggle perpendicular to the source line, in</span>
<span class="sd">            pixels.  If scale is `None`, or not provided, no sketch filter will</span>
<span class="sd">            be provided.</span>
<span class="sd">        length : float, default: 128</span>
<span class="sd">            The length of the wiggle along the line, in pixels.</span>
<span class="sd">        randomness : float, default: 16</span>
<span class="sd">            The scale factor by which the length is shrunken or expanded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sketch</span> <span class="o">=</span> <span class="p">(</span>
            <span class="kc">None</span> <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">length</span> <span class="ow">or</span> <span class="mf">128.</span><span class="p">,</span> <span class="n">randomness</span> <span class="ow">or</span> <span class="mf">16.</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">TimerBase</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A base class for providing timer events, useful for things animations.</span>
<span class="sd">    Backends need to implement a few specific methods in order to use their</span>
<span class="sd">    own timing mechanisms so that the timer events are integrated into their</span>
<span class="sd">    event loops.</span>

<span class="sd">    Subclasses must override the following methods:</span>

<span class="sd">    - ``_timer_start``: Backend-specific code for starting the timer.</span>
<span class="sd">    - ``_timer_stop``: Backend-specific code for stopping the timer.</span>

<span class="sd">    Subclasses may additionally override the following methods:</span>

<span class="sd">    - ``_timer_set_single_shot``: Code for setting the timer to single shot</span>
<span class="sd">      operating mode, if supported by the timer object.  If not, the `Timer`</span>
<span class="sd">      class itself will store the flag and the ``_on_timer`` method should be</span>
<span class="sd">      overridden to support such behavior.</span>

<span class="sd">    - ``_timer_set_interval``: Code for setting the interval on the timer, if</span>
<span class="sd">      there is a method for doing so on the timer object.</span>

<span class="sd">    - ``_on_timer``: The internal function that any timer object should call,</span>
<span class="sd">      which will handle the task of running all callbacks that have been set.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        interval : int, default: 1000ms</span>
<span class="sd">            The time between timer events in milliseconds.  Will be stored as</span>
<span class="sd">            ``timer.interval``.</span>
<span class="sd">        callbacks : list[tuple[callable, tuple, dict]]</span>
<span class="sd">            List of (func, args, kwargs) tuples that will be called upon</span>
<span class="sd">            timer events.  This list is accessible as ``timer.callbacks`` and</span>
<span class="sd">            can be manipulated directly, or the functions `add_callback` and</span>
<span class="sd">            `remove_callback` can be used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">callbacks</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">callbacks</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># Set .interval and not ._interval to go through the property setter.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="mi">1000</span> <span class="k">if</span> <span class="n">interval</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">single_shot</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Need to stop timer and possibly disconnect timer.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timer_stop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start the timer object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        interval : int, optional</span>
<span class="sd">            Timer interval in milliseconds; overrides a previously set interval</span>
<span class="sd">            if provided.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">interval</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="n">interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timer_start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop the timer.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timer_stop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_timer_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_timer_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">interval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The time between timer events, in milliseconds.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interval</span>

    <span class="nd">@interval</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span><span class="p">):</span>
        <span class="c1"># Force to int since none of the backends actually support fractional</span>
        <span class="c1"># milliseconds, and some error or give warnings.</span>
        <span class="n">interval</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interval</span> <span class="o">=</span> <span class="n">interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timer_set_interval</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">single_shot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether this timer should stop after a single run.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_single</span>

    <span class="nd">@single_shot</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">single_shot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ss</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_single</span> <span class="o">=</span> <span class="n">ss</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timer_set_single_shot</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">add_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register *func* to be called by timer when the event fires. Any</span>
<span class="sd">        additional arguments provided will be passed to *func*.</span>

<span class="sd">        This function returns *func*, which makes it possible to use it as a</span>
<span class="sd">        decorator.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">func</span>

    <span class="k">def</span> <span class="nf">remove_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove *func* from list of callbacks.</span>

<span class="sd">        *args* and *kwargs* are optional and used to distinguish between copies</span>
<span class="sd">        of the same function registered to be called with different arguments.</span>
<span class="sd">        This behavior is deprecated.  In the future, ``*args, **kwargs`` won&#39;t</span>
<span class="sd">        be considered anymore; to keep a specific callback removable by itself,</span>
<span class="sd">        pass it to `add_callback` as a `functools.partial` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">_api</span><span class="o">.</span><span class="n">warn_deprecated</span><span class="p">(</span>
                <span class="s2">&quot;3.1&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;In a future version, Timer.remove_callback &quot;</span>
                <span class="s2">&quot;will not take *args, **kwargs anymore, but remove all &quot;</span>
                <span class="s2">&quot;callbacks where the callable matches; to keep a specific &quot;</span>
                <span class="s2">&quot;callback removable by itself, pass it to add_callback as a &quot;</span>
                <span class="s2">&quot;functools.partial object.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">remove</span><span class="p">((</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">funcs</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">funcs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">funcs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">func</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_timer_set_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Used to set interval on underlying timer object.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_timer_set_single_shot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Used to set single shot on underlying timer object.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_on_timer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs all function that have been registered as callbacks. Functions</span>
<span class="sd">        can return False (or 0) if they should not be called any more. If there</span>
<span class="sd">        are no callbacks, the timer is automatically stopped.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c1"># docstring above explains why we use `if ret == 0` here,</span>
            <span class="c1"># instead of `if not ret`.</span>
            <span class="c1"># This will also catch `ret == False` as `False == 0`</span>
            <span class="c1"># but does not annoy the linters</span>
            <span class="c1"># https://docs.python.org/3/library/stdtypes.html#boolean-values</span>
            <span class="k">if</span> <span class="n">ret</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">remove</span><span class="p">((</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Event</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Matplotlib event.</span>

<span class="sd">    The following attributes are defined and shown with their default values.</span>
<span class="sd">    Subclasses may define additional attributes.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The event name.</span>
<span class="sd">    canvas : `FigureCanvasBase`</span>
<span class="sd">        The backend-specific canvas instance generating the event.</span>
<span class="sd">    guiEvent</span>
<span class="sd">        The GUI event that triggered the Matplotlib event.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">guiEvent</span> <span class="o">=</span> <span class="n">guiEvent</span>

    <span class="k">def</span> <span class="nf">_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate an event with name ``self.name`` on ``self.canvas``.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DrawEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An event triggered by a draw operation on the canvas.</span>

<span class="sd">    In most backends, callbacks subscribed to this event will be fired after</span>
<span class="sd">    the rendering is complete but before the screen is updated. Any extra</span>
<span class="sd">    artists drawn to the canvas&#39;s renderer will be reflected without an</span>
<span class="sd">    explicit call to ``blit``.</span>

<span class="sd">    .. warning::</span>

<span class="sd">       Calling ``canvas.draw`` and ``canvas.blit`` in these callbacks may</span>
<span class="sd">       not be safe with all backends and may cause infinite recursion.</span>

<span class="sd">    A DrawEvent has a number of special attributes in addition to those defined</span>
<span class="sd">    by the parent `Event` class.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    renderer : `RendererBase`</span>
<span class="sd">        The renderer for the draw event.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">renderer</span> <span class="o">=</span> <span class="n">renderer</span>


<span class="k">class</span> <span class="nc">ResizeEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An event triggered by a canvas resize.</span>

<span class="sd">    A ResizeEvent has a number of special attributes in addition to those</span>
<span class="sd">    defined by the parent `Event` class.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    width : int</span>
<span class="sd">        Width of the canvas in pixels.</span>
<span class="sd">    height : int</span>
<span class="sd">        Height of the canvas in pixels.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_width_height</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">CloseEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An event triggered by a figure being closed.&quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">LocationEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An event that has a screen location.</span>

<span class="sd">    A LocationEvent has a number of special attributes in addition to those</span>
<span class="sd">    defined by the parent `Event` class.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    x, y : int or None</span>
<span class="sd">        Event location in pixels from bottom left of canvas.</span>
<span class="sd">    inaxes : `~.axes.Axes` or None</span>
<span class="sd">        The `~.axes.Axes` instance over which the mouse is, if any.</span>
<span class="sd">    xdata, ydata : float or None</span>
<span class="sd">        Data coordinates of the mouse within *inaxes*, or *None* if the mouse</span>
<span class="sd">        is not over an Axes.</span>
<span class="sd">    modifiers : frozenset</span>
<span class="sd">        The keyboard modifiers currently being pressed (except for KeyEvent).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">lastevent</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># The last event processed so far.</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">modifiers</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">guiEvent</span><span class="p">)</span>
        <span class="c1"># x position - pixels from left of canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">x</span>
        <span class="c1"># y position - pixels from right of canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># the Axes instance the mouse is over</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xdata</span> <span class="o">=</span> <span class="kc">None</span>   <span class="c1"># x coord of mouse in data coords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ydata</span> <span class="o">=</span> <span class="kc">None</span>   <span class="c1"># y coord of mouse in data coords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">modifiers</span> <span class="k">if</span> <span class="n">modifiers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[])</span>

        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># cannot check if event was in Axes if no (x, y) info</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mouse_grabber</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">inaxes</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mouse_grabber</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inaxes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">trans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inaxes</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span>
                <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">transform</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xdata</span> <span class="o">=</span> <span class="n">xdata</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ydata</span> <span class="o">=</span> <span class="n">ydata</span>


<span class="k">class</span> <span class="nc">MouseButton</span><span class="p">(</span><span class="n">IntEnum</span><span class="p">):</span>
    <span class="n">LEFT</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">MIDDLE</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">RIGHT</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">BACK</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">FORWARD</span> <span class="o">=</span> <span class="mi">9</span>


<span class="k">class</span> <span class="nc">MouseEvent</span><span class="p">(</span><span class="n">LocationEvent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A mouse event (&#39;button_press_event&#39;, &#39;button_release_event&#39;, \</span>
<span class="sd">&#39;scroll_event&#39;, &#39;motion_notify_event&#39;).</span>

<span class="sd">    A MouseEvent has a number of special attributes in addition to those</span>
<span class="sd">    defined by the parent `Event` and `LocationEvent` classes.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    button : None or `MouseButton` or {&#39;up&#39;, &#39;down&#39;}</span>
<span class="sd">        The button pressed. &#39;up&#39; and &#39;down&#39; are used for scroll events.</span>

<span class="sd">        Note that LEFT and RIGHT actually refer to the &quot;primary&quot; and</span>
<span class="sd">        &quot;secondary&quot; buttons, i.e. if the user inverts their left and right</span>
<span class="sd">        buttons (&quot;left-handed setting&quot;) then the LEFT button will be the one</span>
<span class="sd">        physically on the right.</span>

<span class="sd">        If this is unset, *name* is &quot;scroll_event&quot;, and *step* is nonzero, then</span>
<span class="sd">        this will be set to &quot;up&quot; or &quot;down&quot; depending on the sign of *step*.</span>

<span class="sd">    key : None or str</span>
<span class="sd">        The key pressed when the mouse event triggered, e.g. &#39;shift&#39;.</span>
<span class="sd">        See `KeyEvent`.</span>

<span class="sd">        .. warning::</span>
<span class="sd">           This key is currently obtained from the last &#39;key_press_event&#39; or</span>
<span class="sd">           &#39;key_release_event&#39; that occurred within the canvas.  Thus, if the</span>
<span class="sd">           last change of keyboard state occurred while the canvas did not have</span>
<span class="sd">           focus, this attribute will be wrong.  On the other hand, the</span>
<span class="sd">           ``modifiers`` attribute should always be correct, but it can only</span>
<span class="sd">           report on modifier keys.</span>

<span class="sd">    step : float</span>
<span class="sd">        The number of scroll steps (positive for &#39;up&#39;, negative for &#39;down&#39;).</span>
<span class="sd">        This applies only to &#39;scroll_event&#39; and defaults to 0 otherwise.</span>

<span class="sd">    dblclick : bool</span>
<span class="sd">        Whether the event is a double-click. This applies only to</span>
<span class="sd">        &#39;button_press_event&#39; and is False otherwise. In particular, it&#39;s</span>
<span class="sd">        not used in &#39;button_release_event&#39;.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ::</span>

<span class="sd">        def on_press(event):</span>
<span class="sd">            print(&#39;you pressed&#39;, event.button, event.xdata, event.ydata)</span>

<span class="sd">        cid = fig.canvas.mpl_connect(&#39;button_press_event&#39;, on_press)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">button</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">step</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dblclick</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">modifiers</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">guiEvent</span><span class="p">,</span> <span class="n">modifiers</span><span class="o">=</span><span class="n">modifiers</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">button</span> <span class="ow">in</span> <span class="n">MouseButton</span><span class="o">.</span><span class="n">__members__</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">button</span> <span class="o">=</span> <span class="n">MouseButton</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;scroll_event&quot;</span> <span class="ow">and</span> <span class="n">button</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">step</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">button</span> <span class="o">=</span> <span class="s2">&quot;up&quot;</span>
            <span class="k">elif</span> <span class="n">step</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">button</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button</span> <span class="o">=</span> <span class="n">button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dblclick</span> <span class="o">=</span> <span class="n">dblclick</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;xy=(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="si">}</span><span class="s2">) xydata=(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xdata</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ydata</span><span class="si">}</span><span class="s2">) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;button=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">button</span><span class="si">}</span><span class="s2"> dblclick=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dblclick</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;inaxes=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">inaxes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PickEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A pick event.</span>

<span class="sd">    This event is fired when the user picks a location on the canvas</span>
<span class="sd">    sufficiently close to an artist that has been made pickable with</span>
<span class="sd">    `.Artist.set_picker`.</span>

<span class="sd">    A PickEvent has a number of special attributes in addition to those defined</span>
<span class="sd">    by the parent `Event` class.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    mouseevent : `MouseEvent`</span>
<span class="sd">        The mouse event that generated the pick.</span>
<span class="sd">    artist : `matplotlib.artist.Artist`</span>
<span class="sd">        The picked artist.  Note that artists are not pickable by default</span>
<span class="sd">        (see `.Artist.set_picker`).</span>
<span class="sd">    other</span>
<span class="sd">        Additional attributes may be present depending on the type of the</span>
<span class="sd">        picked object; e.g., a `.Line2D` pick may define different extra</span>
<span class="sd">        attributes than a `.PatchCollection` pick.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Bind a function ``on_pick()`` to pick events, that prints the coordinates</span>
<span class="sd">    of the picked data point::</span>

<span class="sd">        ax.plot(np.rand(100), &#39;o&#39;, picker=5)  # 5 points tolerance</span>

<span class="sd">        def on_pick(event):</span>
<span class="sd">            line = event.artist</span>
<span class="sd">            xdata, ydata = line.get_data()</span>
<span class="sd">            ind = event.ind</span>
<span class="sd">            print(f&#39;on pick line: {xdata[ind]:.3f}, {ydata[ind]:.3f}&#39;)</span>

<span class="sd">        cid = fig.canvas.mpl_connect(&#39;pick_event&#39;, on_pick)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">mouseevent</span><span class="p">,</span> <span class="n">artist</span><span class="p">,</span>
                 <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">guiEvent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">guiEvent</span> <span class="o">=</span> <span class="n">mouseevent</span><span class="o">.</span><span class="n">guiEvent</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">guiEvent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouseevent</span> <span class="o">=</span> <span class="n">mouseevent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">artist</span> <span class="o">=</span> <span class="n">artist</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">KeyEvent</span><span class="p">(</span><span class="n">LocationEvent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A key event (key press, key release).</span>

<span class="sd">    A KeyEvent has a number of special attributes in addition to those defined</span>
<span class="sd">    by the parent `Event` and `LocationEvent` classes.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    key : None or str</span>
<span class="sd">        The key(s) pressed. Could be *None*, a single case sensitive Unicode</span>
<span class="sd">        character (&quot;g&quot;, &quot;G&quot;, &quot;#&quot;, etc.), a special key (&quot;control&quot;, &quot;shift&quot;,</span>
<span class="sd">        &quot;f1&quot;, &quot;up&quot;, etc.) or a combination of the above (e.g., &quot;ctrl+alt+g&quot;,</span>
<span class="sd">        &quot;ctrl+alt+G&quot;).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Modifier keys will be prefixed to the pressed key and will be in the order</span>
<span class="sd">    &quot;ctrl&quot;, &quot;alt&quot;, &quot;super&quot;. The exception to this rule is when the pressed key</span>
<span class="sd">    is itself a modifier key, therefore &quot;ctrl+alt&quot; and &quot;alt+control&quot; can both</span>
<span class="sd">    be valid key values.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ::</span>

<span class="sd">        def on_key(event):</span>
<span class="sd">            print(&#39;you pressed&#39;, event.key, event.xdata, event.ydata)</span>

<span class="sd">        cid = fig.canvas.mpl_connect(&#39;key_press_event&#39;, on_key)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">guiEvent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>


<span class="c1"># Default callback for key events.</span>
<span class="k">def</span> <span class="nf">_key_handler</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="c1"># Dead reckoning of key.</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;key_press_event&quot;</span><span class="p">:</span>
        <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">_key</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span>
    <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;key_release_event&quot;</span><span class="p">:</span>
        <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">_key</span> <span class="o">=</span> <span class="kc">None</span>


<span class="c1"># Default callback for mouse events.</span>
<span class="k">def</span> <span class="nf">_mouse_handler</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="c1"># Dead-reckoning of button and key.</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;button_press_event&quot;</span><span class="p">:</span>
        <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">_button</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span>
    <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;button_release_event&quot;</span><span class="p">:</span>
        <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">_button</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;motion_notify_event&quot;</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">_button</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">_key</span>
    <span class="c1"># Emit axes_enter/axes_leave.</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;motion_notify_event&quot;</span><span class="p">:</span>
        <span class="n">last</span> <span class="o">=</span> <span class="n">LocationEvent</span><span class="o">.</span><span class="n">lastevent</span>
        <span class="n">last_axes</span> <span class="o">=</span> <span class="n">last</span><span class="o">.</span><span class="n">inaxes</span> <span class="k">if</span> <span class="n">last</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">last_axes</span> <span class="o">!=</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">last_axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">last</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s2">&quot;axes_leave_event&quot;</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>  <span class="c1"># The last canvas may already have been torn down.</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s2">&quot;axes_enter_event&quot;</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="n">LocationEvent</span><span class="o">.</span><span class="n">lastevent</span> <span class="o">=</span> <span class="p">(</span>
            <span class="kc">None</span> <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;figure_leave_event&quot;</span> <span class="k">else</span> <span class="n">event</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_get_renderer</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">print_method</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the renderer that would be used to save a `.Figure`.</span>

<span class="sd">    If you need a renderer without any active draw methods use</span>
<span class="sd">    renderer._draw_disabled to temporary patch them out at your call site.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># This is implemented by triggering a draw, then immediately jumping out of</span>
    <span class="c1"># Figure.draw() by raising an exception.</span>

    <span class="k">class</span> <span class="nc">Done</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">):</span> <span class="k">raise</span> <span class="n">Done</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_setattr_cm</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="n">_draw</span><span class="p">),</span> <span class="n">ExitStack</span><span class="p">()</span> <span class="k">as</span> <span class="n">stack</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">print_method</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">get_default_filetype</span><span class="p">()</span>
            <span class="c1"># Even for a canvas&#39; default output type, a canvas switch may be</span>
            <span class="c1"># needed, e.g. for FigureCanvasBase.</span>
            <span class="n">print_method</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span>
                <span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">_switch_canvas_and_return_print_method</span><span class="p">(</span><span class="n">fmt</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">print_method</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">())</span>
        <span class="k">except</span> <span class="n">Done</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">renderer</span><span class="p">,</span> <span class="o">=</span> <span class="n">exc</span><span class="o">.</span><span class="n">args</span>
            <span class="k">return</span> <span class="n">renderer</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">print_method</span><span class="si">}</span><span class="s2"> did not call Figure.draw, so &quot;</span>
                               <span class="sa">f</span><span class="s2">&quot;no renderer is available&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_no_output_draw</span><span class="p">(</span><span class="n">figure</span><span class="p">):</span>
    <span class="c1"># _no_output_draw was promoted to the figure level, but</span>
    <span class="c1"># keep this here in case someone was calling it...</span>
    <span class="n">figure</span><span class="o">.</span><span class="n">draw_without_rendering</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_is_non_interactive_terminal_ipython</span><span class="p">(</span><span class="n">ip</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return whether we are in a terminal IPython, but non interactive.</span>

<span class="sd">    When in _terminal_ IPython, ip.parent will have and `interact` attribute,</span>
<span class="sd">    if this attribute is False we do not setup eventloop integration as the</span>
<span class="sd">    user will _not_ interact with IPython. In all other case (ZMQKernel, or is</span>
<span class="sd">    interactive), we do.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="s1">&#39;parent&#39;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="p">(</span><span class="n">ip</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
            <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ip</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="s1">&#39;interact&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">FigureCanvasBase</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The canvas the figure renders into.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    figure : `matplotlib.figure.Figure`</span>
<span class="sd">        A high-level figure instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Set to one of {&quot;qt&quot;, &quot;gtk3&quot;, &quot;gtk4&quot;, &quot;wx&quot;, &quot;tk&quot;, &quot;macosx&quot;} if an</span>
    <span class="c1"># interactive framework is required, or None otherwise.</span>
    <span class="n">required_interactive_framework</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># The manager class instantiated by new_manager.</span>
    <span class="c1"># (This is defined as a classproperty because the manager class is</span>
    <span class="c1"># currently defined *after* the canvas class, but one could also assign</span>
    <span class="c1"># ``FigureCanvasBase.manager_class = FigureManagerBase``</span>
    <span class="c1"># after defining both classes.)</span>
    <span class="n">manager_class</span> <span class="o">=</span> <span class="n">_api</span><span class="o">.</span><span class="n">classproperty</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">cls</span><span class="p">:</span> <span class="n">FigureManagerBase</span><span class="p">)</span>

    <span class="n">events</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;resize_event&#39;</span><span class="p">,</span>
        <span class="s1">&#39;draw_event&#39;</span><span class="p">,</span>
        <span class="s1">&#39;key_press_event&#39;</span><span class="p">,</span>
        <span class="s1">&#39;key_release_event&#39;</span><span class="p">,</span>
        <span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span>
        <span class="s1">&#39;button_release_event&#39;</span><span class="p">,</span>
        <span class="s1">&#39;scroll_event&#39;</span><span class="p">,</span>
        <span class="s1">&#39;motion_notify_event&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pick_event&#39;</span><span class="p">,</span>
        <span class="s1">&#39;figure_enter_event&#39;</span><span class="p">,</span>
        <span class="s1">&#39;figure_leave_event&#39;</span><span class="p">,</span>
        <span class="s1">&#39;axes_enter_event&#39;</span><span class="p">,</span>
        <span class="s1">&#39;axes_leave_event&#39;</span><span class="p">,</span>
        <span class="s1">&#39;close_event&#39;</span>
    <span class="p">]</span>

    <span class="n">fixed_dpi</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">filetypes</span> <span class="o">=</span> <span class="n">_default_filetypes</span>

    <span class="nd">@_api</span><span class="o">.</span><span class="n">classproperty</span>
    <span class="k">def</span> <span class="nf">supports_blit</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;If this Canvas sub-class supports blitting.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;copy_from_bbox&quot;</span><span class="p">)</span>
                <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;restore_region&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">matplotlib.figure</span> <span class="kn">import</span> <span class="n">Figure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fix_ipython_backend2gui</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_idle_drawing</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_saving</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">figure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">figure</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">()</span>
        <span class="n">figure</span><span class="o">.</span><span class="n">set_canvas</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span> <span class="o">=</span> <span class="n">figure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manager</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widgetlock</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">LockDraw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_button</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># the button pressed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_key</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># the key pressed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lastx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lasty</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouse_grabber</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># the Axes currently grabbing mouse</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># NavigationToolbar2 will set me</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_idle_drawing</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># We don&#39;t want to scale up the figure DPI more than once.</span>
        <span class="n">figure</span><span class="o">.</span><span class="n">_original_dpi</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">dpi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_device_pixel_ratio</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>  <span class="c1"># Typically the GUI widget init (if any).</span>

    <span class="n">callbacks</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">_canvas_callbacks</span><span class="p">)</span>
    <span class="n">button_pick_id</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">_button_pick_id</span><span class="p">)</span>
    <span class="n">scroll_pick_id</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">_scroll_pick_id</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_fix_ipython_backend2gui</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="c1"># Fix hard-coded module -&gt; toolkit mapping in IPython (used for</span>
        <span class="c1"># `ipython --auto`).  This cannot be done at import time due to</span>
        <span class="c1"># ordering issues, so we do it when creating a canvas, and should only</span>
        <span class="c1"># be done once per class (hence the `lru_cache(1)`).</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;IPython&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="kn">import</span> <span class="nn">IPython</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">IPython</span><span class="o">.</span><span class="n">get_ipython</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ip</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="kn">from</span> <span class="nn">IPython.core</span> <span class="kn">import</span> <span class="n">pylabtools</span> <span class="k">as</span> <span class="n">pt</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="s2">&quot;backend2gui&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="s2">&quot;enable_matplotlib&quot;</span><span class="p">)):</span>
            <span class="c1"># In case we ever move the patch to IPython and remove these APIs,</span>
            <span class="c1"># don&#39;t break on our side.</span>
            <span class="k">return</span>
        <span class="n">backend2gui_rif</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;qt&quot;</span><span class="p">:</span> <span class="s2">&quot;qt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;gtk3&quot;</span><span class="p">:</span> <span class="s2">&quot;gtk3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;gtk4&quot;</span><span class="p">:</span> <span class="s2">&quot;gtk4&quot;</span><span class="p">,</span>
            <span class="s2">&quot;wx&quot;</span><span class="p">:</span> <span class="s2">&quot;wx&quot;</span><span class="p">,</span>
            <span class="s2">&quot;macosx&quot;</span><span class="p">:</span> <span class="s2">&quot;osx&quot;</span><span class="p">,</span>
        <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">required_interactive_framework</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">backend2gui_rif</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_is_non_interactive_terminal_ipython</span><span class="p">(</span><span class="n">ip</span><span class="p">):</span>
                <span class="n">ip</span><span class="o">.</span><span class="n">enable_gui</span><span class="p">(</span><span class="n">backend2gui_rif</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">new_manager</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">figure</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new figure manager for *figure*, using this canvas class.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This method should not be reimplemented in subclasses.  If</span>
<span class="sd">        custom manager creation logic is needed, please reimplement</span>
<span class="sd">        ``FigureManager.create_with_canvas``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">manager_class</span><span class="o">.</span><span class="n">create_with_canvas</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">figure</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">_idle_draw_cntx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_idle_drawing</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_is_idle_drawing</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">is_saving</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return whether the renderer is in the process of saving</span>
<span class="sd">        to a file, rather than rendering for an on-screen buffer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_saving</span>

    <span class="nd">@_api</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.6&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;canvas.figure.pick&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">pick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mouseevent</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgetlock</span><span class="o">.</span><span class="n">locked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">pick</span><span class="p">(</span><span class="n">mouseevent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">blit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Blit the canvas in bbox (default entire canvas).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        UNUSED: Set the canvas size in pixels.</span>

<span class="sd">        Certain backends may implement a similar method internally, but this is</span>
<span class="sd">        not a requirement of, nor is it used by, Matplotlib itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># The entire method is actually deprecated, but we allow pass-through</span>
        <span class="c1"># to a parent class to support e.g. QWidget.resize.</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="nb">super</span><span class="p">(),</span> <span class="s2">&quot;resize&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_api</span><span class="o">.</span><span class="n">warn_deprecated</span><span class="p">(</span><span class="s2">&quot;3.6&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;resize&quot;</span><span class="p">,</span> <span class="n">obj_type</span><span class="o">=</span><span class="s2">&quot;method&quot;</span><span class="p">,</span>
                                 <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;FigureManagerBase.resize&quot;</span><span class="p">)</span>

    <span class="nd">@_api</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.6&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;callbacks.process(&#39;draw_event&#39;, DrawEvent(...))&quot;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">draw_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pass a `DrawEvent` to all functions connected to ``draw_event``.&quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;draw_event&#39;</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">DrawEvent</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>

    <span class="nd">@_api</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.6&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;callbacks.process(&#39;resize_event&#39;, ResizeEvent(...))&quot;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">resize_event</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pass a `ResizeEvent` to all functions connected to ``resize_event``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;resize_event&#39;</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">ResizeEvent</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>

    <span class="nd">@_api</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.6&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;callbacks.process(&#39;close_event&#39;, CloseEvent(...))&quot;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">close_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pass a `CloseEvent` to all functions connected to ``close_event``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;close_event&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">CloseEvent</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">guiEvent</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
            <span class="k">pass</span>
            <span class="c1"># Suppress the TypeError when the python session is being killed.</span>
            <span class="c1"># It may be that a better solution would be a mechanism to</span>
            <span class="c1"># disconnect all callbacks upon shutdown.</span>
            <span class="c1"># AttributeError occurs on OSX with qt4agg upon exiting</span>
            <span class="c1"># with an open window; &#39;callbacks&#39; attribute no longer exists.</span>

    <span class="nd">@_api</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.6&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;callbacks.process(&#39;key_press_event&#39;, KeyEvent(...))&quot;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">key_press_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pass a `KeyEvent` to all functions connected to ``key_press_event``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;key_press_event&#39;</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">KeyEvent</span><span class="p">(</span>
            <span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lastx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lasty</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">guiEvent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>

    <span class="nd">@_api</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.6&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;callbacks.process(&#39;key_release_event&#39;, KeyEvent(...))&quot;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">key_release_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pass a `KeyEvent` to all functions connected to ``key_release_event``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;key_release_event&#39;</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">KeyEvent</span><span class="p">(</span>
            <span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lastx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lasty</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">guiEvent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_key</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@_api</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.6&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;callbacks.process(&#39;pick_event&#39;, PickEvent(...))&quot;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">pick_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mouseevent</span><span class="p">,</span> <span class="n">artist</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback processing for pick events.</span>

<span class="sd">        This method will be called by artists who are picked and will</span>
<span class="sd">        fire off `PickEvent` callbacks registered listeners.</span>

<span class="sd">        Note that artists are not pickable by default (see</span>
<span class="sd">        `.Artist.set_picker`).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;pick_event&#39;</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">PickEvent</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">mouseevent</span><span class="p">,</span> <span class="n">artist</span><span class="p">,</span>
                          <span class="n">guiEvent</span><span class="o">=</span><span class="n">mouseevent</span><span class="o">.</span><span class="n">guiEvent</span><span class="p">,</span>
                          <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>

    <span class="nd">@_api</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.6&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;callbacks.process(&#39;scroll_event&#39;, MouseEvent(...))&quot;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">scroll_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback processing for scroll events.</span>

<span class="sd">        Backend derived classes should call this function on any</span>
<span class="sd">        scroll wheel event.  (*x*, *y*) are the canvas coords ((0, 0) is lower</span>
<span class="sd">        left).  button and key are as defined in `MouseEvent`.</span>

<span class="sd">        This method will call all functions connected to the &#39;scroll_event&#39;</span>
<span class="sd">        with a `MouseEvent` instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">step</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_button</span> <span class="o">=</span> <span class="s1">&#39;up&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_button</span> <span class="o">=</span> <span class="s1">&#39;down&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;scroll_event&#39;</span>
        <span class="n">mouseevent</span> <span class="o">=</span> <span class="n">MouseEvent</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_button</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key</span><span class="p">,</span>
                                <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">guiEvent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">mouseevent</span><span class="p">)</span>

    <span class="nd">@_api</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.6&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;callbacks.process(&#39;button_press_event&#39;, MouseEvent(...))&quot;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">button_press_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">button</span><span class="p">,</span> <span class="n">dblclick</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback processing for mouse button press events.</span>

<span class="sd">        Backend derived classes should call this function on any mouse</span>
<span class="sd">        button press.  (*x*, *y*) are the canvas coords ((0, 0) is lower left).</span>
<span class="sd">        button and key are as defined in `MouseEvent`.</span>

<span class="sd">        This method will call all functions connected to the</span>
<span class="sd">        &#39;button_press_event&#39; with a `MouseEvent` instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_button</span> <span class="o">=</span> <span class="n">button</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;button_press_event&#39;</span>
        <span class="n">mouseevent</span> <span class="o">=</span> <span class="n">MouseEvent</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">button</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key</span><span class="p">,</span>
                                <span class="n">dblclick</span><span class="o">=</span><span class="n">dblclick</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">guiEvent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">mouseevent</span><span class="p">)</span>

    <span class="nd">@_api</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.6&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;callbacks.process(&#39;button_release_event&#39;, MouseEvent(...))&quot;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">button_release_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">button</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback processing for mouse button release events.</span>

<span class="sd">        Backend derived classes should call this function on any mouse</span>
<span class="sd">        button release.</span>

<span class="sd">        This method will call all functions connected to the</span>
<span class="sd">        &#39;button_release_event&#39; with a `MouseEvent` instance.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : float</span>
<span class="sd">            The canvas coordinates where 0=left.</span>
<span class="sd">        y : float</span>
<span class="sd">            The canvas coordinates where 0=bottom.</span>
<span class="sd">        guiEvent</span>
<span class="sd">            The native UI event that generated the Matplotlib event.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;button_release_event&#39;</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">MouseEvent</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">button</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">guiEvent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_button</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Also remove _lastx, _lasty when this goes away.</span>
    <span class="nd">@_api</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.6&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;callbacks.process(&#39;motion_notify_event&#39;, MouseEvent(...))&quot;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">motion_notify_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback processing for mouse movement events.</span>

<span class="sd">        Backend derived classes should call this function on any</span>
<span class="sd">        motion-notify-event.</span>

<span class="sd">        This method will call all functions connected to the</span>
<span class="sd">        &#39;motion_notify_event&#39; with a `MouseEvent` instance.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : float</span>
<span class="sd">            The canvas coordinates where 0=left.</span>
<span class="sd">        y : float</span>
<span class="sd">            The canvas coordinates where 0=bottom.</span>
<span class="sd">        guiEvent</span>
<span class="sd">            The native UI event that generated the Matplotlib event.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lastx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lasty</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;motion_notify_event&#39;</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">MouseEvent</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_button</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key</span><span class="p">,</span>
                           <span class="n">guiEvent</span><span class="o">=</span><span class="n">guiEvent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>

    <span class="nd">@_api</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.6&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;callbacks.process(&#39;leave_notify_event&#39;, LocationEvent(...))&quot;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">leave_notify_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback processing for the mouse cursor leaving the canvas.</span>

<span class="sd">        Backend derived classes should call this function when leaving</span>
<span class="sd">        canvas.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        guiEvent</span>
<span class="sd">            The native UI event that generated the Matplotlib event.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s1">&#39;figure_leave_event&#39;</span><span class="p">,</span> <span class="n">LocationEvent</span><span class="o">.</span><span class="n">lastevent</span><span class="p">)</span>
        <span class="n">LocationEvent</span><span class="o">.</span><span class="n">lastevent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lastx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lasty</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="nd">@_api</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.6&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;callbacks.process(&#39;enter_notify_event&#39;, LocationEvent(...))&quot;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">enter_notify_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">xy</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback processing for the mouse cursor entering the canvas.</span>

<span class="sd">        Backend derived classes should call this function when entering</span>
<span class="sd">        canvas.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        guiEvent</span>
<span class="sd">            The native UI event that generated the Matplotlib event.</span>
<span class="sd">        xy : (float, float)</span>
<span class="sd">            The coordinate location of the pointer when the canvas is entered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lastx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lasty</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">xy</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">LocationEvent</span><span class="p">(</span><span class="s1">&#39;figure_enter_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">guiEvent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s1">&#39;figure_enter_event&#39;</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">inaxes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the topmost visible `~.axes.Axes` containing the point *xy*.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xy : (float, float)</span>
<span class="sd">            (x, y) pixel positions from left/bottom of the canvas.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        `~matplotlib.axes.Axes` or None</span>
<span class="sd">            The topmost visible Axes containing the point, or None if there</span>
<span class="sd">            is no Axes at the point.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">axes_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()</span>
                     <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">contains_point</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()]</span>
        <span class="k">if</span> <span class="n">axes_list</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_topmost_artist</span><span class="p">(</span><span class="n">axes_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">axes</span>

    <span class="k">def</span> <span class="nf">grab_mouse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the child `~.axes.Axes` which is grabbing the mouse events.</span>

<span class="sd">        Usually called by the widgets themselves. It is an error to call this</span>
<span class="sd">        if the mouse is already grabbed by another Axes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_grabber</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Another Axes already grabs mouse input&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouse_grabber</span> <span class="o">=</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">release_mouse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Release the mouse grab held by the `~.axes.Axes` *ax*.</span>

<span class="sd">        Usually called by the widgets. It is ok to call this even if *ax*</span>
<span class="sd">        doesn&#39;t have the mouse grab currently.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_grabber</span> <span class="ow">is</span> <span class="n">ax</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouse_grabber</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">set_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursor</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the current cursor.</span>

<span class="sd">        This may have no effect if the backend does not display anything.</span>

<span class="sd">        If required by the backend, this method should trigger an update in</span>
<span class="sd">        the backend event loop after the cursor is set, as this method may be</span>
<span class="sd">        called e.g. before a long-running task during which the GUI is not</span>
<span class="sd">        updated.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cursor : `.Cursors`</span>
<span class="sd">            The cursor to display over the canvas. Note: some backends may</span>
<span class="sd">            change the cursor for the entire window.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Render the `.Figure`.</span>

<span class="sd">        This method must walk the artist tree, even if no output is produced,</span>
<span class="sd">        because it triggers deferred work that users may want to access</span>
<span class="sd">        before saving output to disk. For example computing limits,</span>
<span class="sd">        auto-limits, and tick values.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">draw_idle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Request a widget redraw once control returns to the GUI event loop.</span>

<span class="sd">        Even if multiple calls to `draw_idle` occur before control returns</span>
<span class="sd">        to the GUI event loop, the figure will only be rendered once.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Backends may choose to override the method and implement their own</span>
<span class="sd">        strategy to prevent multiple renderings.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_idle_drawing</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idle_draw_cntx</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">device_pixel_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The ratio of physical to logical pixels used for the canvas on screen.</span>

<span class="sd">        By default, this is 1, meaning physical and logical pixels are the same</span>
<span class="sd">        size. Subclasses that support High DPI screens may set this property to</span>
<span class="sd">        indicate that said ratio is different. All Matplotlib interaction,</span>
<span class="sd">        unless working directly with the canvas, remains in logical pixels.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_device_pixel_ratio</span>

    <span class="k">def</span> <span class="nf">_set_device_pixel_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ratio</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the ratio of physical to logical pixels used for the canvas.</span>

<span class="sd">        Subclasses that support High DPI screens can set this property to</span>
<span class="sd">        indicate that said ratio is different. The canvas itself will be</span>
<span class="sd">        created at the physical size, while the client side will use the</span>
<span class="sd">        logical size. Thus the DPI of the Figure will change to be scaled by</span>
<span class="sd">        this ratio. Implementations that support High DPI screens should use</span>
<span class="sd">        physical pixels for events so that transforms back to Axes space are</span>
<span class="sd">        correct.</span>

<span class="sd">        By default, this is 1, meaning physical and logical pixels are the same</span>
<span class="sd">        size.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ratio : float</span>
<span class="sd">            The ratio of logical to physical pixels used for the canvas.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            Whether the ratio has changed. Backends may interpret this as a</span>
<span class="sd">            signal to resize the window, repaint the canvas, or change any</span>
<span class="sd">            other relevant properties.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_device_pixel_ratio</span> <span class="o">==</span> <span class="n">ratio</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># In cases with mixed resolution displays, we need to be careful if the</span>
        <span class="c1"># device pixel ratio changes - in this case we need to resize the</span>
        <span class="c1"># canvas accordingly. Some backends provide events that indicate a</span>
        <span class="c1"># change in DPI, but those that don&#39;t will update this before drawing.</span>
        <span class="n">dpi</span> <span class="o">=</span> <span class="n">ratio</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">_original_dpi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">_set_dpi</span><span class="p">(</span><span class="n">dpi</span><span class="p">,</span> <span class="n">forward</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_device_pixel_ratio</span> <span class="o">=</span> <span class="n">ratio</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_width_height</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">physical</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the figure width and height in integral points or pixels.</span>

<span class="sd">        When the figure is used on High DPI screens (and the backend supports</span>
<span class="sd">        it), the truncation to integers occurs after scaling by the device</span>
<span class="sd">        pixel ratio.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        physical : bool, default: False</span>
<span class="sd">            Whether to return true physical pixels or logical pixels. Physical</span>
<span class="sd">            pixels may be used by backends that support HiDPI, but still</span>
<span class="sd">            configure the canvas using its actual size.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        width, height : int</span>
<span class="sd">            The size of the figure, in points or pixels, depending on the</span>
<span class="sd">            backend.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">size</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">physical</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_pixel_ratio</span><span class="p">))</span>
                     <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_supported_filetypes</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return dict of savefig file formats supported by this backend.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">filetypes</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_supported_filetypes_grouped</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a dict of savefig file formats supported by this backend,</span>
<span class="sd">        where the keys are a file type name, such as &#39;Joint Photographic</span>
<span class="sd">        Experts Group&#39;, and the values are a list of filename extensions used</span>
<span class="sd">        for that filetype, such as [&#39;jpg&#39;, &#39;jpeg&#39;].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">groupings</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ext</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">filetypes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">groupings</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span>
            <span class="n">groupings</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">groupings</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">_switch_canvas_and_return_print_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Context manager temporarily setting the canvas for saving the figure::</span>

<span class="sd">            with canvas._switch_canvas_and_return_print_method(fmt, backend) \\</span>
<span class="sd">                    as print_method:</span>
<span class="sd">                # ``print_method`` is a suitable ``print_{fmt}`` method, and</span>
<span class="sd">                # the figure&#39;s canvas is temporarily switched to the method&#39;s</span>
<span class="sd">                # canvas within the with... block.  ``print_method`` is also</span>
<span class="sd">                # wrapped to suppress extra kwargs passed by ``print_figure``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fmt : str</span>
<span class="sd">            If *backend* is None, then determine a suitable canvas class for</span>
<span class="sd">            saving to format *fmt* -- either the current canvas class, if it</span>
<span class="sd">            supports *fmt*, or whatever `get_registered_canvas_class` returns;</span>
<span class="sd">            switch the figure canvas to that canvas class.</span>
<span class="sd">        backend : str or None, default: None</span>
<span class="sd">            If not None, switch the figure canvas to the ``FigureCanvas`` class</span>
<span class="sd">            of the given backend.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">canvas</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">backend</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Return a specific canvas class, if requested.</span>
            <span class="n">canvas_class</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">cbook</span><span class="o">.</span><span class="n">_backend_module_name</span><span class="p">(</span><span class="n">backend</span><span class="p">))</span>
                <span class="o">.</span><span class="n">FigureCanvas</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">canvas_class</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;print_</span><span class="si">{</span><span class="n">fmt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">backend</span><span class="si">!r}</span><span class="s2"> backend does not support </span><span class="si">{</span><span class="n">fmt</span><span class="si">}</span><span class="s2"> output&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;print_</span><span class="si">{</span><span class="n">fmt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="c1"># Return the current canvas if it supports the requested format.</span>
            <span class="n">canvas</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="n">canvas_class</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Skip call to switch_backends.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Return a default canvas for the requested format, if it exists.</span>
            <span class="n">canvas_class</span> <span class="o">=</span> <span class="n">get_registered_canvas_class</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">canvas_class</span><span class="p">:</span>
            <span class="n">canvas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_backends</span><span class="p">(</span><span class="n">canvas_class</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">canvas</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Format </span><span class="si">{!r}</span><span class="s2"> is not supported (supported formats: </span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">fmt</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_supported_filetypes</span><span class="p">()))))</span>
        <span class="n">meth</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;print_</span><span class="si">{</span><span class="n">fmt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="p">(</span><span class="n">meth</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="vm">__module__</span>
               <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">meth</span><span class="p">,</span> <span class="s2">&quot;func&quot;</span><span class="p">)</span>  <span class="c1"># partialmethod, e.g. backend_wx.</span>
               <span class="k">else</span> <span class="n">meth</span><span class="o">.</span><span class="vm">__module__</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mod</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s2">&quot;matplotlib.&quot;</span><span class="p">,</span> <span class="s2">&quot;mpl_toolkits.&quot;</span><span class="p">)):</span>
            <span class="n">optional_kws</span> <span class="o">=</span> <span class="p">{</span>  <span class="c1"># Passed by print_figure for other renderers.</span>
                <span class="s2">&quot;dpi&quot;</span><span class="p">,</span> <span class="s2">&quot;facecolor&quot;</span><span class="p">,</span> <span class="s2">&quot;edgecolor&quot;</span><span class="p">,</span> <span class="s2">&quot;orientation&quot;</span><span class="p">,</span>
                <span class="s2">&quot;bbox_inches_restore&quot;</span><span class="p">}</span>
            <span class="n">skip</span> <span class="o">=</span> <span class="n">optional_kws</span> <span class="o">-</span> <span class="p">{</span><span class="o">*</span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">meth</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="p">}</span>
            <span class="n">print_method</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">meth</span><span class="p">)(</span><span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">meth</span><span class="p">(</span>
                <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">skip</span><span class="p">}))</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Let third-parties do as they see fit.</span>
            <span class="n">print_method</span> <span class="o">=</span> <span class="n">meth</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">print_method</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">print_figure</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
            <span class="n">bbox_inches</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pad_inches</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bbox_extra_artists</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">backend</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Render the figure to hardcopy. Set the figure patch face and edge</span>
<span class="sd">        colors.  This is useful because some of the GUIs have a gray figure</span>
<span class="sd">        face color background and you&#39;ll probably want to override this on</span>
<span class="sd">        hardcopy.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str or path-like or file-like</span>
<span class="sd">            The file where the figure is saved.</span>

<span class="sd">        dpi : float, default: :rc:`savefig.dpi`</span>
<span class="sd">            The dots per inch to save the figure in.</span>

<span class="sd">        facecolor : color or &#39;auto&#39;, default: :rc:`savefig.facecolor`</span>
<span class="sd">            The facecolor of the figure.  If &#39;auto&#39;, use the current figure</span>
<span class="sd">            facecolor.</span>

<span class="sd">        edgecolor : color or &#39;auto&#39;, default: :rc:`savefig.edgecolor`</span>
<span class="sd">            The edgecolor of the figure.  If &#39;auto&#39;, use the current figure</span>
<span class="sd">            edgecolor.</span>

<span class="sd">        orientation : {&#39;landscape&#39;, &#39;portrait&#39;}, default: &#39;portrait&#39;</span>
<span class="sd">            Only currently applies to PostScript printing.</span>

<span class="sd">        format : str, optional</span>
<span class="sd">            Force a specific file format. If not given, the format is inferred</span>
<span class="sd">            from the *filename* extension, and if that fails from</span>
<span class="sd">            :rc:`savefig.format`.</span>

<span class="sd">        bbox_inches : &#39;tight&#39; or `.Bbox`, default: :rc:`savefig.bbox`</span>
<span class="sd">            Bounding box in inches: only the given portion of the figure is</span>
<span class="sd">            saved.  If &#39;tight&#39;, try to figure out the tight bbox of the figure.</span>

<span class="sd">        pad_inches : float, default: :rc:`savefig.pad_inches`</span>
<span class="sd">            Amount of padding around the figure when *bbox_inches* is &#39;tight&#39;.</span>

<span class="sd">        bbox_extra_artists : list of `~matplotlib.artist.Artist`, optional</span>
<span class="sd">            A list of extra artists that will be considered when the</span>
<span class="sd">            tight bbox is calculated.</span>

<span class="sd">        backend : str, optional</span>
<span class="sd">            Use a non-default backend to render the file, e.g. to render a</span>
<span class="sd">            png file with the &quot;cairo&quot; backend rather than the default &quot;agg&quot;,</span>
<span class="sd">            or a pdf file with the &quot;pgf&quot; backend rather than the default</span>
<span class="sd">            &quot;pdf&quot;.  Note that the default backend is normally sufficient.  See</span>
<span class="sd">            :ref:`the-builtin-backends` for a list of valid backends for each</span>
<span class="sd">            file format.  Custom backends can be referenced as &quot;module://...&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># get format from filename, or from backend&#39;s default filetype</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">):</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="nb">format</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="nb">format</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="nb">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_filetype</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nb">format</span>
        <span class="nb">format</span> <span class="o">=</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">dpi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dpi</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;savefig.dpi&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">dpi</span> <span class="o">==</span> <span class="s1">&#39;figure&#39;</span><span class="p">:</span>
            <span class="n">dpi</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="s1">&#39;_original_dpi&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>

        <span class="c1"># Remove the figure manager, if any, to avoid resizing the GUI widget.</span>
        <span class="k">with</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_setattr_cm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">manager</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> \
             <span class="bp">self</span><span class="o">.</span><span class="n">_switch_canvas_and_return_print_method</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span> <span class="n">backend</span><span class="p">)</span> \
                 <span class="k">as</span> <span class="n">print_method</span><span class="p">,</span> \
             <span class="n">cbook</span><span class="o">.</span><span class="n">_setattr_cm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">),</span> \
             <span class="n">cbook</span><span class="o">.</span><span class="n">_setattr_cm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="n">_device_pixel_ratio</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> \
             <span class="n">cbook</span><span class="o">.</span><span class="n">_setattr_cm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="n">_is_saving</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> \
             <span class="n">ExitStack</span><span class="p">()</span> <span class="k">as</span> <span class="n">stack</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;facecolor&quot;</span><span class="p">,</span> <span class="s2">&quot;edgecolor&quot;</span><span class="p">]:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()[</span><span class="n">prop</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;savefig.</span><span class="si">{</span><span class="n">prop</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_str_equal</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="s2">&quot;auto&quot;</span><span class="p">):</span>
                    <span class="n">stack</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">_cm_set</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">prop</span><span class="p">:</span> <span class="n">color</span><span class="p">}))</span>

            <span class="k">if</span> <span class="n">bbox_inches</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">bbox_inches</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;savefig.bbox&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">get_layout_engine</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span>
                    <span class="n">bbox_inches</span> <span class="o">==</span> <span class="s2">&quot;tight&quot;</span><span class="p">):</span>
                <span class="c1"># we need to trigger a draw before printing to make sure</span>
                <span class="c1"># CL works.  &quot;tight&quot; also needs a draw to get the right</span>
                <span class="c1"># locations:</span>
                <span class="n">renderer</span> <span class="o">=</span> <span class="n">_get_renderer</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span>
                    <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
                        <span class="n">print_method</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">with</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span> <span class="s2">&quot;_draw_disabled&quot;</span><span class="p">,</span> <span class="n">nullcontext</span><span class="p">)():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">bbox_inches</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">bbox_inches</span> <span class="o">==</span> <span class="s2">&quot;tight&quot;</span><span class="p">:</span>
                    <span class="n">bbox_inches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">get_tightbbox</span><span class="p">(</span>
                        <span class="n">renderer</span><span class="p">,</span> <span class="n">bbox_extra_artists</span><span class="o">=</span><span class="n">bbox_extra_artists</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">pad_inches</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">pad_inches</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;savefig.pad_inches&#39;</span><span class="p">]</span>
                    <span class="n">bbox_inches</span> <span class="o">=</span> <span class="n">bbox_inches</span><span class="o">.</span><span class="n">padded</span><span class="p">(</span><span class="n">pad_inches</span><span class="p">)</span>

                <span class="c1"># call adjust_bbox to save only the given area</span>
                <span class="n">restore_bbox</span> <span class="o">=</span> <span class="n">_tight_bbox</span><span class="o">.</span><span class="n">adjust_bbox</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">fixed_dpi</span><span class="p">)</span>

                <span class="n">_bbox_inches_restore</span> <span class="o">=</span> <span class="p">(</span><span class="n">bbox_inches</span><span class="p">,</span> <span class="n">restore_bbox</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_bbox_inches_restore</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># we have already done layout above, so turn it off:</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">_cm_set</span><span class="p">(</span><span class="n">layout_engine</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># _get_renderer may change the figure dpi (as vector formats</span>
                <span class="c1"># force the figure dpi to 72), so we need to set it again here.</span>
                <span class="k">with</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_setattr_cm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">):</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">print_method</span><span class="p">(</span>
                        <span class="n">filename</span><span class="p">,</span>
                        <span class="n">facecolor</span><span class="o">=</span><span class="n">facecolor</span><span class="p">,</span>
                        <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
                        <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span>
                        <span class="n">bbox_inches_restore</span><span class="o">=</span><span class="n">_bbox_inches_restore</span><span class="p">,</span>
                        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">bbox_inches</span> <span class="ow">and</span> <span class="n">restore_bbox</span><span class="p">:</span>
                    <span class="n">restore_bbox</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_default_filetype</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the default savefig file format as specified in</span>
<span class="sd">        :rc:`savefig.format`.</span>

<span class="sd">        The returned string does not include a period. This method is</span>
<span class="sd">        overridden in backends that only support a single file type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;savefig.format&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_default_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a string, which includes extension, suitable for use as</span>
<span class="sd">        a default filename.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">basename</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">get_window_title</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">manager</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">basename</span> <span class="o">=</span> <span class="p">(</span><span class="n">basename</span> <span class="ow">or</span> <span class="s1">&#39;image&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">filetype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_filetype</span><span class="p">()</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">basename</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">filetype</span>
        <span class="k">return</span> <span class="n">filename</span>

    <span class="k">def</span> <span class="nf">switch_backends</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">FigureCanvasClass</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instantiate an instance of FigureCanvasClass</span>

<span class="sd">        This is used for backend switching, e.g., to instantiate a</span>
<span class="sd">        FigureCanvasPS from a FigureCanvasGTK.  Note, deep copying is</span>
<span class="sd">        not done, so any changes to one of the instances (e.g., setting</span>
<span class="sd">        figure size or line props), will be reflected in the other</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">newCanvas</span> <span class="o">=</span> <span class="n">FigureCanvasClass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">)</span>
        <span class="n">newCanvas</span><span class="o">.</span><span class="n">_is_saving</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_saving</span>
        <span class="k">return</span> <span class="n">newCanvas</span>

    <span class="k">def</span> <span class="nf">mpl_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Bind function *func* to event *s*.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        s : str</span>
<span class="sd">            One of the following events ids:</span>

<span class="sd">            - &#39;button_press_event&#39;</span>
<span class="sd">            - &#39;button_release_event&#39;</span>
<span class="sd">            - &#39;draw_event&#39;</span>
<span class="sd">            - &#39;key_press_event&#39;</span>
<span class="sd">            - &#39;key_release_event&#39;</span>
<span class="sd">            - &#39;motion_notify_event&#39;</span>
<span class="sd">            - &#39;pick_event&#39;</span>
<span class="sd">            - &#39;resize_event&#39;</span>
<span class="sd">            - &#39;scroll_event&#39;</span>
<span class="sd">            - &#39;figure_enter_event&#39;,</span>
<span class="sd">            - &#39;figure_leave_event&#39;,</span>
<span class="sd">            - &#39;axes_enter_event&#39;,</span>
<span class="sd">            - &#39;axes_leave_event&#39;</span>
<span class="sd">            - &#39;close_event&#39;.</span>

<span class="sd">        func : callable</span>
<span class="sd">            The callback function to be executed, which must have the</span>
<span class="sd">            signature::</span>

<span class="sd">                def func(event: Event) -&gt; Any</span>

<span class="sd">            For the location events (button and key press/release), if the</span>
<span class="sd">            mouse is over the Axes, the ``inaxes`` attribute of the event will</span>
<span class="sd">            be set to the `~matplotlib.axes.Axes` the event occurs is over, and</span>
<span class="sd">            additionally, the variables ``xdata`` and ``ydata`` attributes will</span>
<span class="sd">            be set to the mouse location in data coordinates.  See `.KeyEvent`</span>
<span class="sd">            and `.MouseEvent` for more info.</span>

<span class="sd">            .. note::</span>

<span class="sd">                If func is a method, this only stores a weak reference to the</span>
<span class="sd">                method. Thus, the figure does not influence the lifetime of</span>
<span class="sd">                the associated object. Usually, you want to make sure that the</span>
<span class="sd">                object is kept alive throughout the lifetime of the figure by</span>
<span class="sd">                holding a reference to it.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cid</span>
<span class="sd">            A connection id that can be used with</span>
<span class="sd">            `.FigureCanvasBase.mpl_disconnect`.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        ::</span>

<span class="sd">            def on_press(event):</span>
<span class="sd">                print(&#39;you pressed&#39;, event.button, event.xdata, event.ydata)</span>

<span class="sd">            cid = canvas.mpl_connect(&#39;button_press_event&#39;, on_press)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mpl_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disconnect the callback with id *cid*.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        ::</span>

<span class="sd">            cid = canvas.mpl_connect(&#39;button_press_event&#39;, on_press)</span>
<span class="sd">            # ... later</span>
<span class="sd">            canvas.mpl_disconnect(cid)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">cid</span><span class="p">)</span>

    <span class="c1"># Internal subclasses can override _timer_cls instead of new_timer, though</span>
    <span class="c1"># this is not a public API for third-party subclasses.</span>
    <span class="n">_timer_cls</span> <span class="o">=</span> <span class="n">TimerBase</span>

    <span class="k">def</span> <span class="nf">new_timer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new backend-specific subclass of `.Timer`.</span>

<span class="sd">        This is useful for getting periodic events through the backend&#39;s native</span>
<span class="sd">        event loop.  Implemented only for backends with GUIs.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        interval : int</span>
<span class="sd">            Timer interval in milliseconds.</span>

<span class="sd">        callbacks : list[tuple[callable, tuple, dict]]</span>
<span class="sd">            Sequence of (func, args, kwargs) where ``func(*args, **kwargs)``</span>
<span class="sd">            will be executed by the timer every *interval*.</span>

<span class="sd">            Callbacks which return ``False`` or ``0`` will be removed from the</span>
<span class="sd">            timer.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; timer = fig.canvas.new_timer(callbacks=[(f1, (1,), {&#39;a&#39;: 3})])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timer_cls</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="n">interval</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">flush_events</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Flush the GUI events for the figure.</span>

<span class="sd">        Interactive backends need to reimplement this method.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">start_event_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start a blocking event loop.</span>

<span class="sd">        Such an event loop is used by interactive functions, such as</span>
<span class="sd">        `~.Figure.ginput` and `~.Figure.waitforbuttonpress`, to wait for</span>
<span class="sd">        events.</span>

<span class="sd">        The event loop blocks until a callback function triggers</span>
<span class="sd">        `stop_event_loop`, or *timeout* is reached.</span>

<span class="sd">        If *timeout* is 0 or negative, never timeout.</span>

<span class="sd">        Only interactive backends need to reimplement this method and it relies</span>
<span class="sd">        on `flush_events` being properly implemented.</span>

<span class="sd">        Interactive backends should implement this in a more native way.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">timeout</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">timeout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">timestep</span> <span class="o">=</span> <span class="mf">0.01</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_looping</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_looping</span> <span class="ow">and</span> <span class="n">counter</span> <span class="o">*</span> <span class="n">timestep</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flush_events</span><span class="p">()</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">timestep</span><span class="p">)</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">stop_event_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop the current blocking event loop.</span>

<span class="sd">        Interactive backends need to reimplement this to match</span>
<span class="sd">        `start_event_loop`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_looping</span> <span class="o">=</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">key_press_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">canvas</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">toolbar</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implement the default Matplotlib key bindings for the canvas and toolbar</span>
<span class="sd">    described at :ref:`key-event-handling`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    event : `KeyEvent`</span>
<span class="sd">        A key press/release event.</span>
<span class="sd">    canvas : `FigureCanvasBase`, default: ``event.canvas``</span>
<span class="sd">        The backend-specific canvas instance.  This parameter is kept for</span>
<span class="sd">        back-compatibility, but, if set, should always be equal to</span>
<span class="sd">        ``event.canvas``.</span>
<span class="sd">    toolbar : `NavigationToolbar2`, default: ``event.canvas.toolbar``</span>
<span class="sd">        The navigation cursor toolbar.  This parameter is kept for</span>
<span class="sd">        back-compatibility, but, if set, should always be equal to</span>
<span class="sd">        ``event.canvas.toolbar``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># these bindings happen whether you are over an Axes or not</span>

    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">canvas</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">canvas</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">canvas</span>
    <span class="k">if</span> <span class="n">toolbar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">toolbar</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">toolbar</span>

    <span class="c1"># Load key-mappings from rcParams.</span>
    <span class="n">fullscreen_keys</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.fullscreen&#39;</span><span class="p">]</span>
    <span class="n">home_keys</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.home&#39;</span><span class="p">]</span>
    <span class="n">back_keys</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.back&#39;</span><span class="p">]</span>
    <span class="n">forward_keys</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.forward&#39;</span><span class="p">]</span>
    <span class="n">pan_keys</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.pan&#39;</span><span class="p">]</span>
    <span class="n">zoom_keys</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.zoom&#39;</span><span class="p">]</span>
    <span class="n">save_keys</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.save&#39;</span><span class="p">]</span>
    <span class="n">quit_keys</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.quit&#39;</span><span class="p">]</span>
    <span class="n">quit_all_keys</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.quit_all&#39;</span><span class="p">]</span>
    <span class="n">grid_keys</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.grid&#39;</span><span class="p">]</span>
    <span class="n">grid_minor_keys</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.grid_minor&#39;</span><span class="p">]</span>
    <span class="n">toggle_yscale_keys</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.yscale&#39;</span><span class="p">]</span>
    <span class="n">toggle_xscale_keys</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.xscale&#39;</span><span class="p">]</span>

    <span class="c1"># toggle fullscreen mode (&#39;f&#39;, &#39;ctrl + f&#39;)</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">fullscreen_keys</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">full_screen_toggle</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="c1"># quit the figure (default key &#39;ctrl+w&#39;)</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">quit_keys</span><span class="p">:</span>
        <span class="n">Gcf</span><span class="o">.</span><span class="n">destroy_fig</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">quit_all_keys</span><span class="p">:</span>
        <span class="n">Gcf</span><span class="o">.</span><span class="n">destroy_all</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">toolbar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># home or reset mnemonic  (default key &#39;h&#39;, &#39;home&#39; and &#39;r&#39;)</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">home_keys</span><span class="p">:</span>
            <span class="n">toolbar</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
        <span class="c1"># forward / backward keys to enable left handed quick navigation</span>
        <span class="c1"># (default key for backward: &#39;left&#39;, &#39;backspace&#39; and &#39;c&#39;)</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">back_keys</span><span class="p">:</span>
            <span class="n">toolbar</span><span class="o">.</span><span class="n">back</span><span class="p">()</span>
        <span class="c1"># (default key for forward: &#39;right&#39; and &#39;v&#39;)</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">forward_keys</span><span class="p">:</span>
            <span class="n">toolbar</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>
        <span class="c1"># pan mnemonic (default key &#39;p&#39;)</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">pan_keys</span><span class="p">:</span>
            <span class="n">toolbar</span><span class="o">.</span><span class="n">pan</span><span class="p">()</span>
            <span class="n">toolbar</span><span class="o">.</span><span class="n">_update_cursor</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="c1"># zoom mnemonic (default key &#39;o&#39;)</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">zoom_keys</span><span class="p">:</span>
            <span class="n">toolbar</span><span class="o">.</span><span class="n">zoom</span><span class="p">()</span>
            <span class="n">toolbar</span><span class="o">.</span><span class="n">_update_cursor</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="c1"># saving current figure (default key &#39;s&#39;)</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">save_keys</span><span class="p">:</span>
            <span class="n">toolbar</span><span class="o">.</span><span class="n">save_figure</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># these bindings require the mouse to be over an Axes to trigger</span>
    <span class="k">def</span> <span class="nf">_get_uniform_gridstate</span><span class="p">(</span><span class="n">ticks</span><span class="p">):</span>
        <span class="c1"># Return True/False if all grid lines are on or off, None if they are</span>
        <span class="c1"># not all in the same state.</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">tick</span><span class="o">.</span><span class="n">gridline</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">ticks</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">tick</span><span class="o">.</span><span class="n">gridline</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">ticks</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span>
    <span class="c1"># toggle major grids in current Axes (default key &#39;g&#39;)</span>
    <span class="c1"># Both here and below (for &#39;G&#39;), we do nothing if *any* grid (major or</span>
    <span class="c1"># minor, x or y) is not in a uniform state, to avoid messing up user</span>
    <span class="c1"># customization.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">grid_keys</span>
            <span class="c1"># Exclude minor grids not in a uniform state.</span>
            <span class="ow">and</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">_get_uniform_gridstate</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">minorTicks</span><span class="p">),</span>
                             <span class="n">_get_uniform_gridstate</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">minorTicks</span><span class="p">)]):</span>
        <span class="n">x_state</span> <span class="o">=</span> <span class="n">_get_uniform_gridstate</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">majorTicks</span><span class="p">)</span>
        <span class="n">y_state</span> <span class="o">=</span> <span class="n">_get_uniform_gridstate</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">majorTicks</span><span class="p">)</span>
        <span class="n">cycle</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x_state</span><span class="p">,</span> <span class="n">y_state</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">cycle</span><span class="p">[(</span><span class="n">cycle</span><span class="o">.</span><span class="n">index</span><span class="p">((</span><span class="n">x_state</span><span class="p">,</span> <span class="n">y_state</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">cycle</span><span class="p">)])</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># Exclude major grids not in a uniform state.</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If turning major grids off, also turn minor grids off.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">x_state</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span> <span class="k">if</span> <span class="n">x_state</span> <span class="k">else</span> <span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">y_state</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span> <span class="k">if</span> <span class="n">y_state</span> <span class="k">else</span> <span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
    <span class="c1"># toggle major and minor grids in current Axes (default key &#39;G&#39;)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">grid_minor_keys</span>
            <span class="c1"># Exclude major grids not in a uniform state.</span>
            <span class="ow">and</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">_get_uniform_gridstate</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">majorTicks</span><span class="p">),</span>
                             <span class="n">_get_uniform_gridstate</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">majorTicks</span><span class="p">)]):</span>
        <span class="n">x_state</span> <span class="o">=</span> <span class="n">_get_uniform_gridstate</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">minorTicks</span><span class="p">)</span>
        <span class="n">y_state</span> <span class="o">=</span> <span class="n">_get_uniform_gridstate</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">minorTicks</span><span class="p">)</span>
        <span class="n">cycle</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x_state</span><span class="p">,</span> <span class="n">y_state</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">cycle</span><span class="p">[(</span><span class="n">cycle</span><span class="o">.</span><span class="n">index</span><span class="p">((</span><span class="n">x_state</span><span class="p">,</span> <span class="n">y_state</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">cycle</span><span class="p">)])</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># Exclude minor grids not in a uniform state.</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">x_state</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">y_state</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
    <span class="c1"># toggle scaling of y-axes between &#39;log and &#39;linear&#39; (default key &#39;l&#39;)</span>
    <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">toggle_yscale_keys</span><span class="p">:</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yscale</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">scale</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
    <span class="c1"># toggle scaling of x-axes between &#39;log and &#39;linear&#39; (default key &#39;k&#39;)</span>
    <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">toggle_xscale_keys</span><span class="p">:</span>
        <span class="n">scalex</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xscale</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">scalex</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">scalex</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">button_press_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">canvas</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">toolbar</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The default Matplotlib button actions for extra mouse buttons.</span>

<span class="sd">    Parameters are as for `key_press_handler`, except that *event* is a</span>
<span class="sd">    `MouseEvent`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">canvas</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">canvas</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">canvas</span>
    <span class="k">if</span> <span class="n">toolbar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">toolbar</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">toolbar</span>
    <span class="k">if</span> <span class="n">toolbar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">button_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">MouseButton</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">button_name</span> <span class="ow">in</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.back&#39;</span><span class="p">]:</span>
            <span class="n">toolbar</span><span class="o">.</span><span class="n">back</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">button_name</span> <span class="ow">in</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.forward&#39;</span><span class="p">]:</span>
            <span class="n">toolbar</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">NonGuiException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when trying show a figure in a non-GUI backend.&quot;&quot;&quot;</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">FigureManagerBase</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A backend-independent abstraction of a figure container and controller.</span>

<span class="sd">    The figure manager is used by pyplot to interact with the window in a</span>
<span class="sd">    backend-independent way. It&#39;s an adapter for the real (GUI) framework that</span>
<span class="sd">    represents the visual figure on screen.</span>

<span class="sd">    GUI backends define from this class to translate common operations such</span>
<span class="sd">    as *show* or *resize* to the GUI-specific code. Non-GUI backends do not</span>
<span class="sd">    support these operations an can just use the base class.</span>

<span class="sd">    This following basic operations are accessible:</span>

<span class="sd">    **Window operations**</span>

<span class="sd">    - `~.FigureManagerBase.show`</span>
<span class="sd">    - `~.FigureManagerBase.destroy`</span>
<span class="sd">    - `~.FigureManagerBase.full_screen_toggle`</span>
<span class="sd">    - `~.FigureManagerBase.resize`</span>
<span class="sd">    - `~.FigureManagerBase.get_window_title`</span>
<span class="sd">    - `~.FigureManagerBase.set_window_title`</span>

<span class="sd">    **Key and mouse button press handling**</span>

<span class="sd">    The figure manager sets up default key and mouse button press handling by</span>
<span class="sd">    hooking up the `.key_press_handler` to the matplotlib event system. This</span>
<span class="sd">    ensures the same shortcuts and mouse actions across backends.</span>

<span class="sd">    **Other operations**</span>

<span class="sd">    Subclasses will have additional attributes and functions to access</span>
<span class="sd">    additional functionality. This is of course backend-specific. For example,</span>
<span class="sd">    most GUI backends have ``window`` and ``toolbar`` attributes that give</span>
<span class="sd">    access to the native GUI widgets of the respective framework.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    canvas : `FigureCanvasBase`</span>
<span class="sd">        The backend-specific canvas instance.</span>

<span class="sd">    num : int or str</span>
<span class="sd">        The figure number.</span>

<span class="sd">    key_press_handler_id : int</span>
<span class="sd">        The default key handler cid, when using the toolmanager.</span>
<span class="sd">        To disable the default key press handling use::</span>

<span class="sd">            figure.canvas.mpl_disconnect(</span>
<span class="sd">                figure.canvas.manager.key_press_handler_id)</span>

<span class="sd">    button_press_handler_id : int</span>
<span class="sd">        The default mouse button handler cid, when using the toolmanager.</span>
<span class="sd">        To disable the default button press handling use::</span>

<span class="sd">            figure.canvas.mpl_disconnect(</span>
<span class="sd">                figure.canvas.manager.button_press_handler_id)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_toolbar2_class</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_toolmanager_toolbar_class</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">canvas</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">manager</span> <span class="o">=</span> <span class="bp">self</span>  <span class="c1"># store a pointer to parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">=</span> <span class="n">num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_window_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Figure </span><span class="si">{</span><span class="n">num</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">key_press_handler_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_press_handler_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;toolbar&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;toolmanager&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">key_press_handler_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span>
                <span class="s1">&#39;key_press_event&#39;</span><span class="p">,</span> <span class="n">key_press_handler</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">button_press_handler_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span>
                <span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="n">button_press_handler</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">toolmanager</span> <span class="o">=</span> <span class="p">(</span><span class="n">ToolManager</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;toolbar&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;toolmanager&#39;</span>
                            <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;toolbar&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;toolbar2&quot;</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toolbar2_class</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toolbar2_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;toolbar&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;toolmanager&quot;</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toolmanager_toolbar_class</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toolmanager_toolbar_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toolmanager</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolmanager</span><span class="p">:</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">add_tools_to_manager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toolmanager</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="p">:</span>
                <span class="n">tools</span><span class="o">.</span><span class="n">add_tools_to_container</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="p">)</span>

        <span class="nd">@self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">add_axobserver</span>
        <span class="k">def</span> <span class="nf">notify_axes_change</span><span class="p">(</span><span class="n">fig</span><span class="p">):</span>
            <span class="c1"># Called whenever the current Axes is changed.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolmanager</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_with_canvas</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">canvas_class</span><span class="p">,</span> <span class="n">figure</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a manager for a given *figure* using a specific *canvas_class*.</span>

<span class="sd">        Backends should override this method if they have specific needs for</span>
<span class="sd">        setting up the canvas or the manager.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">canvas_class</span><span class="p">(</span><span class="n">figure</span><span class="p">),</span> <span class="n">num</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">start_main_loop</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start the main event loop.</span>

<span class="sd">        This method is called by `.FigureManagerBase.pyplot_show`, which is the</span>
<span class="sd">        implementation of `.pyplot.show`.  To customize the behavior of</span>
<span class="sd">        `.pyplot.show`, interactive backends should usually override</span>
<span class="sd">        `~.FigureManagerBase.start_main_loop`; if more customized logic is</span>
<span class="sd">        necessary, `~.FigureManagerBase.pyplot_show` can also be overridden.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">pyplot_show</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Show all figures.  This method is the implementation of `.pyplot.show`.</span>

<span class="sd">        To customize the behavior of `.pyplot.show`, interactive backends</span>
<span class="sd">        should usually override `~.FigureManagerBase.start_main_loop`; if more</span>
<span class="sd">        customized logic is necessary, `~.FigureManagerBase.pyplot_show` can</span>
<span class="sd">        also be overridden.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        block : bool, optional</span>
<span class="sd">            Whether to block by calling ``start_main_loop``.  The default,</span>
<span class="sd">            None, means to block if we are neither in IPython&#39;s ``%pylab`` mode</span>
<span class="sd">            nor in ``interactive`` mode.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">managers</span> <span class="o">=</span> <span class="n">Gcf</span><span class="o">.</span><span class="n">get_all_fig_managers</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">managers</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">manager</span> <span class="ow">in</span> <span class="n">managers</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">manager</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>  <span class="c1"># Emits a warning for non-interactive backend.</span>
            <span class="k">except</span> <span class="n">NonGuiException</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">_api</span><span class="o">.</span><span class="n">warn_external</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">block</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Hack: Are we in IPython&#39;s %pylab mode?  In pylab mode, IPython</span>
            <span class="c1"># (&gt;= 0.10) tacks a _needmain attribute onto pyplot.show (always</span>
            <span class="c1"># set to False).</span>
            <span class="n">ipython_pylab</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pyplot&quot;</span><span class="p">),</span> <span class="s2">&quot;show&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="s2">&quot;_needmain&quot;</span><span class="p">)</span>
            <span class="n">block</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">ipython_pylab</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_interactive</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">block</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">start_main_loop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For GUI backends, show the figure window and redraw.</span>
<span class="sd">        For non-GUI backends, raise an exception, unless running headless (i.e.</span>
<span class="sd">        on Linux with an unset DISPLAY); this exception is converted to a</span>
<span class="sd">        warning in `.Figure.show`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># This should be overridden in GUI backends.</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;linux&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DISPLAY&quot;</span><span class="p">):</span>
            <span class="c1"># We cannot check _get_running_interactive_framework() ==</span>
            <span class="c1"># &quot;headless&quot; because that would also suppress the warning when</span>
            <span class="c1"># $DISPLAY exists but is invalid, which is more likely an error and</span>
            <span class="c1"># thus warrants a warning.</span>
            <span class="k">return</span>
        <span class="k">raise</span> <span class="n">NonGuiException</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Matplotlib is currently using </span><span class="si">{</span><span class="n">get_backend</span><span class="p">()</span><span class="si">}</span><span class="s2">, which is a &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;non-GUI backend, so cannot show the figure.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">full_screen_toggle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;For GUI backends, resize the window (in physical pixels).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">get_window_title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the title text of the window containing the figure, or None</span>
<span class="sd">        if there is no window (e.g., a PS backend).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;image&#39;</span>

    <span class="k">def</span> <span class="nf">set_window_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the title text of the window containing the figure.</span>

<span class="sd">        This has no effect for non-GUI (e.g., PS) backends.</span>
<span class="sd">        &quot;&quot;&quot;</span>


<span class="n">cursors</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">cursors</span>


<span class="k">class</span> <span class="nc">_Mode</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
    <span class="n">NONE</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">PAN</span> <span class="o">=</span> <span class="s2">&quot;pan/zoom&quot;</span>
    <span class="n">ZOOM</span> <span class="o">=</span> <span class="s2">&quot;zoom rect&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_navigate_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_Mode</span><span class="o">.</span><span class="n">NONE</span> <span class="k">else</span> <span class="kc">None</span>


<span class="k">class</span> <span class="nc">NavigationToolbar2</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for the navigation cursor, version 2.</span>

<span class="sd">    Backends must implement a canvas that handles connections for</span>
<span class="sd">    &#39;button_press_event&#39; and &#39;button_release_event&#39;.  See</span>
<span class="sd">    :meth:`FigureCanvasBase.mpl_connect` for more information.</span>

<span class="sd">    They must also define</span>

<span class="sd">      :meth:`save_figure`</span>
<span class="sd">         save the current figure</span>

<span class="sd">      :meth:`draw_rubberband` (optional)</span>
<span class="sd">         draw the zoom to rect &quot;rubberband&quot; rectangle</span>

<span class="sd">      :meth:`set_message` (optional)</span>
<span class="sd">         display message</span>

<span class="sd">      :meth:`set_history_buttons` (optional)</span>
<span class="sd">         you can change the history back / forward buttons to</span>
<span class="sd">         indicate disabled / enabled state.</span>

<span class="sd">    and override ``__init__`` to set up the toolbar -- without forgetting to</span>
<span class="sd">    call the base-class init.  Typically, ``__init__`` needs to set up toolbar</span>
<span class="sd">    buttons connected to the `home`, `back`, `forward`, `pan`, `zoom`, and</span>
<span class="sd">    `save_figure` methods and using standard icons in the &quot;images&quot; subdirectory</span>
<span class="sd">    of the data path.</span>

<span class="sd">    That&#39;s it, we&#39;ll do the rest!</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># list of toolitems to add to the toolbar, format is:</span>
    <span class="c1"># (</span>
    <span class="c1">#   text, # the text of the button (often not visible to users)</span>
    <span class="c1">#   tooltip_text, # the tooltip shown on hover (where possible)</span>
    <span class="c1">#   image_file, # name of the image for the button (without the extension)</span>
    <span class="c1">#   name_of_method, # name of the method in NavigationToolbar2 to call</span>
    <span class="c1"># )</span>
    <span class="n">toolitems</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s1">&#39;Home&#39;</span><span class="p">,</span> <span class="s1">&#39;Reset original view&#39;</span><span class="p">,</span> <span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="s1">&#39;home&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Back&#39;</span><span class="p">,</span> <span class="s1">&#39;Back to previous view&#39;</span><span class="p">,</span> <span class="s1">&#39;back&#39;</span><span class="p">,</span> <span class="s1">&#39;back&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward to next view&#39;</span><span class="p">,</span> <span class="s1">&#39;forward&#39;</span><span class="p">,</span> <span class="s1">&#39;forward&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Pan&#39;</span><span class="p">,</span>
         <span class="s1">&#39;Left button pans, Right button zooms</span><span class="se">\n</span><span class="s1">&#39;</span>
         <span class="s1">&#39;x/y fixes axis, CTRL fixes aspect&#39;</span><span class="p">,</span>
         <span class="s1">&#39;move&#39;</span><span class="p">,</span> <span class="s1">&#39;pan&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Zoom&#39;</span><span class="p">,</span> <span class="s1">&#39;Zoom to rectangle</span><span class="se">\n</span><span class="s1">x/y fixes axis&#39;</span><span class="p">,</span> <span class="s1">&#39;zoom_to_rect&#39;</span><span class="p">,</span> <span class="s1">&#39;zoom&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Subplots&#39;</span><span class="p">,</span> <span class="s1">&#39;Configure subplots&#39;</span><span class="p">,</span> <span class="s1">&#39;subplots&#39;</span><span class="p">,</span> <span class="s1">&#39;configure_subplots&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">,</span> <span class="s1">&#39;Save the figure&#39;</span><span class="p">,</span> <span class="s1">&#39;filesave&#39;</span><span class="p">,</span> <span class="s1">&#39;save_figure&#39;</span><span class="p">),</span>
      <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">canvas</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">toolbar</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nav_stack</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">Stack</span><span class="p">()</span>
        <span class="c1"># This cursor will be set after the initial draw.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_cursor</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">Cursors</span><span class="o">.</span><span class="n">POINTER</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_id_press</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span>
            <span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_pan_handler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_id_release</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span>
            <span class="s1">&#39;button_release_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_pan_handler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_id_drag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span>
            <span class="s1">&#39;motion_notify_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_move</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pan_info</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">_Mode</span><span class="o">.</span><span class="n">NONE</span>  <span class="c1"># a mode string for the status bar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_history_buttons</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display a message on toolbar or in status bar.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">draw_rubberband</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a rectangle rubberband to indicate zoom limits.</span>

<span class="sd">        Note that it is not guaranteed that ``x0 &lt;= x1`` and ``y0 &lt;= y1``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">remove_rubberband</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove the rubberband.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restore the original view.</span>

<span class="sd">        For convenience of being directly connected as a GUI callback, which</span>
<span class="sd">        often get passed additional parameters, this method accepts arbitrary</span>
<span class="sd">        parameters, but does not use them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nav_stack</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_history_buttons</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_view</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">back</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move back up the view lim stack.</span>

<span class="sd">        For convenience of being directly connected as a GUI callback, which</span>
<span class="sd">        often get passed additional parameters, this method accepts arbitrary</span>
<span class="sd">        parameters, but does not use them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nav_stack</span><span class="o">.</span><span class="n">back</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_history_buttons</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_view</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move forward in the view lim stack.</span>

<span class="sd">        For convenience of being directly connected as a GUI callback, which</span>
<span class="sd">        often get passed additional parameters, this method accepts arbitrary</span>
<span class="sd">        parameters, but does not use them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nav_stack</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_history_buttons</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_view</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_update_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the cursor after a mouse move event or a tool (de)activation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span><span class="o">.</span><span class="n">get_navigate</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">_Mode</span><span class="o">.</span><span class="n">ZOOM</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_cursor</span> <span class="o">!=</span> <span class="n">tools</span><span class="o">.</span><span class="n">Cursors</span><span class="o">.</span><span class="n">SELECT_REGION</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_cursor</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">Cursors</span><span class="o">.</span><span class="n">SELECT_REGION</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_last_cursor</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">Cursors</span><span class="o">.</span><span class="n">SELECT_REGION</span>
            <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">_Mode</span><span class="o">.</span><span class="n">PAN</span>
                  <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_cursor</span> <span class="o">!=</span> <span class="n">tools</span><span class="o">.</span><span class="n">Cursors</span><span class="o">.</span><span class="n">MOVE</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_cursor</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">Cursors</span><span class="o">.</span><span class="n">MOVE</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_last_cursor</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">Cursors</span><span class="o">.</span><span class="n">MOVE</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_cursor</span> <span class="o">!=</span> <span class="n">tools</span><span class="o">.</span><span class="n">Cursors</span><span class="o">.</span><span class="n">POINTER</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_cursor</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">Cursors</span><span class="o">.</span><span class="n">POINTER</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_last_cursor</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">Cursors</span><span class="o">.</span><span class="n">POINTER</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">_wait_cursor_for_draw_cm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the cursor to a wait cursor when drawing the canvas.</span>

<span class="sd">        In order to avoid constantly changing the cursor when the canvas</span>
<span class="sd">        changes frequently, do nothing if this context was triggered during the</span>
<span class="sd">        last second.  (Optimally we&#39;d prefer only setting the wait cursor if</span>
<span class="sd">        the *current* draw takes too long, but the current draw blocks the GUI</span>
<span class="sd">        thread).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_time</span><span class="p">,</span> <span class="n">last_draw_time</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_draw_time&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_draw_time</span> <span class="o">-</span> <span class="n">last_draw_time</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_cursor</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">Cursors</span><span class="o">.</span><span class="n">WAIT</span><span class="p">)</span>
                <span class="k">yield</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_cursor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_cursor</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_mouse_event_to_message</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span><span class="o">.</span><span class="n">get_navigate</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span><span class="o">.</span><span class="n">format_coord</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">OverflowError</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
                <span class="n">artists</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span><span class="o">.</span><span class="n">_mouseover_set</span>
                           <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">event</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()]</span>
                <span class="k">if</span> <span class="n">artists</span><span class="p">:</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_topmost_artist</span><span class="p">(</span><span class="n">artists</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span><span class="o">.</span><span class="n">patch</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get_cursor_data</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">data_str</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">format_cursor_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
                            <span class="k">if</span> <span class="n">data_str</span><span class="p">:</span>
                                <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">data_str</span>
                <span class="k">return</span> <span class="n">s</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">mouse_move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_cursor</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mouse_event_to_message</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_zoom_pan_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">_Mode</span><span class="o">.</span><span class="n">PAN</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;button_press_event&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">press_pan</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;button_release_event&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">release_pan</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">_Mode</span><span class="o">.</span><span class="n">ZOOM</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;button_press_event&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">press_zoom</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;button_release_event&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">release_zoom</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggle the pan/zoom tool.</span>

<span class="sd">        Pan with left button, zoom with right.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">widgetlock</span><span class="o">.</span><span class="n">available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_message</span><span class="p">(</span><span class="s2">&quot;pan unavailable&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">_Mode</span><span class="o">.</span><span class="n">PAN</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">_Mode</span><span class="o">.</span><span class="n">NONE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">widgetlock</span><span class="o">.</span><span class="n">release</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">_Mode</span><span class="o">.</span><span class="n">PAN</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">widgetlock</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">get_axes</span><span class="p">():</span>
            <span class="n">a</span><span class="o">.</span><span class="n">set_navigate_mode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">_navigate_mode</span><span class="p">)</span>

    <span class="n">_PanInfo</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;_PanInfo&quot;</span><span class="p">,</span> <span class="s2">&quot;button axes cid&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">press_pan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Callback for mouse button press in pan/zoom mode.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">MouseButton</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">MouseButton</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">]</span>
                <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">in_axes</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">get_navigate</span><span class="p">()</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">can_pan</span><span class="p">()]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">axes</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nav_stack</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_current</span><span class="p">()</span>  <span class="c1"># set the home button to this view</span>
        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">start_pan</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_id_drag</span><span class="p">)</span>
        <span class="n">id_drag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s2">&quot;motion_notify_event&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_pan</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pan_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PanInfo</span><span class="p">(</span>
            <span class="n">button</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">cid</span><span class="o">=</span><span class="n">id_drag</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">drag_pan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Callback for dragging in pan/zoom mode.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pan_info</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
            <span class="c1"># Using the recorded button at the press is safer than the current</span>
            <span class="c1"># button, as multiple buttons can get pressed during motion.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">drag_pan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pan_info</span><span class="o">.</span><span class="n">button</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">release_pan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Callback for mouse button release in pan/zoom mode.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pan_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pan_info</span><span class="o">.</span><span class="n">cid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_id_drag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span>
            <span class="s1">&#39;motion_notify_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_move</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pan_info</span><span class="o">.</span><span class="n">axes</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">end_pan</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pan_info</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_current</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">zoom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">widgetlock</span><span class="o">.</span><span class="n">available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_message</span><span class="p">(</span><span class="s2">&quot;zoom unavailable&quot;</span><span class="p">)</span>
            <span class="k">return</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Toggle zoom to rect mode.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">_Mode</span><span class="o">.</span><span class="n">ZOOM</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">_Mode</span><span class="o">.</span><span class="n">NONE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">widgetlock</span><span class="o">.</span><span class="n">release</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">_Mode</span><span class="o">.</span><span class="n">ZOOM</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">widgetlock</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">get_axes</span><span class="p">():</span>
            <span class="n">a</span><span class="o">.</span><span class="n">set_navigate_mode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">_navigate_mode</span><span class="p">)</span>

    <span class="n">_ZoomInfo</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;_ZoomInfo&quot;</span><span class="p">,</span> <span class="s2">&quot;direction start_xy axes cid cbar&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">press_zoom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Callback for mouse button press in zoom to rect mode.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">MouseButton</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">MouseButton</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">]</span>
                <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">in_axes</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">get_navigate</span><span class="p">()</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">can_zoom</span><span class="p">()]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">axes</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nav_stack</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_current</span><span class="p">()</span>  <span class="c1"># set the home button to this view</span>
        <span class="n">id_zoom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span>
            <span class="s2">&quot;motion_notify_event&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_zoom</span><span class="p">)</span>
        <span class="c1"># A colorbar is one-dimensional, so we extend the zoom rectangle out</span>
        <span class="c1"># to the edge of the Axes bbox in the other dimension. To do that we</span>
        <span class="c1"># store the orientation of the colorbar for later.</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;_colorbar&quot;</span><span class="p">):</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_colorbar</span><span class="o">.</span><span class="n">orientation</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ZoomInfo</span><span class="p">(</span>
            <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;in&quot;</span> <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;out&quot;</span><span class="p">,</span>
            <span class="n">start_xy</span><span class="o">=</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">cid</span><span class="o">=</span><span class="n">id_zoom</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="n">cbar</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">drag_zoom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Callback for dragging in zoom mode.&quot;&quot;&quot;</span>
        <span class="n">start_xy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span><span class="o">.</span><span class="n">start_xy</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
            <span class="p">[</span><span class="n">start_xy</span><span class="p">,</span> <span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">]],</span> <span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span>
        <span class="c1"># Force the key on colorbars to extend the short-axis bbox</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span><span class="o">.</span><span class="n">cbar</span> <span class="o">==</span> <span class="s2">&quot;horizontal&quot;</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span><span class="o">.</span><span class="n">cbar</span> <span class="o">==</span> <span class="s2">&quot;vertical&quot;</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;y&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span>
            <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">intervaly</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">intervalx</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">draw_rubberband</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">release_zoom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Callback for mouse button release in zoom to rect mode.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># We don&#39;t check the event button here, so that zooms can be cancelled</span>
        <span class="c1"># by (pressing and) releasing another mouse button.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span><span class="o">.</span><span class="n">cid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_rubberband</span><span class="p">()</span>

        <span class="n">start_x</span><span class="p">,</span> <span class="n">start_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span><span class="o">.</span><span class="n">start_xy</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span>
        <span class="c1"># Force the key on colorbars to ignore the zoom-cancel on the</span>
        <span class="c1"># short-axis side</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span><span class="o">.</span><span class="n">cbar</span> <span class="o">==</span> <span class="s2">&quot;horizontal&quot;</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span><span class="o">.</span><span class="n">cbar</span> <span class="o">==</span> <span class="s2">&quot;vertical&quot;</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;y&quot;</span>
        <span class="c1"># Ignore single clicks: 5 pixels is a threshold that allows the user to</span>
        <span class="c1"># &quot;cancel&quot; a zoom action by zooming by less than 5 pixels.</span>
        <span class="k">if</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">start_x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;y&quot;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">start_y</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;x&quot;</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span><span class="o">.</span><span class="n">axes</span><span class="p">):</span>
            <span class="c1"># Detect whether this Axes is twinned with an earlier Axes in the</span>
            <span class="c1"># list of zoomed Axes, to avoid double zooming.</span>
            <span class="n">twinx</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_shared_x_axes</span><span class="p">()</span><span class="o">.</span><span class="n">joined</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">prev</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">prev</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span><span class="o">.</span><span class="n">axes</span><span class="p">[:</span><span class="n">i</span><span class="p">])</span>
            <span class="n">twiny</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_shared_y_axes</span><span class="p">()</span><span class="o">.</span><span class="n">joined</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">prev</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">prev</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span><span class="o">.</span><span class="n">axes</span><span class="p">[:</span><span class="n">i</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">_set_view_from_bbox</span><span class="p">(</span>
                <span class="p">(</span><span class="n">start_x</span><span class="p">,</span> <span class="n">start_y</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span><span class="o">.</span><span class="n">direction</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">twinx</span><span class="p">,</span> <span class="n">twiny</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_current</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">push_current</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Push the current view limits and position onto the stack.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nav_stack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span>
            <span class="n">WeakKeyDictionary</span><span class="p">(</span>
                <span class="p">{</span><span class="n">ax</span><span class="p">:</span> <span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">_get_view</span><span class="p">(),</span>
                      <span class="c1"># Store both the original and modified positions.</span>
                      <span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_position</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">frozen</span><span class="p">(),</span>
                       <span class="n">ax</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">frozen</span><span class="p">()))</span>
                 <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">axes</span><span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_history_buttons</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_update_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the viewlim and position from the view and position stack for</span>
<span class="sd">        each Axes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nav_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nav_stack</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">nav_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># Retrieve all items at once to avoid any risk of GC deleting an Axes</span>
        <span class="c1"># while in the middle of the loop below.</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nav_info</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="p">(</span><span class="n">pos_orig</span><span class="p">,</span> <span class="n">pos_active</span><span class="p">))</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">_set_view</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
            <span class="c1"># Restore both the original and modified positions</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">_set_position</span><span class="p">(</span><span class="n">pos_orig</span><span class="p">,</span> <span class="s1">&#39;original&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">_set_position</span><span class="p">(</span><span class="n">pos_active</span><span class="p">,</span> <span class="s1">&#39;active&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">configure_subplots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;subplot_tool&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subplot_tool</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="c1"># This import needs to happen here due to circular imports.</span>
        <span class="kn">from</span> <span class="nn">matplotlib.figure</span> <span class="kn">import</span> <span class="n">Figure</span>
        <span class="k">with</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rc_context</span><span class="p">({</span><span class="s2">&quot;toolbar&quot;</span><span class="p">:</span> <span class="s2">&quot;none&quot;</span><span class="p">}):</span>  <span class="c1"># No navbar for the toolfig.</span>
            <span class="n">manager</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span><span class="o">.</span><span class="n">new_manager</span><span class="p">(</span><span class="n">Figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">manager</span><span class="o">.</span><span class="n">set_window_title</span><span class="p">(</span><span class="s2">&quot;Subplot configuration tool&quot;</span><span class="p">)</span>
        <span class="n">tool_fig</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span>
        <span class="n">tool_fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot_tool</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">SubplotTool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="n">tool_fig</span><span class="p">)</span>
        <span class="n">cid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span>
            <span class="s2">&quot;close_event&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">manager</span><span class="o">.</span><span class="n">destroy</span><span class="p">())</span>

        <span class="k">def</span> <span class="nf">on_tool_fig_close</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="n">cid</span><span class="p">)</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_tool</span>

        <span class="n">tool_fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s2">&quot;close_event&quot;</span><span class="p">,</span> <span class="n">on_tool_fig_close</span><span class="p">)</span>
        <span class="n">manager</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot_tool</span>

    <span class="k">def</span> <span class="nf">save_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the current figure.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset the Axes stack.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nav_stack</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_history_buttons</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_history_buttons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable or disable the back/forward button.&quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">ToolContainerBase</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all tool containers, e.g. toolbars.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    toolmanager : `.ToolManager`</span>
<span class="sd">        The tools with which this `ToolContainer` wants to communicate.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_icon_extension</span> <span class="o">=</span> <span class="s1">&#39;.png&#39;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Toolcontainer button icon image format extension</span>

<span class="sd">    **String**: Image extension</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">toolmanager</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolmanager</span> <span class="o">=</span> <span class="n">toolmanager</span>
        <span class="n">toolmanager</span><span class="o">.</span><span class="n">toolmanager_connect</span><span class="p">(</span>
            <span class="s1">&#39;tool_message_event&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_message</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">message</span><span class="p">))</span>
        <span class="n">toolmanager</span><span class="o">.</span><span class="n">toolmanager_connect</span><span class="p">(</span>
            <span class="s1">&#39;tool_removed_event&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_toolitem</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">tool</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_tool_toggled_cbk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Capture the &#39;tool_trigger_[name]&#39;</span>

<span class="sd">        This only gets used for toggled tools.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toggle_toolitem</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">tool</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">tool</span><span class="o">.</span><span class="n">toggled</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">position</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a tool to this container.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tool : tool_like</span>
<span class="sd">            The tool to add, see `.ToolManager.get_tool`.</span>
<span class="sd">        group : str</span>
<span class="sd">            The name of the group to add this tool to.</span>
<span class="sd">        position : int, default: -1</span>
<span class="sd">            The position within the group to place this tool.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolmanager</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_image_filename</span><span class="p">(</span><span class="n">tool</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        <span class="n">toggle</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="s1">&#39;toggled&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_toolitem</span><span class="p">(</span><span class="n">tool</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span>
                          <span class="n">image</span><span class="p">,</span> <span class="n">tool</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">toggle</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">toggle</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toolmanager</span><span class="o">.</span><span class="n">toolmanager_connect</span><span class="p">(</span><span class="s1">&#39;tool_trigger_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tool</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">_tool_toggled_cbk</span><span class="p">)</span>
            <span class="c1"># If initially toggled</span>
            <span class="k">if</span> <span class="n">tool</span><span class="o">.</span><span class="n">toggled</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">toggle_toolitem</span><span class="p">(</span><span class="n">tool</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_image_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the image based on its name.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">image</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">basedir</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_get_data_path</span><span class="p">(</span><span class="s2">&quot;images&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="n">image</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_icon_extension</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">basedir</span> <span class="o">/</span> <span class="n">image</span><span class="p">),</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">basedir</span> <span class="o">/</span> <span class="p">(</span><span class="n">image</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_icon_extension</span><span class="p">)),</span>
        <span class="p">]:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">fname</span>

    <span class="k">def</span> <span class="nf">trigger_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Trigger the tool.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name (id) of the tool triggered from within the container.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolmanager</span><span class="o">.</span><span class="n">trigger_tool</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_toolitem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">toggle</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a toolitem to the container.</span>

<span class="sd">        This method must be implemented per backend.</span>

<span class="sd">        The callback associated with the button click event,</span>
<span class="sd">        must be *exactly* ``self.trigger_tool(name)``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name of the tool to add, this gets used as the tool&#39;s ID and as the</span>
<span class="sd">            default label of the buttons.</span>
<span class="sd">        group : str</span>
<span class="sd">            Name of the group that this tool belongs to.</span>
<span class="sd">        position : int</span>
<span class="sd">            Position of the tool within its group, if -1 it goes at the end.</span>
<span class="sd">        image : str</span>
<span class="sd">            Filename of the image for the button or `None`.</span>
<span class="sd">        description : str</span>
<span class="sd">            Description of the tool, used for the tooltips.</span>
<span class="sd">        toggle : bool</span>
<span class="sd">            * `True` : The button is a toggle (change the pressed/unpressed</span>
<span class="sd">              state between consecutive clicks).</span>
<span class="sd">            * `False` : The button is a normal button (returns to unpressed</span>
<span class="sd">              state after release).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">toggle_toolitem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">toggled</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggle the toolitem without firing event.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Id of the tool to toggle.</span>
<span class="sd">        toggled : bool</span>
<span class="sd">            Whether to set this tool as toggled or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">remove_toolitem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a toolitem from the `ToolContainer`.</span>

<span class="sd">        This method must get implemented per backend.</span>

<span class="sd">        Called when `.ToolManager` emits a `tool_removed_event`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name of the tool to remove.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">set_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display a message on the toolbar.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        s : str</span>
<span class="sd">            Message text.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>


<span class="k">class</span> <span class="nc">_Backend</span><span class="p">:</span>
    <span class="c1"># A backend can be defined by using the following pattern:</span>
    <span class="c1">#</span>
    <span class="c1"># @_Backend.export</span>
    <span class="c1"># class FooBackend(_Backend):</span>
    <span class="c1">#     # override the attributes and methods documented below.</span>

    <span class="c1"># `backend_version` may be overridden by the subclass.</span>
    <span class="n">backend_version</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>

    <span class="c1"># The `FigureCanvas` class must be defined.</span>
    <span class="n">FigureCanvas</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># For interactive backends, the `FigureManager` class must be overridden.</span>
    <span class="n">FigureManager</span> <span class="o">=</span> <span class="n">FigureManagerBase</span>

    <span class="c1"># For interactive backends, `mainloop` should be a function taking no</span>
    <span class="c1"># argument and starting the backend main loop.  It should be left as None</span>
    <span class="c1"># for non-interactive backends.</span>
    <span class="n">mainloop</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># The following methods will be automatically defined and exported, but</span>
    <span class="c1"># can be overridden.</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">new_figure_manager</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new figure manager instance.&quot;&quot;&quot;</span>
        <span class="c1"># This import needs to happen here due to circular imports.</span>
        <span class="kn">from</span> <span class="nn">matplotlib.figure</span> <span class="kn">import</span> <span class="n">Figure</span>
        <span class="n">fig_cls</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;FigureClass&#39;</span><span class="p">,</span> <span class="n">Figure</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">fig_cls</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">new_figure_manager_given_figure</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">fig</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">new_figure_manager_given_figure</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">figure</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new figure manager instance for the given figure.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">FigureCanvas</span><span class="o">.</span><span class="n">new_manager</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">draw_if_interactive</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">manager_class</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">FigureCanvas</span><span class="o">.</span><span class="n">manager_class</span>
        <span class="c1"># Interactive backends reimplement start_main_loop or pyplot_show.</span>
        <span class="n">backend_is_interactive</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">manager_class</span><span class="o">.</span><span class="n">start_main_loop</span> <span class="o">!=</span> <span class="n">FigureManagerBase</span><span class="o">.</span><span class="n">start_main_loop</span>
            <span class="ow">or</span> <span class="n">manager_class</span><span class="o">.</span><span class="n">pyplot_show</span> <span class="o">!=</span> <span class="n">FigureManagerBase</span><span class="o">.</span><span class="n">pyplot_show</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">backend_is_interactive</span> <span class="ow">and</span> <span class="n">is_interactive</span><span class="p">():</span>
            <span class="n">manager</span> <span class="o">=</span> <span class="n">Gcf</span><span class="o">.</span><span class="n">get_active</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">manager</span><span class="p">:</span>
                <span class="n">manager</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Show all figures.</span>

<span class="sd">        `show` blocks by calling `mainloop` if *block* is ``True``, or if it</span>
<span class="sd">        is ``None`` and we are neither in IPython&#39;s ``%pylab`` mode, nor in</span>
<span class="sd">        `interactive` mode.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">managers</span> <span class="o">=</span> <span class="n">Gcf</span><span class="o">.</span><span class="n">get_all_fig_managers</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">managers</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">manager</span> <span class="ow">in</span> <span class="n">managers</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">manager</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>  <span class="c1"># Emits a warning for non-interactive backend.</span>
            <span class="k">except</span> <span class="n">NonGuiException</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">_api</span><span class="o">.</span><span class="n">warn_external</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">mainloop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">block</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Hack: Are we in IPython&#39;s %pylab mode?  In pylab mode, IPython</span>
            <span class="c1"># (&gt;= 0.10) tacks a _needmain attribute onto pyplot.show (always</span>
            <span class="c1"># set to False).</span>
            <span class="n">ipython_pylab</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pyplot&quot;</span><span class="p">),</span> <span class="s2">&quot;show&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="s2">&quot;_needmain&quot;</span><span class="p">)</span>
            <span class="n">block</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">ipython_pylab</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_interactive</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">block</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>

    <span class="c1"># This method is the one actually exporting the required methods.</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;backend_version&quot;</span><span class="p">,</span>
                <span class="s2">&quot;FigureCanvas&quot;</span><span class="p">,</span>
                <span class="s2">&quot;FigureManager&quot;</span><span class="p">,</span>
                <span class="s2">&quot;new_figure_manager&quot;</span><span class="p">,</span>
                <span class="s2">&quot;new_figure_manager_given_figure&quot;</span><span class="p">,</span>
                <span class="s2">&quot;draw_if_interactive&quot;</span><span class="p">,</span>
                <span class="s2">&quot;show&quot;</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span><span class="p">],</span> <span class="n">name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

        <span class="c1"># For back-compatibility, generate a shim `Show` class.</span>

        <span class="k">class</span> <span class="nc">Show</span><span class="p">(</span><span class="n">ShowBase</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">mainloop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>

        <span class="nb">setattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span><span class="p">],</span> <span class="s2">&quot;Show&quot;</span><span class="p">,</span> <span class="n">Show</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span>


<span class="k">class</span> <span class="nc">ShowBase</span><span class="p">(</span><span class="n">_Backend</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple base class to generate a ``show()`` function in backends.</span>

<span class="sd">    Subclass must override ``mainloop()`` method.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="n">block</span><span class="p">)</span>
</pre></div>
        </article>
      </div>
      <footer>
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2019, Qiskit Development Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on 2023/12/28</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../../_static/documentation_options.js?v=59fadc99"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/qiskit-sphinx-theme.js?v=4d77b8ca"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    </body>
</html>